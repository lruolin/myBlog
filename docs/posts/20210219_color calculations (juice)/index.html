<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
<title>pRactice corner: Color Analysis in Juices</title>

<meta property="description" itemprop="description" content="Using R for color calculations and data visualization"/>


<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2021-02-19"/>
<meta property="article:created" itemprop="dateCreated" content="2021-02-19"/>
<meta name="article:author" content="lruolin"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="pRactice corner: Color Analysis in Juices"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Using R for color calculations and data visualization"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="pRactice corner"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary"/>
<meta property="twitter:title" content="pRactice corner: Color Analysis in Juices"/>
<meta property="twitter:description" content="Using R for color calculations and data visualization"/>

<!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Color analysis;citation_publication_date=2017;citation_publisher=Springer International Publishing;citation_doi=10.1007/978-3-319-45776-5_31;citation_author=Ronald E. Wrolstad;citation_author=Daniel E. Smith"/>
  <meta name="citation_reference" content="citation_title=HUE ANGLE DETERMINATIONS AND STATISTICAL ANALYSIS FOR MULTIQUADRANT HUNTER l,a,b DATA;citation_publication_date=1995;citation_volume=18;citation_doi=https://doi.org/10.1111/j.1745-4557.1995.tb00377.x;citation_issn=1745-4557;citation_author=M. R. Mclellan;citation_author=L. R. Lind;citation_author=R. W. Kime"/>
  <meta name="citation_reference" content="citation_title=Biosynthesis of plant pigments: Anthocyanins, betalains and carotenoids;citation_publication_date=2008;citation_volume=54;citation_doi=https://doi.org/10.1111/j.1365-313X.2008.03447.x;citation_issn=1365-313X;citation_author=Yoshikazu Tanaka;citation_author=Nobuhiro Sasaki;citation_author=Akemi Ohmiya"/>
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output","bibliography"]}},"value":[{"type":"character","attributes":{},"value":["Color Analysis in Juices"]},{"type":"character","attributes":{},"value":["Using R for color calculations and data visualization"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["lruolin"]}]}]},{"type":"character","attributes":{},"value":["02-19-2021"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"character","attributes":{},"value":["juices.bib"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["Color-analysis-for-Juices_files/anchor-4.2.2/anchor.min.js","Color-analysis-for-Juices_files/bowser-1.9.3/bowser.min.js","Color-analysis-for-Juices_files/distill-2.2.21/template.v2.js","Color-analysis-for-Juices_files/figure-html5/unnamed-chunk-11-1.png","Color-analysis-for-Juices_files/figure-html5/unnamed-chunk-12-1.png","Color-analysis-for-Juices_files/header-attrs-2.6/header-attrs.js","Color-analysis-for-Juices_files/jquery-1.11.3/jquery.min.js","Color-analysis-for-Juices_files/popper-2.6.0/popper.min.js","Color-analysis-for-Juices_files/tippy-6.2.7/tippy-bundle.umd.min.js","Color-analysis-for-Juices_files/tippy-6.2.7/tippy-light-border.css","Color-analysis-for-Juices_files/tippy-6.2.7/tippy.css","Color-analysis-for-Juices_files/tippy-6.2.7/tippy.umd.min.js","Color-analysis-for-Juices_files/webcomponents-2.0.0/webcomponents.js","juices.bib"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.6/header-attrs.js"></script>
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Color Analysis in Juices","description":"Using R for color calculations and data visualization","authors":[{"author":"lruolin","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-02-19T00:00:00.000+00:00","citationText":"lruolin, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="../../index.html" class="title">pRactice corner</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../about.html">About</a>
<a href="../../usefullinks.html">Useful Links</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Color Analysis in Juices</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>Using R for color calculations and data visualization</p></p>
</div>

<div class="d-byline">
  lruolin  
  
<br/>02-19-2021
</div>

<div class="d-article">
<h1 id="introduction">Introduction</h1>
<p>Why are food scientists interested in color analysis? Color is a visual quality attribute that determines food acceptance (<span class="citation" data-cites="wrolstad_color_2017"><a href="#ref-wrolstad_color_2017" role="doc-biblioref">Wrolstad and Smith</a> (<a href="#ref-wrolstad_color_2017" role="doc-biblioref">2017</a>)</span>). Instrumental color analysis is carried out in most commercial research and development laboratories to assess color stability, and in turn, shelf life of food products. The Hunter L a b color space is commonly used in the food industry, and was first published in 1942. Improvements were made to this system, to give more uniform color spacing, and in 1976, the CIELAB L* a* b* system was introduced. Chroma and Hue could be calculated from the a* and b* values. What do all these terms mean?</p>
<ul>
<li><p>L* : lightness (0 being black and 100 being white)</p></li>
<li><p>a*: red (+) and green (-)</p></li>
<li><p>b*: yellow (+) and blue (-)</p></li>
<li><p>Chroma: a measure of how vivid/dull the color is. Chroma increases with increasing pigment concentration, and then decreases as the sample becomes darker.</p></li>
<li><p>Hue (in radian): the type of color - where red is defined as 0/360deg, yellow is defined as 90 deg, green is defined as 180 deg and blue is defined as 270 deg.</p></li>
</ul>
<p>The calculations for chroma and hue are give below:</p>
<p>Chroma = sqrt(aˆ2 + bˆ2)</p>
<p>Hue is expressed in radians (multiply by 180/pi). However, this equation is only for the first quadrant. Other quadrants need to be handled so that a 360deg representation is accomodated (<span class="citation" data-cites="mclellan_hue_1995"><a href="#ref-mclellan_hue_1995" role="doc-biblioref">Mclellan, Lind, and Kime</a> (<a href="#ref-mclellan_hue_1995" role="doc-biblioref">1995</a>)</span>).</p>
<ul>
<li>First quadrant [+a, +b] : Hue = arc tan (b/a)</li>
<li>Second quadrant [‐a, +b] and third quadrant [−a, −b] calculations should be: hue = 180+Arc tan(b/a).</li>
<li>Fourth quadrant [+a, −b] calculations should be: hue = 360+ Arc tan(b/a).</li>
</ul>
<p>The L* C* H* color space is more useful than just looking at L* a* b*, since it takes into account human perception of color, rather than just looking at redness/greenness and yellowness/blueness individually.</p>
<p>Ultimately, when color is measured, other than having an objective set of numbers to describe colors, it is also of interest to assess if there is any color difference between a reference sample and a test sample, and to peg a number to this color difference and immediately tell if the color difference is visually obvious to people.</p>
<p>There are different equations for assessing color difference:</p>
<ul>
<li><p>deltaE-1976: the first internationally endorced color difference equation. However, it does not take into account that the human eye is more sensitive to small color differences in some regions of the color wheel but less sensitive to others.</p></li>
<li><p>deltaE-1994: Improvements were made to the 1976 equation, but it lacked accuracy in the blue-violet region of the color space.</p></li>
<li><p>deltaE-2000: Corrected for the 1994 equation to improve accuracy in the blue-violet space. This is the most updated and accurate representation of total color difference so far, and the equation is given in: <a href="http://www2.ece.rochester.edu/~gsharma/ciede2000/ciede2000noteCRNA.pdf" class="uri">http://www2.ece.rochester.edu/~gsharma/ciede2000/ciede2000noteCRNA.pdf</a>.</p></li>
</ul>
<p>Previously, I worked with Excel spreadsheets to carry out color data calculations. It was a nightmare when I tried to calculate hue using Excel, as the equations used for +a/-a/+b/-b could be different and it was problematic when I was trying to fill an equation down for my shelf life study. DE2000 was complicated and I tried to use a spreadsheet that I downloaded off the Internet, but I had to copy my data over to the template spreadsheet and it was a lot of copying and pasting.</p>
<p>All I want, is a workflow that can house all my data in 1 place, and automatically apply calculations with minimal manual input.</p>
<p>I am so glad that I found R, and that there is an inbuilt package <strong>spacesXYZ</strong>, that can calculate the different variants of total color difference.</p>
<h1 id="objective">Objective</h1>
<ol type="1">
<li><p>To develop a workflow for automatic color calculations. This include writing my own function for calculating chroma, hue, and using inbuilt functions within spacesXYZ package to calculate de2000.</p></li>
<li><p>To visualize data and derive insights from shelf life data clearly.</p></li>
</ol>
<h1 id="data">Data</h1>
<p>The data I am using is from a paper by Porto et al: <a href="https://www.mdpi.com/2306-5710/3/3/36" class="uri">https://www.mdpi.com/2306-5710/3/3/36</a>. In this paper, the color data for five types of juices were given, and color changes were assessed in terms of L* a* b*, chroma and de1976. I went on further to look at hue, and de2000.</p>
<h1 id="workflow">Workflow</h1>
<ol type="1">
<li>Load data</li>
<li>Transform data (in wide format) - calculate chroma and hue</li>
<li>Add in new columns with initial L* a* b* to facilitate calculation for de2000</li>
<li>Extract initial L* a* b* values as <em>matrix</em> form</li>
<li>Extract measured L* a* b* values as <em>matrix</em> form</li>
<li>Calculate de2000 using spacesXYZ, as the function requires input to be in matrix form</li>
<li>Calculate change in L* a* b* chroma and hue</li>
<li>Transform data into long format for data visualization</li>
<li>Plot de2000, L* a* b* chroma and hue, as well as change in L* a* b* chroma and hue to derive insights.</li>
</ol>
<h1 id="load-packages">Load packages</h1>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/trinker/pacman'>pacman</a></span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/pacman/man/p_load.html'>p_load</a></span><span class='op'>(</span><span class='va'>tidyverse</span>, <span class='va'>spacesXYZ</span>, <span class='va'>ggthemes</span>, <span class='va'>gridExtra</span>, <span class='va'>ggsci</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h1 id="import-data">Import Data</h1>
<p>The five samples tested were:</p>
<ul>
<li>BJ: raw beet juice</li>
<li>PBJ: pasteurized beet juice</li>
<li>POJ: pasteurized orange juice</li>
<li>BOMJ_1: pasteurized beet and orange mix juice (1:1 v/v)</li>
<li>BOMJ-2: pasteurized beet and orange mix juice (1:2, v/v)</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>data_l</span> <span class='op'>&lt;-</span> <span class='fu'>tribble</span><span class='op'>(</span>
  <span class='op'>~</span><span class='va'>Juices</span>, <span class='op'>~</span><span class='va'>L_d0</span>, <span class='op'>~</span><span class='va'>L_d5</span>, <span class='op'>~</span><span class='va'>L_d10</span>, <span class='op'>~</span><span class='va'>L_d15</span>, <span class='op'>~</span><span class='va'>L_d30</span>,
  <span class='co'>#-------/------/-----/--------/------/-------</span>
  <span class='st'>"BJ"</span>,     <span class='fl'>22.45</span>, <span class='fl'>22.87</span>, <span class='fl'>22.31</span>, <span class='fl'>22.37</span>, <span class='fl'>24.16</span> , 
  <span class='st'>"PBJ"</span>,    <span class='fl'>22.37</span>, <span class='fl'>22.71</span>, <span class='fl'>22.34</span>, <span class='fl'>22.23</span>, <span class='fl'>23.72</span>,
  <span class='st'>"POJ"</span>,    <span class='fl'>33.61</span>, <span class='fl'>38.18</span>, <span class='fl'>36.73</span>, <span class='fl'>37.04</span>, <span class='fl'>42.42</span>,
  <span class='st'>"BOMJ_1"</span>, <span class='fl'>23.21</span>, <span class='fl'>23.76</span>, <span class='fl'>23.15</span>, <span class='fl'>23.14</span>, <span class='fl'>24.78</span>,
  <span class='st'>"BOMJ_2"</span>, <span class='fl'>23.77</span>, <span class='fl'>24.33</span>, <span class='fl'>23.81</span>, <span class='fl'>24.15</span>, <span class='fl'>26.18</span>
<span class='op'>)</span>


<span class='va'>data_a</span> <span class='op'>&lt;-</span> <span class='fu'>tribble</span><span class='op'>(</span>
  <span class='op'>~</span><span class='va'>Juices</span>, <span class='op'>~</span><span class='va'>a_d0</span>, <span class='op'>~</span><span class='va'>a_d5</span>, <span class='op'>~</span><span class='va'>a_d10</span>, <span class='op'>~</span><span class='va'>a_d15</span>, <span class='op'>~</span><span class='va'>a_d30</span>,
  <span class='co'>#-------/------/-----/--------/------/-------</span>
  <span class='st'>"BJ"</span>,     <span class='fl'>0.78</span>, <span class='fl'>0.68</span>, <span class='fl'>0.74</span>, <span class='fl'>0.81</span>, <span class='fl'>1.07</span>,
  <span class='st'>"PBJ"</span>,    <span class='fl'>0.95</span>, <span class='fl'>0.82</span>, <span class='fl'>0.87</span>, <span class='fl'>0.91</span>, <span class='fl'>1.19</span>,
  <span class='st'>"POJ"</span>,    <span class='op'>-</span><span class='fl'>2.49</span>, <span class='op'>-</span><span class='fl'>2.87</span>, <span class='op'>-</span><span class='fl'>2.51</span>, <span class='op'>-</span><span class='fl'>2.63</span>, <span class='op'>-</span><span class='fl'>3.64</span>,
  <span class='st'>"BOMJ_1"</span>, <span class='fl'>4.80</span>, <span class='fl'>5.18</span>, <span class='fl'>4.78</span>, <span class='fl'>4.59</span>, <span class='fl'>6.13</span>,
  <span class='st'>"BOMJ_2"</span>, <span class='fl'>6.65</span>, <span class='fl'>7.07</span>, <span class='fl'>6.65</span>, <span class='fl'>6.68</span>, <span class='fl'>8.76</span>
<span class='op'>)</span>


<span class='va'>data_b</span> <span class='op'>&lt;-</span> <span class='fu'>tribble</span><span class='op'>(</span>
  <span class='op'>~</span><span class='va'>Juices</span>, <span class='op'>~</span><span class='va'>b_d0</span>, <span class='op'>~</span><span class='va'>b_d5</span>, <span class='op'>~</span><span class='va'>b_d10</span>, <span class='op'>~</span><span class='va'>b_d15</span>, <span class='op'>~</span><span class='va'>b_d30</span>,
  <span class='co'>#-------/------/-----/--------/------/-------</span>
  <span class='st'>"BJ"</span>,    <span class='fl'>1.56</span>, <span class='fl'>1.52</span>, <span class='fl'>1.56</span>, <span class='fl'>1.57</span>, <span class='fl'>0.97</span>, 
  <span class='st'>"PBJ"</span>,   <span class='fl'>1.67</span>, <span class='fl'>1.61</span>, <span class='fl'>1.63</span>, <span class='fl'>1.64</span>, <span class='fl'>1.21</span>,  
  <span class='st'>"POJ"</span>,  <span class='fl'>16.34</span>, <span class='fl'>17.03</span>, <span class='fl'>16.46</span>, <span class='fl'>15.95</span>, <span class='fl'>18.34</span>,
  <span class='st'>"BOMJ_1"</span>, <span class='fl'>2.39</span>, <span class='fl'>2.38</span>, <span class='fl'>2.35</span>, <span class='fl'>2.19</span>, <span class='fl'>2.23</span>,
  <span class='st'>"BOMJ_2"</span>, <span class='fl'>2.75</span>, <span class='fl'>2.82</span>, <span class='fl'>2.68</span>, <span class='fl'>2.26</span>, <span class='fl'>2.47</span>
<span class='op'>)</span>

<span class='co'># Transform #####</span>
<span class='va'>data</span> <span class='op'>&lt;-</span> <span class='fu'>bind_cols</span><span class='op'>(</span><span class='va'>data_l</span>, <span class='va'>data_a</span>, <span class='va'>data_b</span>, .name_repair <span class='op'>=</span> <span class='st'>"unique"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>Juices...7</span>, <span class='op'>-</span><span class='va'>Juices...13</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>rename</span><span class='op'>(</span>juices <span class='op'>=</span> <span class='va'>Juices...1</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h1 id="transform">Transform</h1>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>data_reshape_L</span> <span class='op'>&lt;-</span> <span class='va'>data</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_longer</span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'>starts_with</span><span class='op'>(</span><span class='st'>"L"</span><span class='op'>)</span>,
               names_to <span class='op'>=</span> <span class='st'>"days_L"</span>,
               values_to <span class='op'>=</span> <span class='st'>"L_av"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>juices</span>, <span class='va'>days_L</span>, <span class='va'>L_av</span><span class='op'>)</span>


<span class='va'>data_reshape_a</span> <span class='op'>&lt;-</span> <span class='va'>data</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_longer</span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'>starts_with</span><span class='op'>(</span><span class='st'>"a"</span><span class='op'>)</span>,
               names_to <span class='op'>=</span> <span class='st'>"days_a"</span>,
               values_to <span class='op'>=</span> <span class='st'>"a_av"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>juices</span>, <span class='va'>days_a</span>, <span class='va'>a_av</span><span class='op'>)</span>
  
<span class='va'>data_reshape_b</span> <span class='op'>&lt;-</span> <span class='va'>data</span> <span class='op'>%&gt;%</span>   
  <span class='fu'>pivot_longer</span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'>starts_with</span><span class='op'>(</span><span class='st'>"b"</span><span class='op'>)</span>,
               names_to <span class='op'>=</span> <span class='st'>"days_b"</span>,
               values_to <span class='op'>=</span> <span class='st'>"b_av"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>juices</span>, <span class='va'>days_b</span>, <span class='va'>b_av</span><span class='op'>)</span>


<span class='va'>data_reshaped</span> <span class='op'>&lt;-</span> <span class='fu'>bind_cols</span><span class='op'>(</span><span class='va'>data_reshape_L</span>, <span class='va'>data_reshape_a</span>, <span class='va'>data_reshape_b</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>days <span class='op'>=</span> <span class='fu'>parse_number</span><span class='op'>(</span><span class='va'>days_L</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>juices...1</span>, <span class='va'>days</span>, <span class='va'>L_av</span>, <span class='va'>a_av</span>, <span class='va'>b_av</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>rename</span><span class='op'>(</span>juices <span class='op'>=</span> <span class='va'>juices...1</span><span class='op'>)</span>

<span class='va'>data_reshaped</span>
</code></pre>
</div>
<pre><code># A tibble: 25 x 5
   juices  days  L_av  a_av  b_av
   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 BJ         0  22.4  0.78  1.56
 2 BJ         5  22.9  0.68  1.52
 3 BJ        10  22.3  0.74  1.56
 4 BJ        15  22.4  0.81  1.57
 5 BJ        30  24.2  1.07  0.97
 6 PBJ        0  22.4  0.95  1.67
 7 PBJ        5  22.7  0.82  1.61
 8 PBJ       10  22.3  0.87  1.63
 9 PBJ       15  22.2  0.91  1.64
10 PBJ       30  23.7  1.19  1.21
# … with 15 more rows</code></pre>
</div>
<h1 id="color-calculations">Color calculations</h1>
<h2 id="writing-functions-to-calculate-chroma-and-hue">Writing functions to calculate chroma and hue</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cal_chroma</span> <span class='op'>&lt;-</span> <span class='kw'>function</span> <span class='op'>(</span><span class='va'>a_av</span>, <span class='va'>b_av</span><span class='op'>)</span> <span class='op'>{</span>
  
  <span class='va'>a_sq</span> <span class='op'>=</span> <span class='va'>a_av</span><span class='op'>^</span><span class='fl'>2</span>
  <span class='va'>b_sq</span> <span class='op'>=</span> <span class='va'>b_av</span><span class='op'>^</span><span class='fl'>2</span>
  <span class='va'>chroma</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='va'>a_sq</span> <span class='op'>+</span> <span class='va'>b_sq</span><span class='op'>)</span>
  
<span class='op'>}</span>

<span class='va'>cal_hue</span> <span class='op'>&lt;-</span> <span class='kw'>function</span> <span class='op'>(</span><span class='va'>a_av</span>, <span class='va'>b_av</span><span class='op'>)</span> <span class='op'>{</span>
  
  <span class='kw'>if</span><span class='op'>(</span><span class='va'>a_av</span> <span class='op'>&gt;</span> <span class='fl'>0</span> <span class='op'>&amp;</span> <span class='va'>b_av</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>{</span>  <span class='co'># a pos, b pos</span>
    <span class='va'>hue</span> <span class='op'>=</span> <span class='fl'>180</span><span class='op'>*</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>atan</a></span><span class='op'>(</span><span class='va'>b_av</span><span class='op'>/</span><span class='va'>a_av</span><span class='op'>)</span><span class='op'>/</span><span class='va'>pi</span><span class='op'>)</span>
    
    
  <span class='op'>}</span>   <span class='kw'>else</span> <span class='kw'>if</span> <span class='op'>(</span><span class='va'>a_av</span><span class='op'>&lt;</span><span class='fl'>0</span> <span class='op'>&amp;</span> <span class='va'>b_av</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>{</span>  <span class='co'># a neg, b pos</span>
    <span class='va'>hue</span> <span class='op'>=</span> <span class='fl'>180</span> <span class='op'>+</span> <span class='fl'>180</span><span class='op'>*</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>atan</a></span><span class='op'>(</span><span class='va'>b_av</span><span class='op'>/</span><span class='va'>a_av</span><span class='op'>)</span><span class='op'>/</span><span class='va'>pi</span><span class='op'>)</span>
    
    
  <span class='op'>}</span> <span class='kw'>else</span> <span class='kw'>if</span> <span class='op'>(</span><span class='va'>a_av</span><span class='op'>&lt;</span><span class='fl'>0</span> <span class='op'>&amp;</span> <span class='va'>b_av</span><span class='op'>&lt;</span><span class='fl'>0</span><span class='op'>)</span> <span class='op'>{</span>   <span class='co'># a neg, b neg</span>
    <span class='va'>hue</span> <span class='op'>=</span> <span class='fl'>180</span> <span class='op'>+</span> <span class='fl'>180</span><span class='op'>*</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>atan</a></span><span class='op'>(</span><span class='va'>b_av</span><span class='op'>/</span><span class='va'>a_av</span><span class='op'>)</span><span class='op'>/</span><span class='va'>pi</span><span class='op'>)</span>
    
    
  <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span>    <span class='co'># a pos, b neg</span>
    <span class='va'>hue</span> <span class='op'>=</span> <span class='fl'>360</span> <span class='op'>+</span> <span class='fl'>180</span><span class='op'>*</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>atan</a></span><span class='op'>(</span><span class='va'>b_av</span><span class='op'>/</span><span class='va'>a_av</span><span class='op'>)</span><span class='op'>/</span><span class='va'>pi</span><span class='op'>)</span>
    
  <span class='op'>}</span>
  
<span class='op'>}</span>
</code></pre>
</div>
</div>
<h2 id="adding-calculated-chroma-and-hue-columns-to-tibble">Adding calculated chroma and hue columns to tibble</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>data_transformed</span> <span class='op'>&lt;-</span> <span class='va'>data_reshaped</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>chroma <span class='op'>=</span> <span class='fu'>map2_dbl</span><span class='op'>(</span>.x <span class='op'>=</span> <span class='va'>a_av</span>,
                           .y <span class='op'>=</span> <span class='va'>b_av</span>,
                           .f <span class='op'>=</span> <span class='va'>cal_chroma</span><span class='op'>)</span>,
         hue <span class='op'>=</span> <span class='fu'>map2_dbl</span><span class='op'>(</span>.x <span class='op'>=</span> <span class='va'>a_av</span>,
                        .y <span class='op'>=</span> <span class='va'>b_av</span>,
                        .f <span class='op'>=</span> <span class='va'>cal_hue</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>glimpse</span><span class='op'>(</span><span class='va'>data_transformed</span><span class='op'>)</span> <span class='co'># compares well with table</span>
</code></pre>
</div>
<pre><code>Rows: 25
Columns: 7
$ juices &lt;chr&gt; &quot;BJ&quot;, &quot;BJ&quot;, &quot;BJ&quot;, &quot;BJ&quot;, &quot;BJ&quot;, &quot;PBJ&quot;, &quot;PBJ&quot;, &quot;PBJ&quot;, &quot;…
$ days   &lt;dbl&gt; 0, 5, 10, 15, 30, 0, 5, 10, 15, 30, 0, 5, 10, 15, 30…
$ L_av   &lt;dbl&gt; 22.45, 22.87, 22.31, 22.37, 24.16, 22.37, 22.71, 22.…
$ a_av   &lt;dbl&gt; 0.78, 0.68, 0.74, 0.81, 1.07, 0.95, 0.82, 0.87, 0.91…
$ b_av   &lt;dbl&gt; 1.56, 1.52, 1.56, 1.57, 0.97, 1.67, 1.61, 1.63, 1.64…
$ chroma &lt;dbl&gt; 1.744133, 1.665173, 1.726615, 1.766635, 1.444230, 1.…
$ hue    &lt;dbl&gt; 63.43495, 65.89777, 64.62226, 62.70972, 42.19363, 60…</code></pre>
</div>
<h2 id="creating-initial-values-tibble-dataframe-to-calculate-de2000-later">Creating initial values tibble dataframe to calculate dE2000 later</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>initial</span> <span class='op'>&lt;-</span>  <span class='va'>data_transformed</span> <span class='op'>%&gt;%</span> 
                      <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>days</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
                      <span class='fu'>select</span><span class='op'>(</span><span class='va'>L_av</span>, <span class='va'>a_av</span>, <span class='va'>b_av</span>, <span class='va'>chroma</span>, <span class='va'>hue</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
                      <span class='fu'>rename</span><span class='op'>(</span>ini_L <span class='op'>=</span> <span class='va'>L_av</span>,
                             ini_a <span class='op'>=</span> <span class='va'>a_av</span>,
                             ini_b <span class='op'>=</span> <span class='va'>b_av</span>,
                             ini_chroma <span class='op'>=</span> <span class='va'>chroma</span>,
                             ini_hue <span class='op'>=</span> <span class='va'>hue</span><span class='op'>)</span>

<span class='va'>initial</span>
</code></pre>
</div>
<pre><code># A tibble: 5 x 5
  ini_L ini_a ini_b ini_chroma ini_hue
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;
1  22.4  0.78  1.56       1.74    63.4
2  22.4  0.95  1.67       1.92    60.4
3  33.6 -2.49 16.3       16.5     98.7
4  23.2  4.8   2.39       5.36    26.5
5  23.8  6.65  2.75       7.20    22.5</code></pre>
</div>
<h2 id="adding-the-initial-l-a-b-values-to-tibble">Adding the initial L* a* b* values to tibble</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>data_transformed_b</span><span class='op'>&lt;-</span> <span class='va'>data_transformed</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>juices</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>nest</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>bind_cols</span><span class='op'>(</span><span class='va'>initial</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>unnest</span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>data_transformed_b</span>
</code></pre>
</div>
<pre><code># A tibble: 25 x 12
# Groups:   juices [5]
   juices  days  L_av  a_av  b_av chroma   hue ini_L ini_a ini_b
   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 BJ         0  22.4  0.78  1.56   1.74  63.4  22.4  0.78  1.56
 2 BJ         5  22.9  0.68  1.52   1.67  65.9  22.4  0.78  1.56
 3 BJ        10  22.3  0.74  1.56   1.73  64.6  22.4  0.78  1.56
 4 BJ        15  22.4  0.81  1.57   1.77  62.7  22.4  0.78  1.56
 5 BJ        30  24.2  1.07  0.97   1.44  42.2  22.4  0.78  1.56
 6 PBJ        0  22.4  0.95  1.67   1.92  60.4  22.4  0.95  1.67
 7 PBJ        5  22.7  0.82  1.61   1.81  63.0  22.4  0.95  1.67
 8 PBJ       10  22.3  0.87  1.63   1.85  61.9  22.4  0.95  1.67
 9 PBJ       15  22.2  0.91  1.64   1.88  61.0  22.4  0.95  1.67
10 PBJ       30  23.7  1.19  1.21   1.70  45.5  22.4  0.95  1.67
# … with 15 more rows, and 2 more variables: ini_chroma &lt;dbl&gt;,
#   ini_hue &lt;dbl&gt;</code></pre>
</div>
<h1 id="calculating-de2000">Calculating de2000</h1>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># calculate de2000 using spacesXYZ package, input must be as matrix</span>

<span class='va'>lab_meas</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>data_transformed_b</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"L_av"</span>, <span class='st'>"a_av"</span>, <span class='st'>"b_av"</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>lab_ini</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>data_transformed_b</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"ini_L"</span>, <span class='st'>"ini_a"</span>, <span class='st'>"ini_b"</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span>

<span class='va'>data_de</span> <span class='op'>&lt;-</span> <span class='fu'>spacesXYZ</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/spacesXYZ/man/DeltaE.html'>DeltaE</a></span><span class='op'>(</span><span class='va'>lab_ini</span>, <span class='va'>lab_meas</span>, metric <span class='op'>=</span> <span class='fl'>2000</span><span class='op'>)</span>
  

<span class='va'>data_transformed_c</span> <span class='op'>&lt;-</span> <span class='va'>data_transformed_b</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>bind_cols</span><span class='op'>(</span><span class='va'>data_de</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>rename</span><span class='op'>(</span>de2000 <span class='op'>=</span> <span class='va'>...13</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='co'># remove group by juices</span>

<span class='co'># round off to 2 digits</span>
<span class='va'>data_transformed_c</span><span class='op'>$</span><span class='va'>de2000</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>data_transformed_c</span><span class='op'>$</span><span class='va'>de2000</span>, digits <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>

<span class='fu'>glimpse</span><span class='op'>(</span><span class='va'>data_transformed_c</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Rows: 25
Columns: 13
$ juices     &lt;chr&gt; &quot;BJ&quot;, &quot;BJ&quot;, &quot;BJ&quot;, &quot;BJ&quot;, &quot;BJ&quot;, &quot;PBJ&quot;, &quot;PBJ&quot;, &quot;PBJ…
$ days       &lt;dbl&gt; 0, 5, 10, 15, 30, 0, 5, 10, 15, 30, 0, 5, 10, 15…
$ L_av       &lt;dbl&gt; 22.45, 22.87, 22.31, 22.37, 24.16, 22.37, 22.71,…
$ a_av       &lt;dbl&gt; 0.78, 0.68, 0.74, 0.81, 1.07, 0.95, 0.82, 0.87, …
$ b_av       &lt;dbl&gt; 1.56, 1.52, 1.56, 1.57, 0.97, 1.67, 1.61, 1.63, …
$ chroma     &lt;dbl&gt; 1.744133, 1.665173, 1.726615, 1.766635, 1.444230…
$ hue        &lt;dbl&gt; 63.43495, 65.89777, 64.62226, 62.70972, 42.19363…
$ ini_L      &lt;dbl&gt; 22.45, 22.45, 22.45, 22.45, 22.45, 22.37, 22.37,…
$ ini_a      &lt;dbl&gt; 0.78, 0.78, 0.78, 0.78, 0.78, 0.95, 0.95, 0.95, …
$ ini_b      &lt;dbl&gt; 1.56, 1.56, 1.56, 1.56, 1.56, 1.67, 1.67, 1.67, …
$ ini_chroma &lt;dbl&gt; 1.744133, 1.744133, 1.744133, 1.744133, 1.744133…
$ ini_hue    &lt;dbl&gt; 63.43495, 63.43495, 63.43495, 63.43495, 63.43495…
$ de2000     &lt;dbl&gt; 0.00, 0.33, 0.11, 0.07, 1.42, 0.00, 0.31, 0.12, …</code></pre>
</div>
<p>The perceptible difference is defined theoretically as de2000 being greater than 2 <a href="http://zschuessler.github.io/DeltaE/learn/" class="uri">http://zschuessler.github.io/DeltaE/learn/</a>. Which samples have de2000 &gt;2?</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># threshold is de2000&gt;2</span>

<span class='va'>above_threshold</span> <span class='op'>&lt;-</span> <span class='va'>data_transformed_c</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>de2000</span><span class='op'>&gt;</span><span class='fl'>2</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>juices</span>, <span class='va'>days</span>, <span class='va'>de2000</span><span class='op'>)</span>

<span class='va'>above_threshold</span>  <span class='co'># POJ</span>
</code></pre>
</div>
<pre><code># A tibble: 5 x 3
  juices  days de2000
  &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 POJ        5   3.84
2 POJ       10   2.57
3 POJ       15   2.85
4 POJ       30   7.7 
5 BOMJ_2    30   2.76</code></pre>
</div>
<p>Color difference was already perceptible for pasteurized orange juice from day 5. For beet and orange mixed juice (1:2 v/v), the color difference was perceptibely at day 30, at the end of shelf life.</p>
<h1 id="visualization">Visualization</h1>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Reshape data to make it suitable for facetting </span>

<span class='va'>data_viz_long</span> <span class='op'>&lt;-</span> <span class='va'>data_transformed_c</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>delta_L <span class='op'>=</span> <span class='va'>L_av</span> <span class='op'>-</span> <span class='va'>ini_L</span>,
         delta_a <span class='op'>=</span> <span class='va'>a_av</span> <span class='op'>-</span> <span class='va'>ini_a</span>,
         delta_b <span class='op'>=</span> <span class='va'>b_av</span> <span class='op'>-</span> <span class='va'>ini_b</span>,
         delta_chroma <span class='op'>=</span> <span class='va'>chroma</span> <span class='op'>-</span> <span class='va'>ini_chroma</span>,
         delta_hue <span class='op'>=</span> <span class='va'>hue</span> <span class='op'>-</span> <span class='va'>ini_hue</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>juices</span>, <span class='va'>days</span>, <span class='va'>L_av</span><span class='op'>:</span><span class='va'>delta_hue</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_longer</span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>L_av</span><span class='op'>:</span><span class='va'>delta_hue</span><span class='op'>)</span>,
               names_to <span class='op'>=</span> <span class='st'>"parameters"</span>,
               values_to <span class='op'>=</span> <span class='st'>"readings"</span><span class='op'>)</span>
  

<span class='va'>data_viz_long</span>
</code></pre>
</div>
<pre><code># A tibble: 400 x 4
   juices  days parameters readings
   &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;
 1 BJ         0 L_av          22.4 
 2 BJ         0 a_av           0.78
 3 BJ         0 b_av           1.56
 4 BJ         0 chroma         1.74
 5 BJ         0 hue           63.4 
 6 BJ         0 ini_L         22.4 
 7 BJ         0 ini_a          0.78
 8 BJ         0 ini_b          1.56
 9 BJ         0 ini_chroma     1.74
10 BJ         0 ini_hue       63.4 
# … with 390 more rows</code></pre>
</div>
<h2 id="de2000">de2000</h2>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>data_viz_long</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>parameters</span> <span class='op'>==</span> <span class='st'>"de2000"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>days</span>, <span class='va'>readings</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>col <span class='op'>=</span> <span class='va'>juices</span><span class='op'>)</span>, size <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>col <span class='op'>=</span> <span class='va'>juices</span><span class='op'>)</span>, size <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_lancet</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_hline</span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='fl'>2</span>, col <span class='op'>=</span> <span class='st'>"grey77"</span>, lty <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Comparison of Total Color Difference (dE2000) when stored at 4degC for 30 days"</span>,
       x <span class='op'>=</span> <span class='st'>"Days"</span>,
       y <span class='op'>=</span> <span class='st'>"Calc. dE2000"</span>,
       subtitle <span class='op'>=</span> <span class='st'>"Pure Orange Juice (POJ) had the greatest change in color. Addition of beet juice decreases change in color difference."</span>,
       caption <span class='op'>=</span> <span class='st'>"Source: Porto et al, 2017"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_wrap</span><span class='op'>(</span><span class='op'>~</span><span class='va'>juices</span>, ncol <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_few</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>title <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>face <span class='op'>=</span> <span class='st'>"bold"</span>, size <span class='op'>=</span> <span class='fl'>16</span><span class='op'>)</span>,
        legend.position <span class='op'>=</span> <span class='st'>"none"</span>,
        strip.text <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>face <span class='op'>=</span> <span class='st'>"bold"</span>, size <span class='op'>=</span> <span class='fl'>14</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="Color-analysis-for-Juices_files/figure-html5/unnamed-chunk-11-1.png" width="1536" /></p>
</div>
<p>Whilst we know that pasteurized orange juice had perceptible color difference, what exactly was the difference due to? To answer this question, we will have to look at individual parameters (L* a* b* chroma and hue).</p>
<h2 id="understanding-each-color-parameter">Understanding each color parameter</h2>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>viz_absolute</span> <span class='op'>&lt;-</span> <span class='va'>data_viz_long</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>parameters</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"L_av"</span>, <span class='st'>"a_av"</span>, <span class='st'>"b_av"</span>, <span class='st'>"chroma"</span>, <span class='st'>"hue"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>parameters_fct <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>parameters</span>,
                                 levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"L_av"</span>, <span class='st'>"a_av"</span>, <span class='st'>"b_av"</span>, <span class='st'>"chroma"</span>, <span class='st'>"hue"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>days</span>, <span class='va'>readings</span>, group <span class='op'>=</span> <span class='va'>juices</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>col <span class='op'>=</span> <span class='va'>juices</span><span class='op'>)</span>, size <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>col <span class='op'>=</span> <span class='va'>juices</span><span class='op'>)</span>, size <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_lancet</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Change in color over shelf life period"</span>,
       caption <span class='op'>=</span> <span class='st'>"Source: Porto et al, 2017"</span>,
       col <span class='op'>=</span> <span class='st'>"Juices"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_wrap</span><span class='op'>(</span> <span class='op'>~</span> <span class='va'>parameters_fct</span>, ncol <span class='op'>=</span> <span class='fl'>5</span>, scales <span class='op'>=</span> <span class='st'>"free"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_few</span><span class='op'>(</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>title <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>face <span class='op'>=</span> <span class='st'>"bold"</span>, size <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span>,
        strip.text <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>face <span class='op'>=</span> <span class='st'>"bold"</span>, size <span class='op'>=</span> <span class='fl'>16</span><span class='op'>)</span>,
        axis.text <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>14</span><span class='op'>)</span>,
        legend.text <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>14</span><span class='op'>)</span>,
        legend.position <span class='op'>=</span> <span class='st'>"top"</span><span class='op'>)</span>

<span class='va'>viz_change</span> <span class='op'>&lt;-</span> <span class='va'>data_viz_long</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>parameters</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"delta_L"</span>, <span class='st'>"delta_a"</span>, <span class='st'>"delta_b"</span>, <span class='st'>"delta_chroma"</span>, <span class='st'>"delta_hue"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>parameters_fct <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>parameters</span>, 
                                 levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"delta_L"</span>, <span class='st'>"delta_a"</span>, <span class='st'>"delta_b"</span>, <span class='st'>"delta_chroma"</span>, <span class='st'>"delta_hue"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>days</span>, <span class='va'>readings</span>, group <span class='op'>=</span> <span class='va'>juices</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>col <span class='op'>=</span> <span class='va'>juices</span><span class='op'>)</span>, size <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>col <span class='op'>=</span> <span class='va'>juices</span><span class='op'>)</span>, size <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_lancet</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Change in color over shelf life period"</span>,
       caption <span class='op'>=</span> <span class='st'>"Source: Porto et al, 2017"</span>,
       col <span class='op'>=</span> <span class='st'>"Juices"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_wrap</span><span class='op'>(</span> <span class='op'>~</span> <span class='va'>parameters_fct</span>, ncol <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_few</span><span class='op'>(</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>title <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>face <span class='op'>=</span> <span class='st'>"bold"</span>, size <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span>,
        strip.text <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>face <span class='op'>=</span> <span class='st'>"bold"</span>, size <span class='op'>=</span> <span class='fl'>16</span><span class='op'>)</span>,
        axis.text <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>14</span><span class='op'>)</span>,
        legend.text <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>14</span><span class='op'>)</span>,
        legend.position <span class='op'>=</span> <span class='st'>"top"</span><span class='op'>)</span>

<span class='fu'>grid.arrange</span><span class='op'>(</span><span class='va'>viz_absolute</span>, <span class='va'>viz_change</span>, nrow <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="Color-analysis-for-Juices_files/figure-html5/unnamed-chunk-12-1.png" width="1920" /></p>
</div>
<h2 id="interpretation">Interpretation</h2>
<p>Beet juice is red in color and orange juice is orange-yellow in color. If we look at the L* a* b* values, from the onset, POJ had higher values for L* (ie more dark), lower a* (ie less red) and higher b* (ie more yellow). This is more easily understood by looking at the hue values, which describes the type of color (0 = red, 90 = yellow). In terms of color vividness, POJ was relatively more vivid than the other samples, and BJ and PBJ has the “dullest” color.</p>
<p>However, for total color difference, we would be more interested in the change in each parameter. POJ had a relatively large increase in L* (ie more darkening of color). For hue, there was a slight increase for POJ, but it was less in magnitude as compared to BJ and PBJ.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>data_viz_long</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>juices</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"BJ"</span>, <span class='st'>"PBJ"</span>, <span class='st'>"POJ"</span><span class='op'>)</span>,
         <span class='va'>days</span> <span class='op'>==</span> <span class='fl'>30</span>,
         <span class='va'>parameters</span> <span class='op'>==</span> <span class='st'>"delta_hue"</span><span class='op'>)</span> 
</code></pre>
</div>
<pre><code># A tibble: 3 x 4
  juices  days parameters readings
  &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;
1 BJ        30 delta_hue    -21.2 
2 PBJ       30 delta_hue    -14.9 
3 POJ       30 delta_hue      2.56</code></pre>
</div>
<p>BJ and PBJ had a decrease in hue of 21 units and 15 units. This meant that the color became less orange-red and more red. However, the change in de2000 was probably attributed to the change in L* for POJ. Even though there was a difference in hue, the total color difference was below threshold of 2 for BJ and PBJ. Color instability was mostly attributed to pasteurized orange juice, and beet juice was relatively more stable.</p>
<p>Betalains were responsible for the red color in beet, and carotenoids are responsible for the orange color in oranges (<span class="citation" data-cites="tanaka_biosynthesis_2008"><a href="#ref-tanaka_biosynthesis_2008" role="doc-biblioref">Tanaka, Sasaki, and Ohmiya</a> (<a href="#ref-tanaka_biosynthesis_2008" role="doc-biblioref">2008</a>)</span>). Fun fact: betalains color are not pH-dependent like anthocyanins, and they do not co-exist in plants.</p>
<h1 id="reflections">Reflections</h1>
<p>I am happy that I managed to write a function for hue calculation, and use existing functions to calculate de2000. The calculations were really cumbersome when done in excel.</p>
<p>When looking at color difference, it is important to look at both absolute readings and change in parameter readings to get the whole picture. The former allows you to understand what the starting point was, and the latter zooms in to the change between the start and at the end of shelf life. Although the data could be expressed in numerical form in tables, properly drawn graphs give more intuitive understanding of the data. I really like the faceting function in R, as it allows me to see all the types of juices and different color parameters clearly. In addition, the grid.arrange function allows me to display more than one graph.</p>
<p>In this shelf life study, only one temperature condition was studied. What if more than one temperature/product were looked at? In such cases, repetitive color calculations may be made more efficient by using purrr.</p>
<h1 id="links">Links</h1>
<p><a href="https://www.mdpi.com/2306-5710/3/3/36" class="uri">https://www.mdpi.com/2306-5710/3/3/36</a> <a href="https://www.xrite.com/blog/lab-color-space" class="uri">https://www.xrite.com/blog/lab-color-space</a> <a href="https://sensing.konicaminolta.us/us/blog/identifying-color-differences-using-l-a-b-or-l-c-h-coordinates/" class="uri">https://sensing.konicaminolta.us/us/blog/identifying-color-differences-using-l-a-b-or-l-c-h-coordinates/</a> <a href="https://www.konicaminolta.com/instruments/knowledge/color/pdf/color_communication.pdf" class="uri">https://www.konicaminolta.com/instruments/knowledge/color/pdf/color_communication.pdf</a> <a href="https://www.hdm-stuttgart.de/international_circle/circular/issues/13_01/ICJ_06_2013_02_069.pdf" class="uri">https://www.hdm-stuttgart.de/international_circle/circular/issues/13_01/ICJ_06_2013_02_069.pdf</a> <a href="http://zschuessler.github.io/DeltaE/learn/" class="uri">http://zschuessler.github.io/DeltaE/learn/</a></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-mclellan_hue_1995" class="csl-entry" role="doc-biblioentry">
Mclellan, M. R., L. R. Lind, and R. W. Kime. 1995. <span>“<span>HUE</span> <span>ANGLE</span> <span>DETERMINATIONS</span> <span>AND</span> <span>STATISTICAL</span> <span>ANALYSIS</span> <span>FOR</span> <span>MULTIQUADRANT</span> <span>HUNTER</span> l,a,b <span>DATA</span>.”</span> <em>Journal of Food Quality</em> 18 (3): 235–40. https://doi.org/<a href="https://doi.org/10.1111/j.1745-4557.1995.tb00377.x">https://doi.org/10.1111/j.1745-4557.1995.tb00377.x</a>.
</div>
<div id="ref-tanaka_biosynthesis_2008" class="csl-entry" role="doc-biblioentry">
Tanaka, Yoshikazu, Nobuhiro Sasaki, and Akemi Ohmiya. 2008. <span>“Biosynthesis of Plant Pigments: Anthocyanins, Betalains and Carotenoids.”</span> <em>The Plant Journal</em> 54 (4): 733–49. https://doi.org/<a href="https://doi.org/10.1111/j.1365-313X.2008.03447.x">https://doi.org/10.1111/j.1365-313X.2008.03447.x</a>.
</div>
<div id="ref-wrolstad_color_2017" class="csl-entry" role="doc-biblioentry">
Wrolstad, Ronald E., and Daniel E. Smith. 2017. <span>“Color Analysis.”</span> In <em>Food Analysis</em>, edited by S. Suzanne Nielsen, 545–55. Food Science Text Series. Cham: Springer International Publishing. <a href="https://doi.org/10.1007/978-3-319-45776-5_31">https://doi.org/10.1007/978-3-319-45776-5_31</a>.
</div>
</div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
<title>pRactice corner: High Dimension Data</title>

<meta property="description" itemprop="description" content="EdX Course"/>

<link rel="canonical" href="https://lruolin.github.io/myBlog/posts/20210810 High Dimension Data /"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2021-08-11"/>
<meta property="article:created" itemprop="dateCreated" content="2021-08-11"/>
<meta name="article:author" content="lruolin"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="pRactice corner: High Dimension Data"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="EdX Course"/>
<meta property="og:url" content="https://lruolin.github.io/myBlog/posts/20210810 High Dimension Data /"/>
<meta property="og:image" content="https://lruolin.github.io/myBlog/posts/20210810 High Dimension Data /High-Dimension-Data_files/figure-html5/unnamed-chunk-1-1.png"/>
<meta property="og:image:width" content="1248"/>
<meta property="og:image:height" content="768"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="pRactice corner"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="pRactice corner: High Dimension Data"/>
<meta property="twitter:description" content="EdX Course"/>
<meta property="twitter:url" content="https://lruolin.github.io/myBlog/posts/20210810 High Dimension Data /"/>
<meta property="twitter:image" content="https://lruolin.github.io/myBlog/posts/20210810 High Dimension Data /High-Dimension-Data_files/figure-html5/unnamed-chunk-1-1.png"/>
<meta property="twitter:image:width" content="1248"/>
<meta property="twitter:image:height" content="768"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="pRactice corner: High Dimension Data"/>
<meta name="citation_fulltext_html_url" content="https://lruolin.github.io/myBlog/posts/20210810 High Dimension Data /"/>
<meta name="citation_online_date" content="2021/08/11"/>
<meta name="citation_publication_date" content="2021/08/11"/>
<meta name="citation_author" content="lruolin"/>
<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output","editor_options","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["High Dimension Data"]},{"type":"character","attributes":{},"value":["EdX Course"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["lruolin"]}]}]},{"type":"character","attributes":{},"value":["08-11-2021"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","toc_depth"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]}]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["chunk_output_type"]}},"value":[{"type":"character","attributes":{},"value":["console"]}]},{"type":"character","attributes":{},"value":["https://lruolin.github.io/myBlog/posts/20210810 High Dimension Data /"]},{"type":"character","attributes":{},"value":["https://lruolin.github.io/myBlog/posts/20210810 High Dimension Data /"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["figure/High-Dimension-Data-point-1.png","figure/High-Dimension-Data-projection-1.png","figure/High-Dimension-Data-twin-heights-1.png","figure/High-Dimension-Data-twin-heights-rotated-1.png","figure/High-Dimension-Data-unnamed-chunk-10-1.png","figure/High-Dimension-Data-unnamed-chunk-11-1.png","High-Dimension-Data_files/anchor-4.2.2/anchor.min.js","High-Dimension-Data_files/bowser-1.9.3/bowser.min.js","High-Dimension-Data_files/distill-2.2.21/template.v2.js","High-Dimension-Data_files/figure-html5/admission_by_major-1.png","High-Dimension-Data_files/figure-html5/approx_dist-1.png","High-Dimension-Data_files/figure-html5/bayes_rule-1.png","High-Dimension-Data_files/figure-html5/bayes_rule2-1.png","High-Dimension-Data_files/figure-html5/bin_smooth_final-1.png","High-Dimension-Data_files/figure-html5/bin_smoothing_demo-1.png","High-Dimension-Data_files/figure-html5/binsmoother-1.png","High-Dimension-Data_files/figure-html5/conditional_distribution-1.png","High-Dimension-Data_files/figure-html5/conditional_prob-1.png","High-Dimension-Data_files/figure-html5/cum_variance_explained-1.png","High-Dimension-Data_files/figure-html5/D_entries-1.png","High-Dimension-Data_files/figure-html5/hard_major_confounding-1.png","High-Dimension-Data_files/figure-html5/height_hist-1.png","High-Dimension-Data_files/figure-html5/knn-1.png","High-Dimension-Data_files/figure-html5/loess_demo-1.png","High-Dimension-Data_files/figure-html5/loess_final-1.png","High-Dimension-Data_files/figure-html5/loess-1.png","High-Dimension-Data_files/figure-html5/loess2-1.png","High-Dimension-Data_files/figure-html5/MAplot_with_regression_line-1.png","High-Dimension-Data_files/figure-html5/MAplot-1.png","High-Dimension-Data_files/figure-html5/mds_same_as_svd-1.png","High-Dimension-Data_files/figure-html5/MDS-1.png","High-Dimension-Data_files/figure-html5/mds2-1.png","High-Dimension-Data_files/figure-html5/misclassification_error-1.png","High-Dimension-Data_files/figure-html5/misclassification_error2-1.png","High-Dimension-Data_files/figure-html5/PC_3_and_4-1.png","High-Dimension-Data_files/figure-html5/pca_svd-1.png","High-Dimension-Data_files/figure-html5/PCAplot-1.png","High-Dimension-Data_files/figure-html5/percent_var_explained-1.png","High-Dimension-Data_files/figure-html5/point-1.png","High-Dimension-Data_files/figure-html5/projection-1.png","High-Dimension-Data_files/figure-html5/regression_prediction-1.png","High-Dimension-Data_files/figure-html5/regression-1.png","High-Dimension-Data_files/figure-html5/rotation_preserves_dist-1.png","High-Dimension-Data_files/figure-html5/rotation-1.png","High-Dimension-Data_files/figure-html5/rotation2-1.png","High-Dimension-Data_files/figure-html5/simpsons_paradox_illustration-1.png","High-Dimension-Data_files/figure-html5/simpsons_paradox_illustration2-1.png","High-Dimension-Data_files/figure-html5/simulate_twin_heights_again-1.png","High-Dimension-Data_files/figure-html5/simulate_twin_heights-1.png","High-Dimension-Data_files/figure-html5/test_train-1.png","High-Dimension-Data_files/figure-html5/twin-heights-1.png","High-Dimension-Data_files/figure-html5/twin-heights-rotated-1.png","High-Dimension-Data_files/figure-html5/unnamed-chunk-1-1.png","High-Dimension-Data_files/figure-html5/unnamed-chunk-10-1.png","High-Dimension-Data_files/figure-html5/unnamed-chunk-28-1.png","High-Dimension-Data_files/figure-html5/unnamed-chunk-28-2.png","High-Dimension-Data_files/figure-html5/unnamed-chunk-29-1.png","High-Dimension-Data_files/figure-html5/unnamed-chunk-32-1.png","High-Dimension-Data_files/figure-html5/unnamed-chunk-34-1.png","High-Dimension-Data_files/figure-html5/unnamed-chunk-38-1.png","High-Dimension-Data_files/figure-html5/unnamed-chunk-6-1.png","High-Dimension-Data_files/figure-html5/unnamed-chunk-9-1.png","High-Dimension-Data_files/figure-html5/variance_explained-1.png","High-Dimension-Data_files/header-attrs-2.10/header-attrs.js","High-Dimension-Data_files/jquery-1.11.3/jquery.min.js","High-Dimension-Data_files/popper-2.6.0/popper.min.js","High-Dimension-Data_files/tippy-6.2.7/tippy-bundle.umd.min.js","High-Dimension-Data_files/tippy-6.2.7/tippy-light-border.css","High-Dimension-Data_files/tippy-6.2.7/tippy.css","High-Dimension-Data_files/tippy-6.2.7/tippy.umd.min.js","High-Dimension-Data_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.10/header-attrs.js"></script>
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"High Dimension Data","description":"EdX Course","authors":[{"author":"lruolin","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-08-11T00:00:00.000+00:00","citationText":"lruolin, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="../../index.html" class="title">pRactice corner</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../about.html">About</a>
<a href="../../usefullinks.html">Useful Links</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>High Dimension Data</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>EdX Course</p></p>
</div>

<div class="d-byline">
  lruolin  
  
<br/>08-11-2021
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#resources">Resources</a></li>
<li><a href="#week-1-distance">Week 1: Distance</a>
<ul>
<li><a href="#examples">Examples</a></li>
</ul></li>
<li><a href="#week-2-dimension-reduction">Week 2: Dimension Reduction</a>
<ul>
<li><a href="#dimension-reduction-motivation">Dimension Reduction Motivation</a></li>
<li><a href="#projections">Projections</a></li>
<li><a href="#rotations-1">Rotations</a></li>
<li><a href="#singular-value-decomposition">Singular Value Decomposition</a></li>
<li><a href="#multi-dimensional-scaling-plots">Multi-Dimensional Scaling Plots</a></li>
<li><a href="#principal-component-analysis">Principal Component Analysis</a></li>
</ul></li>
<li><a href="#week-3-basic-machine-learning">Week 3: Basic Machine Learning</a>
<ul>
<li><a href="#clustering">Clustering</a></li>
<li><a href="#classification">Classification</a></li>
<li><a href="#conditional-probabilities-and-expectations">Conditional Probabilities and Expectations</a></li>
<li><a href="#class-prediction">Class Prediction</a></li>
<li><a href="#smoothing">Smoothing</a></li>
<li><a href="#bin-smoothing">Bin Smoothing</a></li>
<li><a href="#loess">Loess</a></li>
<li><a href="#cross-validation">Cross-validation</a></li>
</ul></li>
<li><a href="#week-4-batch-effects">Week 4: Batch Effects</a>
<ul>
<li><a href="#confounding">Confounding</a></li>
</ul></li>
</ul>
</nav>
</div>
<p>I’m taking a course from EdX on High Dimension Data, and this is a post for me to note down the learning points and codes. I am interested in this course because I am often dealing with GC-MS data on flavor compounds found in different types of food, and I would like to carry out more high level analysis rather than just looking at percentage area for comparison. I think there is a lot that can be learnt from the life science sector in this sense, on how high dimensional data is carried out, how to apply clustering, principal component analysis.</p>
<p>Previously, I tried to use tidymodels for <a href="https://lruolin.github.io/myBlog/posts/20210123_PCA%20wine/">PCA</a>, and would like to learn other approaches as well.</p>
<p><strong>All the material below are from EdX</strong>. Most of the codes are in base R language. Personally, I find the tidymodels method more intuitive, but I can pick up the learning points on the theory behind analysing High Dimension Data, and see how the language evolved to the tidymodels method.</p>
<p>The main learning points from the course are:</p>
<ul>
<li>What is distance</li>
<li>How to calculate distance (althought the calculation part is largely taken care of by R)</li>
<li>What is projection</li>
<li>How PC uses rotation to maximise variability for dimension reduction</li>
<li>Importance of cross-validation, splitting data into training and test sets for machine learning</li>
<li>Brief glimpse into hierarchical clustering, k-means clustering, principal component analysis.</li>
<li>How confounding can give you different conclusions from the truth.</li>
</ul>
<p>After this course, I would like to revisit the tidymodels approach and revise on what I learnt previously.</p>
<h1 id="resources">Resources</h1>
<p>PH525x series - Biomedical Data Science <a href="http://genomicsclass.github.io/book/" class="uri">http://genomicsclass.github.io/book/</a></p>
<p>R &amp; Bioconductor Manual <a href="http://manuals.bioinformatics.ucr.edu/home/R_BioCondManual" class="uri">http://manuals.bioinformatics.ucr.edu/home/R_BioCondManual</a></p>
<p>Advanced R <a href="http://adv-r.had.co.nz/Data-structures.html" class="uri">http://adv-r.had.co.nz/Data-structures.html</a></p>
<p>Github for course materials <a href="http://github.com/genomicsclass/labs" class="uri">http://github.com/genomicsclass/labs</a> <a href="https://github.com/genomicsclass/labs/tree/master/highdim" class="uri">https://github.com/genomicsclass/labs/tree/master/highdim</a></p>
<h1 id="week-1-distance">Week 1: Distance</h1>
<ul>
<li><p>Clustering is a methodology that requires us to define distance. When we cluster animals into groups, in a way, we are saying which animals are closer to each other.</p></li>
<li><p>In genomics literature, heatmaps are often used. In a heatmap, on the top and on the left, dendrograms are used to show clustering.</p></li>
<li><p>It is important to define distance between both rows and columns of data.</p></li>
<li><p>For simple two dimensional data, the distance between two points can be calculated by the Pythygoras theorem.</p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>rafalib</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>1</span><span class='op'>)</span>,pch<span class='op'>=</span><span class='fl'>16</span>,cex<span class='op'>=</span><span class='fl'>2</span>,xaxt<span class='op'>=</span><span class='st'>"n"</span>,yaxt<span class='op'>=</span><span class='st'>"n"</span>,xlab<span class='op'>=</span><span class='st'>""</span>,ylab<span class='op'>=</span><span class='st'>""</span>,bty<span class='op'>=</span><span class='st'>"n"</span>,xlim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>0.25</span>,<span class='fl'>1.25</span><span class='op'>)</span>,ylim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>0.25</span>,<span class='fl'>1.25</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>1</span>,<span class='fl'>1</span>,<span class='fl'>0</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>1</span>,<span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>.2</span>,<span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>'(A'</span><span class='op'>[</span><span class='va'>x</span><span class='op'>]</span><span class='op'>*</span><span class='st'>',A'</span><span class='op'>[</span><span class='va'>y</span><span class='op'>]</span><span class='op'>*</span><span class='st'>')'</span><span class='op'>)</span><span class='op'>)</span>,cex<span class='op'>=</span><span class='fl'>1.5</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1.2</span>,<span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>'(B'</span><span class='op'>[</span><span class='va'>x</span><span class='op'>]</span><span class='op'>*</span><span class='st'>',B'</span><span class='op'>[</span><span class='va'>y</span><span class='op'>]</span><span class='op'>*</span><span class='st'>')'</span><span class='op'>)</span><span class='op'>)</span>,cex<span class='op'>=</span><span class='fl'>1.5</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>0.1</span>,<span class='fl'>0</span>,<span class='st'>"A"</span>,cex<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span><span class='op'>(</span><span class='fl'>1.1</span>,<span class='fl'>1</span>,<span class='st'>"B"</span>,cex<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="High-Dimension-Data_files/figure-html5/unnamed-chunk-1-1.png" width="624" /></p>
</div>
<p>The euclidean distance between <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> is simply:</p>
<p><span class="math display">\[\sqrt{ (A_x-B_x)^2 + (A_y-B_y)^2}\]</span></p>
<ul>
<li><p>For high dimensional data, we can’t really do that because data is not two dimensional. High dimensional data has many rows and many columns (eg thousands of gene expression measurements for dozens of samples). (For my field, it may be hundreds of flavor compounds for dozens of food samples).</p></li>
<li><p>Distance is defined for two columns (or two samples), and distance between two rows (or two features, or in this case, two genes.)</p></li>
<li><p>This is the transposed version, probably unique to genomics field. From what I learnt from ISLR previously, rows are observations (samples), and columns are features (genes, or compounds).</p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://devtools.r-lib.org/'>devtools</a></span><span class='op'>)</span>
<span class='co'># install_github("genomicsclass/tissuesGeneExpression")</span>


<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>tissuesGeneExpression</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>tissuesGeneExpression</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>e</span><span class='op'>)</span> <span class='co'>##e contains the expression data</span>
</code></pre>
</div>
<pre><code>[1] 22215   189</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>tissue</span><span class='op'>)</span> <span class='co'>##tissue[i] tells us what tissue is represented by e[,i]</span>
</code></pre>
</div>
<pre><code>tissue
 cerebellum       colon endometrium hippocampus      kidney 
         38          34          15          31          39 
      liver    placenta 
         26           6 </code></pre>
</div>
<p>If we are interested in describing distance between samples (columns), or in finding genes (rows) that behave similarly across samples.</p>
<ul>
<li>Comparing 2 columns/samples: Distance between two samples <em>i</em> and <em>j</em> would be taking the sum of the differences squared, then take the square root.</li>
</ul>
<p><span class="math display">\[
\mbox{dist}(i,j) = \sqrt{ \sum_{g=1}^{22215} (Y_{g,i}-Y_{g,j })^2 }
\]</span></p>
<ul>
<li>Comparing 2 rows/features: take the same approach above.</li>
</ul>
<p><span class="math display">\[
\mbox{dist}(h,g) = \sqrt{ \sum_{i=1}^{189} (Y_{h,i}-Y_{g,i})^2 }
\]</span> Note: In practice, distances between features are typically applied after standardizing the data for each feature.</p>
<h2 id="examples">Examples</h2>
<p>We can now use the formulas above to compute distance. Let’s compute distance between samples 1 and 2, both kidneys, and then to sample 87, a colon.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='va'>e</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span> <span class='co'># kidney</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='va'>e</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span> <span class='co'># kidney</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='va'>e</span><span class='op'>[</span>,<span class='fl'>87</span><span class='op'>]</span> <span class='co'># colon</span>
<span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>x</span><span class='op'>-</span><span class='va'>y</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 85.8546</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>x</span><span class='op'>-</span><span class='va'>z</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 122.8919</code></pre>
</div>
<p>As expected, the kidneys are closer to each other. A faster way to compute this is using matrix algebra:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span> <span class='fu'><a href='https://rdrr.io/r/base/crossprod.html'>crossprod</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>-</span><span class='va'>y</span><span class='op'>)</span> <span class='op'>)</span> <span class='co'># cross product</span>
</code></pre>
</div>
<pre><code>        [,1]
[1,] 85.8546</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span> <span class='fu'><a href='https://rdrr.io/r/base/crossprod.html'>crossprod</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>-</span><span class='va'>z</span><span class='op'>)</span> <span class='op'>)</span>
</code></pre>
</div>
<pre><code>         [,1]
[1,] 122.8919</code></pre>
</div>
<p>Now to compute all the distances at once, we have the function <code>dist</code>.</p>
<p>Because it computes the distance between each row (genes), and here we are interested in the distance between columns (samples), we transpose the matrix</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>d</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/dist.html'>dist</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>e</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># t: transpose</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span> <span class='co'># distance: not easy to work with this type of data, better to turn it into matrix</span>
</code></pre>
</div>
<pre><code>[1] &quot;dist&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># do not run d, may crash r, as it computes all pairwise distances between genes</span>
</code></pre>
</div>
</div>
<p>Note that this produces an object of class <code>dist</code> and, to access the entries using row and column indices, we need to coerce it into a matrix:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>]</span> <span class='co'># first and second sample</span>
</code></pre>
</div>
<pre><code>[1] 85.8546</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>87</span><span class='op'>]</span> <span class='co'># first and 87th sample</span>
</code></pre>
</div>
<pre><code>[1] 122.8919</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># to get color image of all the distances: 189 by 189 matrix</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<img src="High-Dimension-Data_files/figure-html5/unnamed-chunk-6-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># red is smaller and yellow is larger</span>
</code></pre>
</div>
</div>
<p>It is important to remember that if we run <code>dist</code> on <code>e</code>, it will compute all pairwise distances between genes. This will try to create a <span class="math inline">\(22215 \times 22215\)</span> matrix that may crash your R sessions.</p>
<h1 id="week-2-dimension-reduction">Week 2: Dimension Reduction</h1>
<ul>
<li><p>to reduce the dimensions of the data, but at the same time, preserving important properties, such as the distance between samples.</p></li>
<li><p>for PCA, the units in the standard statistical analysis are in the rows.</p></li>
<li><p>for genomics, the units are in the columns.</p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://yihui.org/knitr/'>knitr</a></span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="dimension-reduction-motivation">Dimension Reduction Motivation</h2>
<p>Visualizing data is one of the most, if not the most, important step in the analysis of high-throughput data. The right visualization method may reveal problems with the experimental data that can render the results from a standard analysis, although typically appropriate, completely useless.</p>
<p>We have shown methods for visualizing global properties of the columns or rows, but plots that reveal relationships between columns or between rows are more complicated due to the high dimensionality of data. Creating one single scatterplot of the data is impossible since points are very high dimensional.</p>
<p>We will describe powerful techniques for exploratory data analysis based on <em>dimension reduction</em>. The general idea is to reduce the dataset to have fewer dimensions, yet approximately preserve important properties, such as the distance between samples. If we are able to reduce down to, say, two dimensions, we can then easily make plots. The technique behind it all, the singular value decomposition (SVD), is also useful in other contexts. Before introducing the rather complicated mathematics behind the SVD, we will motivate the ideas behind it with a simple example.</p>
<h4 id="example-reducing-two-dimensions-to-one">Example: Reducing two dimensions to one</h4>
<p>We consider an example with twin heights. Here we simulate 100 two dimensional points that represent the number of standard deviations each individual is from the mean height. Each point is a pair of twins:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/simulate_twin_heights-1.png" alt="Simulated twin pair heights." width="624" />
<p class="caption">
(#fig:simulate_twin_heights)Simulated twin pair heights.
</p>
</div>
</div>
<p>To help with the illustration, think of this as high-throughput gene expression data with the twin pairs representing the <span class="math inline">\(N\)</span> samples and the two heights representing gene expression from two genes.</p>
<p>We are interested in the distance between any two samples. We can compute this using <code>dist</code>. For example, here is the distance between the two orange points in the figure above:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>d</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/dist.html'>dist</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># must transpose in this case</span>
<span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>]</span> <span class='co'># easier to work with matrix than distance objects</span>
</code></pre>
</div>
<pre><code>[1] 1.140897</code></pre>
</div>
<p>What if making two dimensional plots was too complex and we were only able to make 1 dimensional plots. Can we, for example, reduce the data to a one dimensional matrix that preserves distances between points?</p>
<p>If we look back at the plot, and visualize a line between any pair of points, the length of this line is the distance between the two points. These lines tend to go along the direction of the diagonal. We have seen before that we can “rotate” the plot so that the diagonal is in the x-axis by making a MA-plot instead:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>z1</span> <span class='op'>=</span> <span class='op'>(</span><span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span><span class='op'>+</span><span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span>,<span class='op'>]</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span> <span class='co'>#the sum </span>
<span class='va'>z2</span> <span class='op'>=</span> <span class='op'>(</span><span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span><span class='op'>-</span><span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span>,<span class='op'>]</span><span class='op'>)</span>   <span class='co'>#the difference</span>
<span class='va'>z</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span> <span class='va'>z1</span>, <span class='va'>z2</span><span class='op'>)</span> <span class='co'>#matrix now same dimensions as y</span>
<span class='va'>thelim</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>,<span class='fl'>3</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span>,<span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span>,<span class='op'>]</span>,xlab<span class='op'>=</span><span class='st'>"Twin 1 (standardized height)"</span>,
     ylab<span class='op'>=</span><span class='st'>"Twin 2 (standardized height)"</span>,
     xlim<span class='op'>=</span><span class='va'>thelim</span>,ylim<span class='op'>=</span><span class='va'>thelim</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/points.html'>points</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span>,<span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span>,<span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span>,col<span class='op'>=</span><span class='fl'>2</span>,pch<span class='op'>=</span><span class='fl'>16</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span>,<span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span>,<span class='op'>]</span>,xlim<span class='op'>=</span><span class='va'>thelim</span>,ylim<span class='op'>=</span><span class='va'>thelim</span>,xlab<span class='op'>=</span><span class='st'>"Average height"</span>,ylab<span class='op'>=</span><span class='st'>"Difference in height"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/points.html'>points</a></span><span class='op'>(</span><span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span>,<span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span>,<span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span>,col<span class='op'>=</span><span class='fl'>2</span>,pch<span class='op'>=</span><span class='fl'>16</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:rotation"></span>
<img src="High-Dimension-Data_files/figure-html5/rotation-1.png" alt="Twin height scatterplot (left) and MA-plot (right)." width="1008" />
<p class="caption">
Figure 1: Twin height scatterplot (left) and MA-plot (right).
</p>
</div>
</div>
<h4 id="rotations">Rotations</h4>
<p>In the plot above, the distance between the two orange points remains roughly the same, relative to the distance between other points. This is true for all pairs of points. A simple re-scaling of the transformation we performed above will actually make the distances exactly the same. What we will do is multiply by a scalar so that the standard deviations of each point is preserved. The calculation is such that the matrices are <em>orthogonal</em> and it guarantees the SD-preserving properties described above. The distances are now exactly preserved:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>A</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span>,<span class='fl'>1</span>,<span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>,<span class='fl'>2</span>,<span class='fl'>2</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='va'>A</span><span class='op'>%*%</span><span class='va'>y</span>
<span class='va'>d</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/dist.html'>dist</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>d2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/dist.html'>dist</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>z</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>d2</span><span class='op'>)</span><span class='op'>)</span> <span class='co'>#as.numeric turns distances into long vector</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>1</span>,col<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/rotation_preserves_dist-1.png" alt="Distance computed from original data and after rotation is the same." width="624" />
<p class="caption">
(#fig:rotation_preserves_dist)Distance computed from original data and after rotation is the same.
</p>
</div>
</div>
<p>We call this particular transformation a <em>rotation</em> of <code>y</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>
<span class='va'>thelim</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>,<span class='fl'>3</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span>,<span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span>,<span class='op'>]</span>,xlab<span class='op'>=</span><span class='st'>"Twin 1 (standardized height)"</span>,
     ylab<span class='op'>=</span><span class='st'>"Twin 2 (standardized height)"</span>,
     xlim<span class='op'>=</span><span class='va'>thelim</span>,ylim<span class='op'>=</span><span class='va'>thelim</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/points.html'>points</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span>,<span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span>,<span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span>,col<span class='op'>=</span><span class='fl'>2</span>,pch<span class='op'>=</span><span class='fl'>16</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span>,<span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span>,<span class='op'>]</span>,xlim<span class='op'>=</span><span class='va'>thelim</span>,ylim<span class='op'>=</span><span class='va'>thelim</span>,xlab<span class='op'>=</span><span class='st'>"Average height"</span>,ylab<span class='op'>=</span><span class='st'>"Difference in height"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/points.html'>points</a></span><span class='op'>(</span><span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span>,<span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span>,<span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span>,col<span class='op'>=</span><span class='fl'>2</span>,pch<span class='op'>=</span><span class='fl'>16</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:rotation2"></span>
<img src="High-Dimension-Data_files/figure-html5/rotation2-1.png" alt="Twin height scatterplot (left) and after rotation (right)." width="1008" />
<p class="caption">
Figure 2: Twin height scatterplot (left) and after rotation (right).
</p>
</div>
</div>
<p>The reason we applied this transformation in the first place was because we noticed that to compute the distances between points, we followed a direction along the diagonal in the original plot, which after the rotation falls on the horizontal, or the first dimension of <code>z</code>. So this rotation actually achieves what we originally wanted: we can preserve the distances between points with just one dimension. Let’s remove the second dimension of <code>z</code> and recompute distances:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>d3</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/dist.html'>dist</a></span><span class='op'>(</span><span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span><span class='op'>)</span> <span class='co'>##distance computed using just first dimension</span>
<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>d3</span><span class='op'>)</span><span class='op'>)</span> 
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/approx_dist-1.png" alt="Distance computed with just one dimension after rotation versus actual distance." width="624" />
<p class="caption">
(#fig:approx_dist)Distance computed with just one dimension after rotation versus actual distance.
</p>
</div>
</div>
<p>The distance computed with just the one dimension provides a very good approximation to the actual distance and a very useful dimension reduction: from 2 dimensions to 1. This first dimension of the transformed data is actually the first <em>principal component</em>. This idea motivates the use of principal component analysis (PCA) and the singular value decomposition (SVD) to achieve dimension reduction more generally.</p>
<h4 id="important-note-on-a-difference-to-other-explanations">Important note on a difference to other explanations</h4>
<p>If you search the web for descriptions of PCA, you will notice a difference in notation to how we describe it here. This mainly stems from the fact that it is more common to have rows represent units. In statistics this is also the most common way to represent the data: individuals in the rows.</p>
<p>However, for practical reasons, in genomics it is more common to represent units in the columns. For example, <strong>genes are rows and samples are columns</strong>. For this reason, in this book we explain PCA and all the math that goes with it in a slightly different way than it is usually done.</p>
<p>Basically, if you want our explanations to match others you have to <strong>transpose the matrices</strong> we show here.</p>
<h2 id="projections">Projections</h2>
<p>Now that we have described the concept of dimension reduction and some of the applications of SVD and principal component analysis, we focus on more details related to the mathematics behind these. We start with <em>projections</em>. A projection is a linear algebra concept that helps us understand many of the mathematical operations we perform on high-dimensional data. For more details, you can review projects in a linear algebra book. Here we provide a quick review and then provide some data analysis related examples.</p>
<p>As a review, remember that projections minimize the distance between points and subspace.</p>
<p>We illustrate projections using a figure, in which the arrow on top is pointing to a point in space. In this particular cartoon, the space is two dimensional, but we should be thinking abstractly. The space is represented by the Cartesian plan and the line on which the little person stands is a subspace of points. The projection to this subspace is the place that is closest to the original point. Geometry tells us that we can find this closest point by dropping a perpendicular line (dotted line) from the point to the space. The little person is standing on the projection. The amount this person had to walk from the origin to the new projected point is referred to as <em>the coordinate</em>.</p>
<p>We can plot it like this:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span> <span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>4</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>4</span><span class='op'>)</span>,xlab<span class='op'>=</span><span class='st'>"Dimension 1"</span>,ylab<span class='op'>=</span><span class='st'>"Dimension 2"</span>,type<span class='op'>=</span><span class='st'>"n"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/arrows.html'>arrows</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>2</span>,<span class='fl'>3</span>,lwd<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>3</span>,<span class='st'>" Y"</span>,pos<span class='op'>=</span><span class='fl'>4</span>,cex<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:point"></span>
<img src="High-Dimension-Data_files/figure-html5/point-1.png" alt="Geometric representation of Y." width="624" />
<p class="caption">
Figure 3: Geometric representation of Y.
</p>
</div>
</div>
<p>The following R code confirms this equation works:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>4</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>4</span><span class='op'>)</span>,xlab<span class='op'>=</span><span class='st'>"Dimension 1"</span>,ylab<span class='op'>=</span><span class='st'>"Dimension 2"</span>,type<span class='op'>=</span><span class='st'>"n"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/arrows.html'>arrows</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>2</span>,<span class='fl'>3</span>,lwd<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0.5</span>,col<span class='op'>=</span><span class='st'>"red"</span>,lwd<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span> <span class='co'>#if x=2c and y=c then slope is 0.5 (y=0.5x)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>3</span>,<span class='st'>" Y"</span>,pos<span class='op'>=</span><span class='fl'>4</span>,cex<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>
<span class='va'>y</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>3</span><span class='op'>)</span>
<span class='va'>x</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>1</span><span class='op'>)</span>
<span class='va'>cc</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/crossprod.html'>crossprod</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>y</span><span class='op'>)</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/crossprod.html'>crossprod</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/segments.html'>segments</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>*</span><span class='va'>cc</span>,<span class='va'>x</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>*</span><span class='va'>cc</span>,<span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,<span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>,lty<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>*</span><span class='va'>cc</span>,<span class='va'>x</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>*</span><span class='va'>cc</span>,<span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/grDevices/plotmath.html'>hat</a></span><span class='op'>(</span><span class='va'>Y</span><span class='op'>)</span><span class='op'>)</span>,pos<span class='op'>=</span><span class='fl'>4</span>,cex<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:projection"></span>
<img src="High-Dimension-Data_files/figure-html5/projection-1.png" alt="Projection of Y onto new subspace." width="624" />
<p class="caption">
Figure 4: Projection of Y onto new subspace.
</p>
</div>
</div>
<h2 id="rotations-1">Rotations</h2>
<p>One of the most useful applications of projections relates to coordinate rotations. In data analysis, simple rotations can result in easier to visualize and interpret data.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>rafalib</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>2</span>,<span class='fl'>4</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>2</span>,<span class='fl'>4</span><span class='op'>)</span>,xlab<span class='op'>=</span><span class='st'>"Dimension 1"</span>,ylab<span class='op'>=</span><span class='st'>"Dimension 2"</span>,
     type<span class='op'>=</span><span class='st'>"n"</span>,xaxt<span class='op'>=</span><span class='st'>"n"</span>,yaxt<span class='op'>=</span><span class='st'>"n"</span>,bty<span class='op'>=</span><span class='st'>"n"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>6</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>2</span>,<span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>2</span>,<span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>,pos<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>2</span>,<span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>6</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>2</span>,<span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>,pos<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v<span class='op'>=</span><span class='fl'>0</span>,h<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/arrows.html'>arrows</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>2</span>,<span class='fl'>3</span>,lwd<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/segments.html'>segments</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>0</span>,<span class='fl'>2</span>,<span class='fl'>3</span>,lty<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/segments.html'>segments</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>3</span>,<span class='fl'>2</span>,<span class='fl'>3</span>,lty<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>3</span>,<span class='st'>" Y"</span>,pos<span class='op'>=</span><span class='fl'>4</span>,cex<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:unnamed-chunk-9"></span>
<img src="High-Dimension-Data_files/figure-html5/unnamed-chunk-9-1.png" alt="Plot of (2,3) as coordinates along Dimension 1 (1,0) and Dimension 2 (0,1)." width="624" />
<p class="caption">
Figure 5: Plot of (2,3) as coordinates along Dimension 1 (1,0) and Dimension 2 (0,1).
</p>
</div>
</div>
<p>Graphically, we can see that the coordinates are the projections to the spaces defined by the new basis:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>rafalib</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>2</span>,<span class='fl'>4</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>2</span>,<span class='fl'>4</span><span class='op'>)</span>,xlab<span class='op'>=</span><span class='st'>"Dimension 1"</span>,ylab<span class='op'>=</span><span class='st'>"Dimension 2"</span>,
     type<span class='op'>=</span><span class='st'>"n"</span>,xaxt<span class='op'>=</span><span class='st'>"n"</span>,yaxt<span class='op'>=</span><span class='st'>"n"</span>,bty<span class='op'>=</span><span class='st'>"n"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>6</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>2</span>,<span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>2</span>,<span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>,pos<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>2</span>,<span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>6</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>2</span>,<span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>,pos<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v<span class='op'>=</span><span class='fl'>0</span>,h<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>1</span>,col<span class='op'>=</span><span class='st'>"red"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='op'>-</span><span class='fl'>1</span>,col<span class='op'>=</span><span class='st'>"red"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/arrows.html'>arrows</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>2</span>,<span class='fl'>3</span>,lwd<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>
<span class='va'>y</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>3</span><span class='op'>)</span>
<span class='va'>x1</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span><span class='co'>##new basis</span>
<span class='va'>x2</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>,<span class='op'>-</span><span class='fl'>0.5</span><span class='op'>)</span><span class='co'>##new basis</span>
<span class='va'>c1</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/crossprod.html'>crossprod</a></span><span class='op'>(</span><span class='va'>x1</span>,<span class='va'>y</span><span class='op'>)</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/crossprod.html'>crossprod</a></span><span class='op'>(</span><span class='va'>x1</span><span class='op'>)</span>
<span class='va'>c2</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/crossprod.html'>crossprod</a></span><span class='op'>(</span><span class='va'>x2</span>,<span class='va'>y</span><span class='op'>)</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/crossprod.html'>crossprod</a></span><span class='op'>(</span><span class='va'>x2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/segments.html'>segments</a></span><span class='op'>(</span><span class='va'>x1</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>*</span><span class='va'>c1</span>,<span class='va'>x1</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>*</span><span class='va'>c1</span>,<span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,<span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>,lty<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/segments.html'>segments</a></span><span class='op'>(</span><span class='va'>x2</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>*</span><span class='va'>c2</span>,<span class='va'>x2</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>*</span><span class='va'>c2</span>,<span class='va'>y</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,<span class='va'>y</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>,lty<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>3</span>,<span class='st'>" Y"</span>,pos<span class='op'>=</span><span class='fl'>4</span>,cex<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:unnamed-chunk-10"></span>
<img src="High-Dimension-Data_files/figure-html5/unnamed-chunk-10-1.png" alt="Plot of (2,3) as a vector in a rotatated space, relative to the original dimensions." width="624" />
<p class="caption">
Figure 6: Plot of (2,3) as a vector in a rotatated space, relative to the original dimensions.
</p>
</div>
</div>
<h4 id="example-twin-heights">Example: Twin heights</h4>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:twin-heights"></span>
<img src="High-Dimension-Data_files/figure-html5/twin-heights-1.png" alt="Twin 2 heights versus twin 1 heights." width="624" />
<p class="caption">
Figure 7: Twin 2 heights versus twin 1 heights.
</p>
</div>
</div>
<p>Here are the rotations:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:twin-heights-rotated"></span>
<img src="High-Dimension-Data_files/figure-html5/twin-heights-rotated-1.png" alt="Rotation of twin 2 heights versus twin 1 heights." width="624" />
<p class="caption">
Figure 8: Rotation of twin 2 heights versus twin 1 heights.
</p>
</div>
</div>
<p>What we have done here is rotate the data so that the first coordinate is the average height, while the second is the difference between twin heights.</p>
<p>We have used the singular value decomposition to find principal components. It is sometimes useful to think of the SVD as a rotation, in which the dimensions are ordered by how much variance they explain.</p>
<h2 id="singular-value-decomposition">Singular Value Decomposition</h2>
<p>In the previous section, we motivated dimension reduction and showed a transformation that permitted us to approximate the distance between two dimensional points with just one dimension.</p>
<p>The singular value decomposition (SVD) is a generalization of the algorithm we used in the motivational section.</p>
<p>As in the example, the SVD provides a transformation of the original data. This transformation has some very useful properties.</p>
<p>Applying the SVD to the motivating example we have:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>rafalib</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://www.stats.ox.ac.uk/pub/MASS4/'>MASS</a></span><span class='op'>)</span>
<span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fl'>100</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/MASS/man/mvrnorm.html'>mvrnorm</a></span><span class='op'>(</span><span class='va'>n</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>0.95</span>,<span class='fl'>0.95</span>,<span class='fl'>1</span><span class='op'>)</span>,<span class='fl'>2</span>,<span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>s</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/svd.html'>svd</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>We can immediately see that applying the SVD results in a transformation very similar to the one we used in the motivating example:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span> <span class='op'>*</span> <span class='va'>s</span><span class='op'>$</span><span class='va'>u</span> , <span class='fl'>3</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>       [,1]   [,2]
[1,] -0.982 -1.017
[2,] -1.017  0.982</code></pre>
</div>
<p>The plot we showed after the rotation was showing what we call the <em>principal components</em>: the second plotted against the first.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>PC1</span> <span class='op'>=</span> <span class='va'>s</span><span class='op'>$</span><span class='va'>d</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>*</span><span class='va'>s</span><span class='op'>$</span><span class='va'>v</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span>
<span class='va'>PC2</span> <span class='op'>=</span> <span class='va'>s</span><span class='op'>$</span><span class='va'>d</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>*</span><span class='va'>s</span><span class='op'>$</span><span class='va'>v</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>PC1</span>,<span class='va'>PC2</span>,xlim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>,<span class='fl'>3</span><span class='op'>)</span>,ylim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:PCAplot"></span>
<img src="High-Dimension-Data_files/figure-html5/PCAplot-1.png" alt="Second PC plotted against first PC for the twins height data." width="624" />
<p class="caption">
Figure 9: Second PC plotted against first PC for the twins height data.
</p>
</div>
</div>
<p>SVD is related to principal component that explicitly tries to find rotations that maximise the variability explained.</p>
<h4 id="applying-svd-to-real-dataset">Applying SVD to real dataset</h4>
<p>Let’s compute the SVD on the gene expression table we have been working with. We will take a subset of 500 genes so that computations are faster.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>tissuesGeneExpression</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>tissuesGeneExpression</span><span class='op'>)</span> <span class='co'># very big dataset: 22215 rows (genes) by 189 columns (samples)</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>

<span class='va'>ind</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>e</span><span class='op'>)</span>,<span class='fl'>500</span><span class='op'>)</span> 

<span class='va'>Y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='va'>e</span><span class='op'>[</span><span class='va'>ind</span>,<span class='op'>]</span>,<span class='fl'>1</span>,<span class='va'>scale</span><span class='op'>)</span><span class='op'>)</span> <span class='co'>#standardize data for illustration ie scaling --&gt; tidymodels is more intuitive</span>
</code></pre>
</div>
</div>
<p>The <code>svd</code> command returns the three matrices (only the diagonal entries are returned for <span class="math inline">\(D\)</span>)</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>s</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/svd.html'>svd</a></span><span class='op'>(</span><span class='va'>Y</span><span class='op'>)</span>
<span class='va'>U</span> <span class='op'>&lt;-</span> <span class='va'>s</span><span class='op'>$</span><span class='va'>u</span>
<span class='va'>V</span> <span class='op'>&lt;-</span> <span class='va'>s</span><span class='op'>$</span><span class='va'>v</span>
<span class='va'>D</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span><span class='op'>(</span><span class='va'>s</span><span class='op'>$</span><span class='va'>d</span><span class='op'>)</span> <span class='co'>##turn it into a matrix</span>
</code></pre>
</div>
</div>
<p>First note that we can in fact reconstruct y:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>Yhat</span> <span class='op'>&lt;-</span> <span class='va'>U</span> <span class='op'>%*%</span> <span class='va'>D</span> <span class='op'>%*%</span> <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>V</span><span class='op'>)</span>
<span class='va'>resid</span> <span class='op'>&lt;-</span> <span class='va'>Y</span> <span class='op'>-</span> <span class='va'>Yhat</span>
<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>resid</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 3.275158e-14</code></pre>
</div>
<p>If we look at the sum of squares, we see that the last few are quite close to 0 (perhaps we have some replicated columns).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>s</span><span class='op'>$</span><span class='va'>d</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/D_entries-1.png" alt="Entries of the diagonal of D for gene expression data." width="624" />
<p class="caption">
(#fig:D_entries)Entries of the diagonal of D for gene expression data.
</p>
</div>
</div>
<p>You commonly see this described as “explaining less variance”. This implies that for a large matrix, by the time you get to the last columns, it is possible that there is not much left to “explain” As an example, we will look at what happens if we remove the four last columns:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>k</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>U</span><span class='op'>)</span><span class='op'>-</span><span class='fl'>4</span>
<span class='va'>Yhat</span> <span class='op'>&lt;-</span> <span class='va'>U</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>k</span><span class='op'>]</span> <span class='op'>%*%</span> <span class='va'>D</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='va'>k</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>k</span><span class='op'>]</span> <span class='op'>%*%</span> <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>V</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>k</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>resid</span> <span class='op'>&lt;-</span> <span class='va'>Y</span> <span class='op'>-</span> <span class='va'>Yhat</span> 
<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>resid</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 3.275158e-14</code></pre>
</div>
<p>The largest residual is practically 0, and we need 4 fewer dimensions to transmit the information.</p>
<p>In this particular dataset, we can obtain a good approximation keeping only 94 columns. The following plots are useful for seeing how much of the variability is explained by each column:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>s</span><span class='op'>$</span><span class='va'>d</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>s</span><span class='op'>$</span><span class='va'>d</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>*</span><span class='fl'>100</span>,ylab<span class='op'>=</span><span class='st'>"Percent variability explained"</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/percent_var_explained-1.png" alt="Percent variance explained by each principal component of gene expression data." width="624" />
<p class="caption">
(#fig:percent_var_explained)Percent variance explained by each principal component of gene expression data.
</p>
</div>
</div>
<p>We can also make a cumulative plot:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='va'>s</span><span class='op'>$</span><span class='va'>d</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>s</span><span class='op'>$</span><span class='va'>d</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>*</span><span class='fl'>100</span>,ylab<span class='op'>=</span><span class='st'>"Percent variability explained"</span>,ylim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>100</span><span class='op'>)</span>,type<span class='op'>=</span><span class='st'>"l"</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/cum_variance_explained-1.png" alt="Cumulative variance explained by principal components of gene expression data." width="624" />
<p class="caption">
(#fig:cum_variance_explained)Cumulative variance explained by principal components of gene expression data.
</p>
</div>
</div>
<p>Therefore, by using only half as many dimensions, we retain most of the variability in our data:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>var</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/vector.html'>as.vector</a></span><span class='op'>(</span><span class='va'>resid</span><span class='op'>)</span><span class='op'>)</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>var</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/vector.html'>as.vector</a></span><span class='op'>(</span><span class='va'>Y</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 9.78718e-30</code></pre>
</div>
<p>We say that we explain 96% of the variability.</p>
<p>Note that we can compute this proportion from <span class="math inline">\(D\)</span>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fl'>1</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>s</span><span class='op'>$</span><span class='va'>d</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='va'>k</span><span class='op'>]</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>s</span><span class='op'>$</span><span class='va'>d</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0</code></pre>
</div>
<p>The entries of <span class="math inline">\(D\)</span> therefore tell us how much each PC contributes in term of variability explained.</p>
<h4 id="highly-correlated-data">Highly correlated data</h4>
<p>To help understand how the SVD works, we construct a dataset with two highly correlated columns.</p>
<p>For example:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m</span> <span class='op'>&lt;-</span> <span class='fl'>100</span>
<span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fl'>2</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>m</span><span class='op'>)</span>
<span class='va'>e</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>*</span><span class='va'>m</span>,<span class='fl'>0</span>,<span class='fl'>0.01</span><span class='op'>)</span>
<span class='va'>Y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>x</span><span class='op'>)</span><span class='op'>+</span><span class='va'>e</span>
<span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span><span class='op'>(</span><span class='va'>Y</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>          x         x
x 1.0000000 0.9999263
x 0.9999263 1.0000000</code></pre>
</div>
<p>The SVD helps us notice that we explain almost all the variability with just this first column:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>d</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/svd.html'>svd</a></span><span class='op'>(</span><span class='va'>Y</span><span class='op'>)</span><span class='op'>$</span><span class='va'>d</span>
<span class='va'>d</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.9999627</code></pre>
</div>
<p>In cases with many correlated columns, we can achieve great dimension reduction:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m</span> <span class='op'>&lt;-</span> <span class='fl'>100</span>
<span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fl'>25</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>m</span><span class='op'>)</span>
<span class='va'>e</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>*</span><span class='va'>m</span>,<span class='fl'>0</span>,<span class='fl'>0.01</span><span class='op'>)</span>
<span class='va'>Y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>replicate</a></span><span class='op'>(</span><span class='va'>n</span>,<span class='va'>x</span><span class='op'>)</span><span class='op'>+</span><span class='va'>e</span>
<span class='va'>d</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/svd.html'>svd</a></span><span class='op'>(</span><span class='va'>Y</span><span class='op'>)</span><span class='op'>$</span><span class='va'>d</span>
<span class='va'>d</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.9999123</code></pre>
</div>
<h2 id="multi-dimensional-scaling-plots">Multi-Dimensional Scaling Plots</h2>
<p>We will motivate multi-dimensional scaling (MDS) plots with a gene expression example. To simplify the illustration we will only consider three tissues:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>rafalib</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>tissuesGeneExpression</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>tissuesGeneExpression</span><span class='op'>)</span>
<span class='va'>colind</span> <span class='op'>&lt;-</span> <span class='va'>tissue</span><span class='op'>%in%</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"kidney"</span>,<span class='st'>"colon"</span>,<span class='st'>"liver"</span><span class='op'>)</span> <span class='co'># only these three tissues</span>
<span class='va'>mat</span> <span class='op'>&lt;-</span> <span class='va'>e</span><span class='op'>[</span>,<span class='va'>colind</span><span class='op'>]</span>
<span class='va'>group</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>tissue</span><span class='op'>[</span><span class='va'>colind</span><span class='op'>]</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>mat</span><span class='op'>)</span> <span class='co'># 22215 features</span>
</code></pre>
</div>
<pre><code>[1] 22215    99</code></pre>
</div>
<p>As an exploratory step, we wish to know if gene expression profiles stored in the columns of <code>mat</code> show more similarity between tissues than across tissues. Unfortunately, as mentioned above, we can’t plot multi-dimensional points. In general, we prefer two-dimensional plots, but making plots for every pair of genes or every pair of samples is not practical. Multi-Dimensionsal Scaling (MDS) plots become a powerful tool in this situation.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>s</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/svd.html'>svd</a></span><span class='op'>(</span><span class='va'>mat</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>rowMeans</a></span><span class='op'>(</span><span class='va'>mat</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>PC1</span> <span class='op'>&lt;-</span> <span class='va'>s</span><span class='op'>$</span><span class='va'>d</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>*</span><span class='va'>s</span><span class='op'>$</span><span class='va'>v</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span>
<span class='va'>PC2</span> <span class='op'>&lt;-</span> <span class='va'>s</span><span class='op'>$</span><span class='va'>d</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>*</span><span class='va'>s</span><span class='op'>$</span><span class='va'>v</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span>
<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>PC1</span>,<span class='va'>PC2</span>,pch<span class='op'>=</span><span class='fl'>21</span>,bg<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>group</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/legend.html'>legend</a></span><span class='op'>(</span><span class='st'>"bottomright"</span>,<span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>group</span><span class='op'>)</span>,col<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>along<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>group</span><span class='op'>)</span><span class='op'>)</span>,pch<span class='op'>=</span><span class='fl'>15</span>,cex<span class='op'>=</span><span class='fl'>1.5</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:MDS"></span>
<img src="High-Dimension-Data_files/figure-html5/MDS-1.png" alt="Multi-dimensional scaling (MDS) plot for tissue gene expression data." width="624" />
<p class="caption">
Figure 10: Multi-dimensional scaling (MDS) plot for tissue gene expression data.
</p>
</div>
</div>
<p>Note that the points separate by tissue type as expected. Now the accuracy of the approximation above depends on the proportion of variance explained by the first two principal components. As we showed above, we can quickly see this by plotting the variance explained plot:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>s</span><span class='op'>$</span><span class='va'>d</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>s</span><span class='op'>$</span><span class='va'>d</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/variance_explained-1.png" alt="Variance explained for each principal component." width="624" />
<p class="caption">
(#fig:variance_explained)Variance explained for each principal component.
</p>
</div>
</div>
<p>Although the first two PCs explain over 50% of the variability, there is plenty of information that this plot does not show. However, it is an incredibly useful plot for obtaining, via visualization, a general idea of the distance between points. Also, notice that we can plot other dimensions as well to search for patterns. Here are the 3rd and 4th PCs:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>PC3</span> <span class='op'>&lt;-</span> <span class='va'>s</span><span class='op'>$</span><span class='va'>d</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>*</span><span class='va'>s</span><span class='op'>$</span><span class='va'>v</span><span class='op'>[</span>,<span class='fl'>3</span><span class='op'>]</span>
<span class='va'>PC4</span> <span class='op'>&lt;-</span> <span class='va'>s</span><span class='op'>$</span><span class='va'>d</span><span class='op'>[</span><span class='fl'>4</span><span class='op'>]</span><span class='op'>*</span><span class='va'>s</span><span class='op'>$</span><span class='va'>v</span><span class='op'>[</span>,<span class='fl'>4</span><span class='op'>]</span>
<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>PC3</span>,<span class='va'>PC4</span>,pch<span class='op'>=</span><span class='fl'>21</span>,bg<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>group</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/legend.html'>legend</a></span><span class='op'>(</span><span class='st'>"bottomright"</span>,<span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>group</span><span class='op'>)</span>,col<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>along<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>group</span><span class='op'>)</span><span class='op'>)</span>,pch<span class='op'>=</span><span class='fl'>15</span>,cex<span class='op'>=</span><span class='fl'>1.5</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/PC_3_and_4-1.png" alt="Third and fourth principal components." width="624" />
<p class="caption">
(#fig:PC_3_and_4)Third and fourth principal components.
</p>
</div>
</div>
<p>Note that the 4th PC shows a strong separation within the kidney samples. Later we will learn about batch effects, which might explain this finding.</p>
<h4 id="cmdscale"><code>cmdscale</code></h4>
<p>Although we used the <code>svd</code> functions above, there is a special function that is specifically made for multi-dimensional scaling plots.</p>
<p>It takes a distance object as an argument and then uses principal component analysis to provide the best approximation to this distance that can be obtained with <span class="math inline">\(k\)</span> dimensions.</p>
<p>This function is more efficient because one does not have to perform the full SVD, which can be time consuming.</p>
<p>By default it returns two dimensions, but we can change that through the parameter <code>k</code> which defaults to 2.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>d</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/dist.html'>dist</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>mat</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>mds</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/cmdscale.html'>cmdscale</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>mds</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span>,<span class='va'>mds</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span>,bg<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>group</span><span class='op'>)</span>,pch<span class='op'>=</span><span class='fl'>21</span>,
     xlab<span class='op'>=</span><span class='st'>"First dimension"</span>,ylab<span class='op'>=</span><span class='st'>"Second dimension"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/legend.html'>legend</a></span><span class='op'>(</span><span class='st'>"bottomleft"</span>,<span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>group</span><span class='op'>)</span>,col<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>along<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>group</span><span class='op'>)</span><span class='op'>)</span>,pch<span class='op'>=</span><span class='fl'>15</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:mds2"></span>
<img src="High-Dimension-Data_files/figure-html5/mds2-1.png" alt="MDS computed with cmdscale function." width="624" />
<p class="caption">
Figure 11: MDS computed with cmdscale function.
</p>
</div>
</div>
<p>These two approaches are equivalent up to an arbitrary sign change.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>
<span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>mds</span><span class='op'>[</span>,<span class='va'>i</span><span class='op'>]</span>,<span class='va'>s</span><span class='op'>$</span><span class='va'>d</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>*</span><span class='va'>s</span><span class='op'>$</span><span class='va'>v</span><span class='op'>[</span>,<span class='va'>i</span><span class='op'>]</span>,main<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"PC"</span>,<span class='va'>i</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>b</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span> <span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span><span class='op'>(</span><span class='va'>mds</span><span class='op'>[</span>,<span class='va'>i</span><span class='op'>]</span>,<span class='va'>s</span><span class='op'>$</span><span class='va'>v</span><span class='op'>[</span>,<span class='va'>i</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>0</span>, <span class='fl'>1</span>, <span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='va'>b</span><span class='op'>)</span> <span class='co'>##b is 1 or -1 depending on the arbitrary sign "flip"</span>
<span class='op'>}</span>
</code></pre>
</div>
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/mds_same_as_svd-1.png" alt="Comparison of MDS first two PCs to SVD first two PCs." width="1008" />
<p class="caption">
(#fig:mds_same_as_svd)Comparison of MDS first two PCs to SVD first two PCs.
</p>
</div>
</div>
<h4 id="why-we-substract-the-mean">Why we substract the mean</h4>
<p>In all calculations above we subtract the row means before we compute the singular value decomposition.</p>
<p>We are trying to approximate the distance between columns (samples), and removing row averages reduces the total variation to make the SVD approximation better.</p>
<h2 id="principal-component-analysis">Principal Component Analysis</h2>
<p>We have already mentioned principal component analysis (PCA) above and noted its relation to the SVD. Here we provide further mathematical details.</p>
<h4 id="example-twin-heights-1">Example: Twin heights</h4>
<p>We started the motivation for dimension reduction with a simulated example and showed a rotation that is very much related to PCA.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/simulate_twin_heights_again-1.png" alt="Twin heights scatter plot." width="624" />
<p class="caption">
(#fig:simulate_twin_heights_again)Twin heights scatter plot.
</p>
</div>
</div>
<p>What are principal components (PCs)?</p>
<p>We are looking for a transformation in which the coordinates show high variability.</p>
<h4 id="the-principal-components">The principal components</h4>
<p>The orthogonal vector that maximizes the sum of squares is referred to as the first PC. The <em>weights</em> used to obtain this PC are referred to as the <em>loadings</em>. Using the language of rotations, it is also referred to as the <em>direction</em> of the first PC, which are the new coordinates.</p>
<p>To obtain the second PC, we repeat the exercise above, but for the residuals.</p>
<h4 id="prcomp"><code>prcomp</code></h4>
<p>We have shown how to obtain PCs using the SVD. However, R has a function specifically designed to find the principal components. In this case, the data is centered by default. The following function:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/prcomp.html'>prcomp</a></span><span class='op'>(</span> <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>Y</span><span class='op'>)</span> <span class='op'>)</span> <span class='co'># transposed for genomic data.</span>
</code></pre>
</div>
</div>
<p>produces the same results as the SVD up to arbitrary sign flips:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>s</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/svd.html'>svd</a></span><span class='op'>(</span> <span class='va'>Y</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>rowMeans</a></span><span class='op'>(</span><span class='va'>Y</span><span class='op'>)</span> <span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>
<span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>Y</span><span class='op'>)</span> <span class='op'>)</span><span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>pc</span><span class='op'>$</span><span class='va'>x</span><span class='op'>[</span>,<span class='va'>i</span><span class='op'>]</span>, <span class='va'>s</span><span class='op'>$</span><span class='va'>d</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>*</span><span class='va'>s</span><span class='op'>$</span><span class='va'>v</span><span class='op'>[</span>,<span class='va'>i</span><span class='op'>]</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/pca_svd-1.png" alt="Plot showing SVD and prcomp give same results." width="1008" />
<p class="caption">
(#fig:pca_svd)Plot showing SVD and prcomp give same results.
</p>
</div>
</div>
<p>The loadings can be found this way:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pc</span><span class='op'>$</span><span class='va'>rotation</span> <span class='co'># loadings</span>
</code></pre>
</div>
<pre><code>           PC1        PC2
[1,] 0.7072304  0.7069831
[2,] 0.7069831 -0.7072304</code></pre>
</div>
<p>which are equivalent (up to a sign flip) to:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>s</span><span class='op'>$</span><span class='va'>u</span>
</code></pre>
</div>
<pre><code>           [,1]       [,2]
[1,] -0.7072304 -0.7069831
[2,] -0.7069831  0.7072304</code></pre>
</div>
<p>The equivalent of the variance explained is included in the:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pc</span><span class='op'>$</span><span class='va'>sdev</span>
</code></pre>
</div>
<pre><code>[1] 1.2542672 0.2141882</code></pre>
</div>
<p>We take the transpose of <code>Y</code> because <code>prcomp</code> assumes the previously discussed ordering: units/samples in row and features in columns.</p>
<h1 id="week-3-basic-machine-learning">Week 3: Basic Machine Learning</h1>
<h2 id="clustering">Clustering</h2>
<p>Machine learning is a very broad topic and a highly active research area. In the life sciences, much of what is described as “precision medicine” is an application of machine learning to biomedical data. The general idea is to predict or discover outcomes from measured predictors. Can we discover new types of cancer from gene expression profiles? Can we predict drug response from a series of genotypes? Here we give a very brief introductions to two major machine learning components: clustering and class prediction.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>tissuesGeneExpression</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>tissuesGeneExpression</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>To illustrate the main application of clustering in the life sciences, let’s pretend that we don’t know these are different tissues and are interested in clustering. The first step is to compute the distance between each sample:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>d</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/dist.html'>dist</a></span><span class='op'>(</span> <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>e</span><span class='op'>)</span> <span class='op'>)</span>
</code></pre>
</div>
</div>
<h4 id="hierarchical-clustering">Hierarchical clustering</h4>
<p>With the distance between each pair of samples computed, we need clustering algorithms to join them into groups. Hierarchical clustering is one of the many clustering algorithms available to do this. Each sample is assigned to its own group and then the algorithm continues iteratively, joining the two most similar clusters at each step, and continuing until there is just one group.</p>
<p>While we have defined distances between samples, we have not yet defined distances between groups. There are various ways this can be done and they all rely on the individual pairwise distances. The helpfile for hclust includes detailed information.</p>
<p>We can perform hierarchical clustering based on the distances defined above using the hclust function. This function returns an hclust object that describes the groupings that were created using the algorithm described above. The plot method represents these relationships with a tree or dendrogram:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>rafalib</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>hc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/hclust.html'>hclust</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span>
<span class='va'>hc</span>
</code></pre>
</div>
<pre><code>
Call:
hclust(d = d)

Cluster method   : complete 
Distance         : euclidean 
Number of objects: 189 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>hc</span>,cex<span class='op'>=</span><span class='fl'>0.5</span><span class='op'>)</span>
</code></pre>
</div>
<img src="High-Dimension-Data_files/figure-html5/unnamed-chunk-28-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/myplclust.html'>myplclust</a></span><span class='op'>(</span><span class='va'>hc</span>, labels<span class='op'>=</span><span class='va'>tissue</span>, lab.col<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/as.fumeric.html'>as.fumeric</a></span><span class='op'>(</span><span class='va'>tissue</span><span class='op'>)</span>, cex<span class='op'>=</span><span class='fl'>0.5</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="High-Dimension-Data_files/figure-html5/unnamed-chunk-28-2.png" width="624" /></p>
</div>
<p>Visually, it does seem as if the clustering technique has discovered the tissues. However, hierarchical clustering does not define specific clusters, but rather defines the dendrogram above. From the dendrogram we can decipher the distance between any two groups by looking at the height at which the two groups split into two. To define clusters, we need to “cut the tree” at some distance and group all samples that are within that distance into groups below. To visualize this, we draw a horizontal line at the height we wish to cut and this defines that line. We use 120 as an example:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/myplclust.html'>myplclust</a></span><span class='op'>(</span><span class='va'>hc</span>, labels<span class='op'>=</span><span class='va'>tissue</span>, lab.col<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/as.fumeric.html'>as.fumeric</a></span><span class='op'>(</span><span class='va'>tissue</span><span class='op'>)</span>,cex<span class='op'>=</span><span class='fl'>0.5</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>h<span class='op'>=</span><span class='fl'>120</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="High-Dimension-Data_files/figure-html5/unnamed-chunk-29-1.png" width="624" /></p>
</div>
<p>If we use the line above to cut the tree into clusters, we can examine how the clusters overlap with the actual tissues:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>hclusters</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/cutree.html'>cutree</a></span><span class='op'>(</span><span class='va'>hc</span>, h<span class='op'>=</span><span class='fl'>120</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span>true<span class='op'>=</span><span class='va'>tissue</span>, cluster<span class='op'>=</span><span class='va'>hclusters</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>             cluster
true           1  2  3  4  5  6  7  8  9 10 11 12 13 14
  cerebellum   0  0  0  0 31  0  0  0  2  0  0  5  0  0
  colon        0  0  0  0  0  0 34  0  0  0  0  0  0  0
  endometrium  0  0  0  0  0  0  0  0  0  0 15  0  0  0
  hippocampus  0  0 12 19  0  0  0  0  0  0  0  0  0  0
  kidney       9 18  0  0  0 10  0  0  2  0  0  0  0  0
  liver        0  0  0  0  0  0  0 24  0  2  0  0  0  0
  placenta     0  0  0  0  0  0  0  0  0  0  0  0  2  4</code></pre>
</div>
<p>We can also ask cutree to give us back a given number of clusters. The function then automatically finds the height that results in the requested number of clusters:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>hclusters</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/cutree.html'>cutree</a></span><span class='op'>(</span><span class='va'>hc</span>, k<span class='op'>=</span><span class='fl'>8</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span>true<span class='op'>=</span><span class='va'>tissue</span>, cluster<span class='op'>=</span><span class='va'>hclusters</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>             cluster
true           1  2  3  4  5  6  7  8
  cerebellum   0  0 31  0  0  2  5  0
  colon        0  0  0 34  0  0  0  0
  endometrium 15  0  0  0  0  0  0  0
  hippocampus  0 12 19  0  0  0  0  0
  kidney      37  0  0  0  0  2  0  0
  liver        0  0  0  0 24  2  0  0
  placenta     0  0  0  0  0  0  0  6</code></pre>
</div>
<p>In both cases we do see that, with some exceptions, each tissue is uniquely represented by one of the clusters. In some instances, the one tissue is spread across two tissues, which is due to selecting too many clusters. Selecting the number of clusters is generally a challenging step in practice and an active area of research.</p>
<h4 id="k-means">k-means</h4>
<p>We can also cluster with the kmeans function to perform k-means clustering. As an example, let’s run k-means on the samples in the space of the first two genes:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>
<span class='va'>km</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/kmeans.html'>kmeans</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>e</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>,<span class='op'>]</span><span class='op'>)</span>, centers<span class='op'>=</span><span class='fl'>7</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>km</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;cluster&quot;      &quot;centers&quot;      &quot;totss&quot;        &quot;withinss&quot;    
[5] &quot;tot.withinss&quot; &quot;betweenss&quot;    &quot;size&quot;         &quot;iter&quot;        
[9] &quot;ifault&quot;      </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>e</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span>, <span class='va'>e</span><span class='op'>[</span><span class='fl'>2</span>,<span class='op'>]</span>, col<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/as.fumeric.html'>as.fumeric</a></span><span class='op'>(</span><span class='va'>tissue</span><span class='op'>)</span>, pch<span class='op'>=</span><span class='fl'>16</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>e</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span>, <span class='va'>e</span><span class='op'>[</span><span class='fl'>2</span>,<span class='op'>]</span>, col<span class='op'>=</span><span class='va'>km</span><span class='op'>$</span><span class='va'>cluster</span>, pch<span class='op'>=</span><span class='fl'>16</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="High-Dimension-Data_files/figure-html5/unnamed-chunk-32-1.png" width="624" /></p>
</div>
<p>In the first plot, color represents the actual tissues, while in the second, color represents the clusters that were defined by kmeans. We can see from tabulating the results that this particular clustering exercise did not perform well:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span>true<span class='op'>=</span><span class='va'>tissue</span>,cluster<span class='op'>=</span><span class='va'>km</span><span class='op'>$</span><span class='va'>cluster</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>             cluster
true           1  2  3  4  5  6  7
  cerebellum   1  0  0 13  6  4 14
  colon        3  0 22  0  6  3  0
  endometrium  3  0  0  6  0  2  4
  hippocampus  0  0  0  0 16 15  0
  kidney      10  0  2  1  0  9 17
  liver        0 18  0  7  0  0  1
  placenta     4  0  0  1  0  0  1</code></pre>
</div>
<p>This is very likely due to the fact the the first two genes are not informative regarding tissue type. We can see this in the first plot above. If we instead perform k-means clustering using all of the genes, we obtain a much improved result. To visualize this, we can use an MDS plot:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>km</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/kmeans.html'>kmeans</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>e</span><span class='op'>)</span>, centers<span class='op'>=</span><span class='fl'>7</span><span class='op'>)</span>
<span class='va'>mds</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/cmdscale.html'>cmdscale</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>mds</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span>, <span class='va'>mds</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span> 
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>mds</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span>, <span class='va'>mds</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span>, col<span class='op'>=</span><span class='va'>km</span><span class='op'>$</span><span class='va'>cluster</span>, pch<span class='op'>=</span><span class='fl'>16</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="High-Dimension-Data_files/figure-html5/unnamed-chunk-34-1.png" width="624" /></p>
</div>
<p>By tabulating the results, we see that we obtain a similar answer to that obtained with hierarchical clustering.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span>true<span class='op'>=</span><span class='va'>tissue</span>,cluster<span class='op'>=</span><span class='va'>km</span><span class='op'>$</span><span class='va'>cluster</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>             cluster
true           1  2  3  4  5  6  7
  cerebellum   0  2  0  5  0  0 31
  colon        0  0 34  0  0  0  0
  endometrium  0  0  0  0  0 15  0
  hippocampus  0  0  0 31  0  0  0
  kidney       0  2  0  0 19 18  0
  liver       24  2  0  0  0  0  0
  placenta     0  0  6  0  0  0  0</code></pre>
</div>
<h4 id="heatmaps">Heatmaps</h4>
<p>Heatmaps are ubiquitous in the genomics literature. They are very useful plots for visualizing the measurements for a subset of rows over all the samples. A dendrogram is added on top and on the side that is created with hierarchical clustering. We will demonstrate how to create heatmaps from within R. Let’s begin by defining a color palette:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>RColorBrewer</span><span class='op'>)</span> 
<span class='va'>hmcol</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/colorRamp.html'>colorRampPalette</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html'>brewer.pal</a></span><span class='op'>(</span><span class='fl'>9</span>, <span class='st'>"GnBu"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>(</span><span class='fl'>100</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Now, pick the genes with the top variance over all samples:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#if (!requireNamespace("BiocManager", quietly = TRUE))</span>
 <span class='co'>#   install.packages("BiocManager")</span>

<span class='co'># BiocManager::install("genefilter")</span>

<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>genefilter</span><span class='op'>)</span>

<span class='va'>rv</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/genefilter/man/rowSds.html'>rowVars</a></span><span class='op'>(</span><span class='va'>e</span><span class='op'>)</span>
<span class='va'>idx</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>rv</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>40</span><span class='op'>]</span>
</code></pre>
</div>
</div>
<p>While a heatmap function is included in R, we recommend the heatmap.2 function from the gplots package on CRAN because it is a bit more customized. For example, it stretches to fill the window. Here we add colors to indicate the tissue on the top:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/talgalili/gplots'>gplots</a></span><span class='op'>)</span> <span class='co'>##Available from CRAN</span>
<span class='va'>cols</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palette.html'>palette</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html'>brewer.pal</a></span><span class='op'>(</span><span class='fl'>8</span>, <span class='st'>"Dark2"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/as.fumeric.html'>as.fumeric</a></span><span class='op'>(</span><span class='va'>tissue</span><span class='op'>)</span><span class='op'>]</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>e</span><span class='op'>)</span>,<span class='va'>cols</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>                       cols     
[1,] &quot;GSM11805.CEL.gz&quot; &quot;#1B9E77&quot;
[2,] &quot;GSM11814.CEL.gz&quot; &quot;#1B9E77&quot;
[3,] &quot;GSM11823.CEL.gz&quot; &quot;#1B9E77&quot;
[4,] &quot;GSM11830.CEL.gz&quot; &quot;#1B9E77&quot;
[5,] &quot;GSM12067.CEL.gz&quot; &quot;#1B9E77&quot;
[6,] &quot;GSM12075.CEL.gz&quot; &quot;#1B9E77&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/gplots/man/heatmap.2.html'>heatmap.2</a></span><span class='op'>(</span><span class='va'>e</span><span class='op'>[</span><span class='va'>idx</span>,<span class='op'>]</span>, labCol<span class='op'>=</span><span class='va'>tissue</span>,
          trace<span class='op'>=</span><span class='st'>"none"</span>, 
          ColSideColors<span class='op'>=</span><span class='va'>cols</span>, 
          col<span class='op'>=</span><span class='va'>hmcol</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="High-Dimension-Data_files/figure-html5/unnamed-chunk-38-1.png" width="624" /></p>
</div>
<p>We did not use tissue information to create this heatmap, and we can quickly see, with just 40 genes, good separation across tissues.</p>
<h2 id="classification">Classification</h2>
<h2 id="conditional-probabilities-and-expectations">Conditional Probabilities and Expectations</h2>
<p>Prediction problems can be divided into categorical and continuous outcomes. However, many of the algorithms can be applied to both due to the connection between <em>conditional probabilities</em> and <em>conditional expectations</em>.</p>
<h4 id="regression-in-the-context-of-prediction">Regression in the context of prediction</h4>
<p>We use the son and father height example to illustrate how regression can be interpreted as a machine learning technique. In our example, we are trying to predict the son’s height (Y) based on the father’s (X). Here we have only one predictor. Now if we were asked to predict the height of a randomly selected son, we would go with the average height:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>rafalib</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>father.son</span>,package<span class='op'>=</span><span class='st'>"UsingR"</span><span class='op'>)</span>
<span class='va'>x</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>father.son</span><span class='op'>$</span><span class='va'>fheight</span><span class='op'>)</span> <span class='co'>##round to nearest inch</span>
<span class='va'>y</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>father.son</span><span class='op'>$</span><span class='va'>sheight</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>y</span>,breaks<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>,col<span class='op'>=</span><span class='st'>"red"</span>,lwd<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/height_hist-1.png" alt="Histogram of son heights." width="624" />
<p class="caption">
(#fig:height_hist)Histogram of son heights.
</p>
</div>
</div>
<p>In this case, we can also approximate the distribution of Y as normal, which implies the mean maximizes the probability density.</p>
<p>Let’s imagine that we are given more information. We are told that the father of this randomly selected son has a height of 71 inches (1.25 SDs taller than the average). What is our prediction now?</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>y</span>,xlab<span class='op'>=</span><span class='st'>"Father's height in inches"</span>,ylab<span class='op'>=</span><span class='st'>"Son's height in inches"</span>,
     main<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"correlation ="</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>signif</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>y</span><span class='op'>)</span>,<span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>0.35</span>,<span class='fl'>0.35</span><span class='op'>)</span><span class='op'>+</span><span class='fl'>71</span>,col<span class='op'>=</span><span class='st'>"red"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>[</span><span class='va'>x</span><span class='op'>==</span><span class='fl'>71</span><span class='op'>]</span>,xlab<span class='op'>=</span><span class='st'>"Heights"</span>,nc<span class='op'>=</span><span class='fl'>8</span>,main<span class='op'>=</span><span class='st'>""</span>,xlim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/range.html'>range</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/conditional_distribution-1.png" alt="Son versus father height (left) with the red lines denoting the stratum defined by conditioning on fathers being 71 inches tall. Conditional distribution: son height distribution of stratum defined by 71 inch fathers." width="1008" />
<p class="caption">
(#fig:conditional_distribution)Son versus father height (left) with the red lines denoting the stratum defined by conditioning on fathers being 71 inches tall. Conditional distribution: son height distribution of stratum defined by 71 inch fathers.
</p>
</div>
</div>
<p>The best guess is still the expectation, but our strata has changed from all the data, to only the Y with X=71. So we can stratify and take the average, which is the conditional expectation.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>y</span>,xlab<span class='op'>=</span><span class='st'>"Father's height in inches"</span>,ylab<span class='op'>=</span><span class='st'>"Son's height in inches"</span>,
     main<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"correlation ="</span>,<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>signif</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>y</span><span class='op'>)</span>,<span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>0.35</span>,<span class='fl'>0.35</span><span class='op'>)</span><span class='op'>+</span><span class='fl'>71</span>,col<span class='op'>=</span><span class='st'>"red"</span><span class='op'>)</span>
<span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>~</span><span class='va'>x</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span><span class='va'>fit</span>,col<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>[</span><span class='va'>x</span><span class='op'>==</span><span class='fl'>71</span><span class='op'>]</span>,xlab<span class='op'>=</span><span class='st'>"Heights"</span>,nc<span class='op'>=</span><span class='fl'>8</span>,main<span class='op'>=</span><span class='st'>""</span>,xlim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/range.html'>range</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v <span class='op'>=</span> <span class='va'>fit</span><span class='op'>$</span><span class='va'>coef</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>+</span> <span class='va'>fit</span><span class='op'>$</span><span class='va'>coef</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>*</span><span class='fl'>71</span>, col<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:regression"></span>
<img src="High-Dimension-Data_files/figure-html5/regression-1.png" alt="Son versus father height showing predicted heights based on regression line (left). Conditional distribution with vertical line representing regression prediction." width="1008" />
<p class="caption">
Figure 12: Son versus father height showing predicted heights based on regression line (left). Conditional distribution with vertical line representing regression prediction.
</p>
</div>
</div>
<h2 id="class-prediction">Class Prediction</h2>
<p>Here we give a brief introduction to the main task of machine learning: class prediction. In fact, many refer to class prediction as machine learning and we sometimes use the two terms interchangeably. We give a very brief introduction to this vast topic, focusing on some specific examples.</p>
<p>Some of the examples we give here are motivated by those in the excellent textbook <em>The Elements of Statistical Learning: Data Mining, Inference, and Prediction</em>, by Trevor Hastie, Robert Tibshirani and Jerome Friedman, which can be found <a href="http://statweb.stanford.edu/~tibs/ElemStatLearn/">here</a>.</p>
<p>Similar to inference in the context of regression, Machine Learning (ML) studies the relationships between outcomes <span class="math inline">\(Y\)</span> and covariates <span class="math inline">\(X\)</span>. In ML, we call <span class="math inline">\(X\)</span> the predictors or features. The main difference between ML and inference is that, in ML, we are interested mainly in predicting <span class="math inline">\(Y\)</span> using <span class="math inline">\(X\)</span>. Statistical models are used, but while in inference we estimate and interpret model parameters, in ML they are mainly a means to an end: predicting <span class="math inline">\(Y\)</span>.</p>
<p>Here we introduce the main concepts needed to understand ML, along with two specific algorithms: regression and k nearest neighbors (kNN). Keep in mind that there are dozens of popular algorithms that we do not cover here.</p>
<p>In a previous section, we covered the very simple one-predictor case. However, most of ML is concerned with cases with more than one predictor.</p>
<p>For illustration purposes, we move to a case in which <span class="math inline">\(X\)</span> is two dimensional and <span class="math inline">\(Y\)</span> is binary. We simulate a situation with a non-linear relationship using an example from the Hastie, Tibshirani and Friedman book.</p>
<p>In the plot below, we show the actual values of <span class="math inline">\(f(x_1,x_2)=E(Y \mid X_1=x_1,X_2=x_2)\)</span> using colors. The following code is used to create a relatively complex conditional probability function. We create the test and train data we use later (code not shown). Here is the plot of <span class="math inline">\(f(x_1,x_2)\)</span> with red representing values close to 1, blue representing values close to 0, and yellow values in between.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/conditional_prob-1.png" alt="Probability of Y=1 as a function of X1 and X2. Red is close to 1, yellow close to 0.5, and blue close to 0." width="624" />
<p class="caption">
(#fig:conditional_prob)Probability of Y=1 as a function of X1 and X2. Red is close to 1, yellow close to 0.5, and blue close to 0.
</p>
</div>
</div>
<p>If we show points for which <span class="math inline">\(E(Y \mid X=x)&gt;0.5\)</span> in red and the rest in blue, we see the boundary region that denotes the boundary in which we switch from predicting 0 to 1.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/bayes_rule-1.png" alt="Bayes rule. The line divides part of the space for which probability is larger than 0.5 (red) and lower than 0.5 (blue)." width="624" />
<p class="caption">
(#fig:bayes_rule)Bayes rule. The line divides part of the space for which probability is larger than 0.5 (red) and lower than 0.5 (blue).
</p>
</div>
</div>
<p>The above plots relate to the “truth” that we do not get to see. Most ML methodology is concerned with estimating <span class="math inline">\(f(x)\)</span>. A typical first step is usually to consider a sample, referred to as the training set, to estimate <span class="math inline">\(f(x)\)</span>. We will review two specific ML techniques. First, we need to review the main concept we use to evaluate the performance of these methods.</p>
<h4 id="training-and-test-sets">Training and test sets</h4>
<p>In the code (not shown) for the first plot in this chapter, we created a test and a training set. We plot them here:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#x, test, cols, and coltest were created in code that was not shown</span>
<span class='co'>#x is training x1 and x2, test is test x1 and x2</span>
<span class='co'>#cols (0=blue, 1=red) are training observations</span>
<span class='co'>#coltests are test observations</span>
<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>x</span>,pch<span class='op'>=</span><span class='fl'>21</span>,bg<span class='op'>=</span><span class='va'>cols</span>,xlab<span class='op'>=</span><span class='st'>"X1"</span>,ylab<span class='op'>=</span><span class='st'>"X2"</span>,xlim<span class='op'>=</span><span class='va'>XLIM</span>,ylim<span class='op'>=</span><span class='va'>YLIM</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>test</span>,pch<span class='op'>=</span><span class='fl'>21</span>,bg<span class='op'>=</span><span class='va'>colstest</span>,xlab<span class='op'>=</span><span class='st'>"X1"</span>,ylab<span class='op'>=</span><span class='st'>"X2"</span>,xlim<span class='op'>=</span><span class='va'>XLIM</span>,ylim<span class='op'>=</span><span class='va'>YLIM</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/test_train-1.png" alt="Training data (left) and test data (right)." width="1008" />
<p class="caption">
(#fig:test_train)Training data (left) and test data (right).
</p>
</div>
</div>
<p>You will notice that the test and train set have similar global properties since they were generated by the same random variables (more blue towards the bottom right), but are, by construction, different. The reason we create test and training sets is to detect over-training by testing on a different data than the one used to fit models or train algorithms. We will see how important this is below.</p>
<h4 id="predicting-with-regression">Predicting with regression</h4>
<p>A first naive approach to this ML problem is to fit a two variable linear regression model:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##x and y were created in the code (not shown) for the first plot</span>
<span class='co'>#y is outcome for the training set</span>
<span class='va'>X1</span> <span class='op'>&lt;-</span> <span class='va'>x</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span> <span class='co'>##these are the covariates</span>
<span class='va'>X2</span> <span class='op'>&lt;-</span> <span class='va'>x</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span> 
<span class='va'>fit1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>~</span><span class='va'>X1</span><span class='op'>+</span><span class='va'>X2</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Once we the have fitted values, we can estimate <span class="math inline">\(f(x_1,x_2)\)</span> with <span class="math inline">\(\hat{f}(x_1,x_2)=\hat{\beta}_0 + \hat{\beta}_1x_1 +\hat{\beta}_2 x_2\)</span>. To provide an actual prediction, we simply predict 1 when <span class="math inline">\(\hat{f}(x_1,x_2)&gt;0.5\)</span>. We now examine the error rates in the test and training sets and also plot the boundary region:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##prediction on train</span>
<span class='va'>yhat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>fit1</span><span class='op'>)</span>
<span class='va'>yhat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>yhat</span><span class='op'>&gt;</span><span class='fl'>0.5</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"Linear regression prediction error in train:"</span>,<span class='fl'>1</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>yhat</span><span class='op'>==</span><span class='va'>y</span><span class='op'>)</span>,<span class='st'>"\n"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Linear regression prediction error in train: 0.2975 </code></pre>
</div>
<p>We can quickly obtain predicted values for any set of values using the <code>predict</code> function:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>yhat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>fit1</span>,newdata<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>X1<span class='op'>=</span><span class='va'>newx</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span>,X2<span class='op'>=</span><span class='va'>newx</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Now we can create a plot showing where we predict 1s and where we predict 0s, as well as the boundary. We can also use the <code>predict</code> function to obtain predicted values for our test set. Note that nowhere do we fit the model on the test set:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>colshat</span> <span class='op'>&lt;-</span> <span class='va'>yhat</span>
<span class='va'>colshat</span><span class='op'>[</span><span class='va'>yhat</span><span class='op'>&gt;=</span><span class='fl'>0.5</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>mycols</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>
<span class='va'>colshat</span><span class='op'>[</span><span class='va'>yhat</span><span class='op'>&lt;</span><span class='fl'>0.5</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>mycols</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>
<span class='va'>m</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='va'>fit1</span><span class='op'>$</span><span class='va'>coef</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>/</span><span class='va'>fit1</span><span class='op'>$</span><span class='va'>coef</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span> <span class='co'>#boundary slope</span>
<span class='va'>b</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>0.5</span> <span class='op'>-</span> <span class='va'>fit1</span><span class='op'>$</span><span class='va'>coef</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span><span class='op'>/</span><span class='va'>fit1</span><span class='op'>$</span><span class='va'>coef</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span> <span class='co'>#boundary intercept</span>
<span class='co'>##prediction on test</span>
<span class='va'>yhat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>fit1</span>,newdata<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>X1<span class='op'>=</span><span class='va'>test</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span>,X2<span class='op'>=</span><span class='va'>test</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>yhat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>yhat</span><span class='op'>&gt;</span><span class='fl'>0.5</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"Linear regression prediction error in test:"</span>,<span class='fl'>1</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>yhat</span><span class='op'>==</span><span class='va'>ytest</span><span class='op'>)</span>,<span class='st'>"\n"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Linear regression prediction error in test: 0.32 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>test</span>,type<span class='op'>=</span><span class='st'>"n"</span>,xlab<span class='op'>=</span><span class='st'>"X1"</span>,ylab<span class='op'>=</span><span class='st'>"X2"</span>,xlim<span class='op'>=</span><span class='va'>XLIM</span>,ylim<span class='op'>=</span><span class='va'>YLIM</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span><span class='va'>b</span>,<span class='va'>m</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/points.html'>points</a></span><span class='op'>(</span><span class='va'>newx</span>,col<span class='op'>=</span><span class='va'>colshat</span>,pch<span class='op'>=</span><span class='fl'>16</span>,cex<span class='op'>=</span><span class='fl'>0.35</span><span class='op'>)</span>
<span class='co'>##test was created in the code (not shown) for the first plot</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/points.html'>points</a></span><span class='op'>(</span><span class='va'>test</span>,bg<span class='op'>=</span><span class='va'>cols</span>,pch<span class='op'>=</span><span class='fl'>21</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/regression_prediction-1.png" alt="We estimate the probability of 1 with a linear regression model with X1 and X2 as predictors. The resulting prediction map is divided into parts that are larger than 0.5 (red) and lower than 0.5 (blue)." width="624" />
<p class="caption">
(#fig:regression_prediction)We estimate the probability of 1 with a linear regression model with X1 and X2 as predictors. The resulting prediction map is divided into parts that are larger than 0.5 (red) and lower than 0.5 (blue).
</p>
</div>
</div>
<p>The error rates in the test and train sets are quite similar. Thus, we do not seem to be over-training. This is not surprising as we are fitting a 2 parameter model to 400 data points. However, note that the boundary is a line. Because we are fitting a plane to the data, there is no other option here. The linear regression method is too rigid. The rigidity makes it stable and avoids over-training, but it also keeps the model from adapting to the non-linear relationship between <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span>. We saw this before in the smoothing section. The next ML technique we consider is similar to the smoothing techniques described before.</p>
<h4 id="k-nearest-neighbor">K-nearest neighbor</h4>
<p>K-nearest neighbors (kNN) is similar to bin smoothing, but it is easier to adapt to multiple dimensions. Basically, for any point <span class="math inline">\(x\)</span> for which we want an estimate, we look for the k nearest points and then take an average of these points. This gives us an estimate of <span class="math inline">\(f(x_1,x_2)\)</span>, just like the bin smoother gave us an estimate of a curve. We can now control flexibility through <span class="math inline">\(k\)</span>. Here we compare <span class="math inline">\(k=1\)</span> and <span class="math inline">\(k=100\)</span>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://www.stats.ox.ac.uk/pub/MASS4/'>class</a></span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>2</span><span class='op'>)</span>
<span class='kw'>for</span><span class='op'>(</span><span class='va'>k</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>100</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
  <span class='co'>##predict on train</span>
  <span class='va'>yhat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/class/man/knn.html'>knn</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>x</span>,<span class='va'>y</span>,k<span class='op'>=</span><span class='va'>k</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"KNN prediction error in train:"</span>,<span class='fl'>1</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>yhat</span><span class='op'>)</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>==</span><span class='va'>y</span><span class='op'>)</span>,<span class='st'>"\n"</span><span class='op'>)</span>
  <span class='co'>##make plot</span>
  <span class='va'>yhat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/class/man/knn.html'>knn</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>test</span>,<span class='va'>y</span>,k<span class='op'>=</span><span class='va'>k</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"KNN prediction error in test:"</span>,<span class='fl'>1</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>yhat</span><span class='op'>)</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>==</span><span class='va'>ytest</span><span class='op'>)</span>,<span class='st'>"\n"</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
<pre><code>KNN prediction error in train: 0 
KNN prediction error in test: 0.3375 
KNN prediction error in train: 0.2725 
KNN prediction error in test: 0.3125 </code></pre>
</div>
<p>To visualize why we make no errors in the train set and many errors in the test set when <span class="math inline">\(k=1\)</span> and obtain more stable results from <span class="math inline">\(k=100\)</span>, we show the prediction regions (code not shown):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:knn"></span>
<img src="High-Dimension-Data_files/figure-html5/knn-1.png" alt="Prediction regions obtained with kNN for k=1 (top) and k=200 (bottom). We show both train (left) and test data (right)." width="1008" />
<p class="caption">
Figure 13: Prediction regions obtained with kNN for k=1 (top) and k=200 (bottom). We show both train (left) and test data (right).
</p>
</div>
</div>
<p>When <span class="math inline">\(k=1\)</span>, we make no mistakes in the training test since every point is its closest neighbor and it is equal to itself. However, we see some islands of blue in the red area that, once we move to the test set, are more error prone. In the case <span class="math inline">\(k=100\)</span>, we do not have this problem and we also see that we improve the error rate over linear regression. We can also see that our estimate of <span class="math inline">\(f(x_1,x_2)\)</span> is closer to the truth.</p>
<h4 id="bayes-rule">Bayes rule</h4>
<p>Here we include a comparison of the test and train set errors for various values of <span class="math inline">\(k\)</span>. We also include the error rate that we would make if we actually knew <span class="math inline">\(\mbox{E}(Y \mid X_1=x1,X_2=x_2)\)</span> referred to as <em>Bayes Rule</em>.</p>
<p>We start by computing the error rates…</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>###Bayes Rule</span>
<span class='va'>yhat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='va'>test</span>,<span class='fl'>1</span>,<span class='va'>p</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"Bayes rule prediction error in train"</span>,<span class='fl'>1</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>yhat</span><span class='op'>)</span><span class='op'>==</span><span class='va'>y</span><span class='op'>)</span>,<span class='st'>"\n"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Bayes rule prediction error in train 0.2825 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>bayes.error</span><span class='op'>=</span><span class='fl'>1</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>yhat</span><span class='op'>)</span><span class='op'>==</span><span class='va'>y</span><span class='op'>)</span>
<span class='va'>train.error</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>16</span><span class='op'>)</span>
<span class='va'>test.error</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>16</span><span class='op'>)</span>
<span class='kw'>for</span><span class='op'>(</span><span class='va'>k</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>along<span class='op'>=</span><span class='va'>train.error</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
  <span class='co'>##predict on train</span>
  <span class='va'>yhat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/class/man/knn.html'>knn</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>x</span>,<span class='va'>y</span>,k<span class='op'>=</span><span class='fl'>2</span><span class='op'>^</span><span class='op'>(</span><span class='va'>k</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>train.error</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>yhat</span><span class='op'>)</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>==</span><span class='va'>y</span><span class='op'>)</span>
  <span class='co'>##prediction on test    </span>
  <span class='va'>yhat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/class/man/knn.html'>knn</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>test</span>,<span class='va'>y</span>,k<span class='op'>=</span><span class='fl'>2</span><span class='op'>^</span><span class='op'>(</span><span class='va'>k</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>test.error</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>yhat</span><span class='op'>)</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>==</span><span class='va'>y</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>… and then plot the error rates against values of <span class="math inline">\(k\)</span>. We also show the Bayes rules error rate as a horizontal line.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ks</span> <span class='op'>&lt;-</span> <span class='fl'>2</span><span class='op'>^</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>along<span class='op'>=</span><span class='va'>train.error</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>ks</span>,<span class='va'>train.error</span>,type<span class='op'>=</span><span class='st'>"n"</span>,xlab<span class='op'>=</span><span class='st'>"K"</span>,ylab<span class='op'>=</span><span class='st'>"Prediction Error"</span>,log<span class='op'>=</span><span class='st'>"x"</span>,
     ylim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/range.html'>range</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>test.error</span>,<span class='va'>train.error</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>ks</span>,<span class='va'>train.error</span>,type<span class='op'>=</span><span class='st'>"b"</span>,col<span class='op'>=</span><span class='fl'>4</span>,lty<span class='op'>=</span><span class='fl'>2</span>,lwd<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>ks</span>,<span class='va'>test.error</span>,type<span class='op'>=</span><span class='st'>"b"</span>,col<span class='op'>=</span><span class='fl'>5</span>,lty<span class='op'>=</span><span class='fl'>3</span>,lwd<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>h<span class='op'>=</span><span class='va'>bayes.error</span>,col<span class='op'>=</span><span class='fl'>6</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/legend.html'>legend</a></span><span class='op'>(</span><span class='st'>"bottomright"</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Train"</span>,<span class='st'>"Test"</span>,<span class='st'>"Bayes"</span><span class='op'>)</span>,col<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>,<span class='fl'>5</span>,<span class='fl'>6</span><span class='op'>)</span>,lty<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>3</span>,<span class='fl'>1</span><span class='op'>)</span>,box.lwd<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/bayes_rule2-1.png" alt="Prediction error in train (pink) and test (green) versus number of neighbors. The yellow line represents what one obtains with Bayes Rule." width="624" />
<p class="caption">
(#fig:bayes_rule2)Prediction error in train (pink) and test (green) versus number of neighbors. The yellow line represents what one obtains with Bayes Rule.
</p>
</div>
</div>
<p>Note that these error rates are random variables and have standard errors. In the next section we describe cross-validation which helps reduce some of this variability. However, even with this variability, the plot clearly shows the problem of over-fitting when using values lower than 20 and under-fitting with values above 100.</p>
<h2 id="smoothing">Smoothing</h2>
<p>Smoothing is a very powerful technique used all across data analysis. It is designed to estimate <span class="math inline">\(f(x)\)</span> when the shape is unknown, but assumed to be <em>smooth</em>. The general idea is to group data points that are expected to have similar expectations and compute the average, or fit a simple parametric model. We illustrate two smoothing techniques using a gene expression example.</p>
<p>The following data are gene expression measurements from replicated RNA samples.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##Following three packages are available from Bioconductor</span>

<span class='co'># if (!requireNamespace("BiocManager", quietly = TRUE))</span>
  <span class='co'>#  install.packages("BiocManager")</span>

<span class='co'># BiocManager::install("Biobase")</span>
<span class='co'># BiocManager::install("SpikeIn")</span>
<span class='co'># BiocManager::install("hgu95acdf")</span>

<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://bioconductor.org/packages/Biobase'>Biobase</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>SpikeIn</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>hgu95acdf</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>SpikeIn95</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>We consider the data used in an MA-plot comparing two replicated samples (<span class="math inline">\(Y\)</span> = log ratios and <span class="math inline">\(X\)</span> = averages) and take down-sample in a way that balances the number of points for different strata of <span class="math inline">\(X\)</span> (code not shown):</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>rafalib</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>X</span>,<span class='va'>Y</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:MAplot"></span>
<img src="High-Dimension-Data_files/figure-html5/MAplot-1.png" alt="MA-plot comparing gene expression from two arrays." width="1008" />
<p class="caption">
Figure 14: MA-plot comparing gene expression from two arrays.
</p>
</div>
</div>
<p>In the MA plot we see that <span class="math inline">\(Y\)</span> depends on <span class="math inline">\(X\)</span>. This dependence must be a bias because these are based on replicates, which means <span class="math inline">\(Y\)</span> should be 0 on average regardless of <span class="math inline">\(X\)</span>. We want to predict <span class="math inline">\(f(x)=\mbox{E}(Y \mid X=x)\)</span> so that we can remove this bias. Linear regression does not capture the apparent curvature in <span class="math inline">\(f(x)\)</span>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>X</span>,<span class='va'>Y</span><span class='op'>)</span>
<span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>Y</span><span class='op'>~</span><span class='va'>X</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/points.html'>points</a></span><span class='op'>(</span><span class='va'>X</span>,<span class='va'>Y</span>,pch<span class='op'>=</span><span class='fl'>21</span>,bg<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>Y</span><span class='op'>&gt;</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>fitted</span>,<span class='fl'>1</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span><span class='va'>fit</span>,col<span class='op'>=</span><span class='fl'>2</span>,lwd<span class='op'>=</span><span class='fl'>4</span>,lty<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/MAplot_with_regression_line-1.png" alt="MA-plot comparing gene expression from two arrays with fitted regression line. The two colors represent positive and negative residuals." width="1008" />
<p class="caption">
(#fig:MAplot_with_regression_line)MA-plot comparing gene expression from two arrays with fitted regression line. The two colors represent positive and negative residuals.
</p>
</div>
</div>
<p>The points above the fitted line (green) and those below (purple) are not evenly distributed. We therefore need an alternative more flexible approach.</p>
<h2 id="bin-smoothing">Bin Smoothing</h2>
<p>Instead of fitting a line, let’s go back to the idea of stratifying and computing the mean. This is referred to as <em>bin smoothing</em>. The general idea is that the underlying curve is “smooth” enough so that, in small bins, the curve is approximately constant. If we assume the curve is constant, then all the <span class="math inline">\(Y\)</span> in that bin have the same expected value. For example, in the plot below, we highlight points in a bin centered at 8.6, as well as the points of a bin centered at 12.1, if we use bins of size 1. We also show the fitted mean values for the <span class="math inline">\(Y\)</span> in those bins with dashed lines (code not shown):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:binsmoother"></span>
<img src="High-Dimension-Data_files/figure-html5/binsmoother-1.png" alt="MAplot comparing gene expression from two arrays with bin smoother fit shown for two points." width="1008" />
<p class="caption">
Figure 15: MAplot comparing gene expression from two arrays with bin smoother fit shown for two points.
</p>
</div>
</div>
<p>By computing this mean for bins around every point, we form an estimate of the underlying curve <span class="math inline">\(f(x)\)</span>. Below we show the procedure happening as we move from the smallest value of <span class="math inline">\(x\)</span> to the largest. We show 10 intermediate cases as well (code not shown):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/bin_smoothing_demo-1.png" alt="Illustration of how bin smoothing estimates a curve. Showing 12 steps of process." width="984" />
<p class="caption">
(#fig:bin_smoothing_demo)Illustration of how bin smoothing estimates a curve. Showing 12 steps of process.
</p>
</div>
</div>
<p>The final result looks like this (code not shown):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/bin_smooth_final-1.png" alt="MA-plot with curve obtained with bin-smoothed curve shown." width="1008" />
<p class="caption">
(#fig:bin_smooth_final)MA-plot with curve obtained with bin-smoothed curve shown.
</p>
</div>
</div>
<p>There are several functions in R that implement bin smoothers. One example is <code>ksmooth</code>. However, in practice, we typically prefer methods that use slightly more complicated models than fitting a constant. The final result above, for example, is somewhat wiggly. Methods such as <code>loess</code>, which we explain next, improve on this.</p>
<h2 id="loess">Loess</h2>
<p>Local weighted regression (loess) is similar to bin smoothing in principle. The main difference is that we approximate the local behavior with a line or a parabola. This permits us to expand the bin sizes, which stabilizes the estimates. Below we see lines fitted to two bins that are slightly larger than those we used for the bin smoother (code not shown). We can use larger bins because fitting lines provide slightly more flexibility.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:loess"></span>
<img src="High-Dimension-Data_files/figure-html5/loess-1.png" alt="MA-plot comparing gene expression from two arrays with bin local regression fit shown for two points." width="1008" />
<p class="caption">
Figure 16: MA-plot comparing gene expression from two arrays with bin local regression fit shown for two points.
</p>
</div>
</div>
<p>As we did for the bin smoother, we show 12 steps of the process that leads to a loess fit (code not shown):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/loess_demo-1.png" alt="Illustration of how loess estimates a curve. Showing 12 steps of the process." width="984" />
<p class="caption">
(#fig:loess_demo)Illustration of how loess estimates a curve. Showing 12 steps of the process.
</p>
</div>
</div>
<p>The final result is a smoother fit than the bin smoother since we use larger sample sizes to estimate our local parameters (code not shown):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/loess_final-1.png" alt="MA-plot with curve obtained with loess." width="1008" />
<p class="caption">
(#fig:loess_final)MA-plot with curve obtained with loess.
</p>
</div>
</div>
<p>The function <code>loess</code> performs this analysis for us:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/loess.html'>loess</a></span><span class='op'>(</span><span class='va'>Y</span><span class='op'>~</span><span class='va'>X</span>, degree<span class='op'>=</span><span class='fl'>1</span>, span<span class='op'>=</span><span class='fl'>1</span><span class='op'>/</span><span class='fl'>3</span><span class='op'>)</span>
<span class='va'>newx</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>)</span>,len<span class='op'>=</span><span class='fl'>100</span><span class='op'>)</span> 
<span class='va'>smooth</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>fit</span>,newdata<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>X<span class='op'>=</span><span class='va'>newx</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span> <span class='op'>(</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>X</span>,<span class='va'>Y</span>,col<span class='op'>=</span><span class='st'>"darkgrey"</span>,pch<span class='op'>=</span><span class='fl'>16</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>newx</span>,<span class='va'>smooth</span>,col<span class='op'>=</span><span class='st'>"black"</span>,lwd<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:loess2"></span>
<img src="High-Dimension-Data_files/figure-html5/loess2-1.png" alt="Loess fitted with the loess function." width="984" />
<p class="caption">
Figure 17: Loess fitted with the loess function.
</p>
</div>
</div>
<p>There are three other important differences between <code>loess</code> and the typical bin smoother. The first is that rather than keeping the bin size the same, <code>loess</code> keeps the number of points used in the local fit the same. This number is controlled via the <code>span</code> argument which expects a proportion. For example, if <code>N</code> is the number of data points and <code>span=0.5</code>, then for a given <span class="math inline">\(x\)</span> , <code>loess</code> will use the <code>0.5*N</code> closest points to <span class="math inline">\(x\)</span> for the fit. The second difference is that, when fitting the parametric model to obtain <span class="math inline">\(f(x)\)</span>, <code>loess</code> uses weighted least squares, with higher weights for points that are closer to <span class="math inline">\(x\)</span>. The third difference is that <code>loess</code> has the option of fitting the local model robustly. An iterative algorithm is implemented in which, after fitting a model in one iteration, outliers are detected and downweighted for the next iteration. To use this option, we use the argument <code>family="symmetric"</code>.</p>
<h2 id="cross-validation">Cross-validation</h2>
<p>Here we describe <em>cross-validation</em>: one of the fundamental methods in machine learning for method assessment and picking parameters in a prediction or machine learning task. Suppose we have a set of observations with many features and each observation is associated with a label. We will call this set our training data. Our task is to predict the label of any new samples by learning patterns from the training data. For a concrete example, let’s consider gene expression values, where each gene acts as a feature. We will be given a new set of unlabeled data (the test data) with the task of predicting the tissue type of the new samples.</p>
<p>If we choose a machine learning algorithm with a tunable parameter, we have to come up with a strategy for picking an optimal value for this parameter. We could try some values, and then just choose the one which performs the best on our training data, in terms of the number of errors the algorithm would make if we apply it to the samples we have been given for training. However, we have seen how this leads to over-fitting.</p>
<p>Let’s start by loading the tissue gene expression dataset:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>tissuesGeneExpression</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>tissuesGeneExpression</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>For illustration purposes, we will drop one of the tissues which doesn’t have many samples:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>tissue</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>tissue
 cerebellum       colon endometrium hippocampus      kidney 
         38          34          15          31          39 
      liver    placenta 
         26           6 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ind</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>tissue</span> <span class='op'>!=</span> <span class='st'>"placenta"</span><span class='op'>)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='va'>tissue</span><span class='op'>[</span><span class='va'>ind</span><span class='op'>]</span>
<span class='va'>X</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span> <span class='va'>e</span><span class='op'>[</span>,<span class='va'>ind</span><span class='op'>]</span> <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>This tissue will not form part of our example.</p>
<p>Now let’s try out k-nearest neighbors for classification, using <span class="math inline">\(k=5\)</span>. What is our average error in predicting the tissue in the training set, when we’ve used the same data for training and for testing?</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://www.stats.ox.ac.uk/pub/MASS4/'>class</a></span><span class='op'>)</span>
<span class='va'>pred</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/class/man/knn.html'>knn</a></span><span class='op'>(</span>train <span class='op'>=</span>  <span class='va'>X</span>, test <span class='op'>=</span> <span class='va'>X</span>, cl<span class='op'>=</span><span class='va'>y</span>, k<span class='op'>=</span><span class='fl'>5</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>!=</span> <span class='va'>pred</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0</code></pre>
</div>
<p>We have no errors in prediction in the training set with <span class="math inline">\(k=5\)</span>. What if we use <span class="math inline">\(k=1\)</span>?</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pred</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/class/man/knn.html'>knn</a></span><span class='op'>(</span>train<span class='op'>=</span><span class='va'>X</span>, test<span class='op'>=</span><span class='va'>X</span>, cl<span class='op'>=</span><span class='va'>y</span>, k<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>!=</span> <span class='va'>pred</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0</code></pre>
</div>
<p>Trying to classify the same observations as we use to <em>train</em> the model can be very misleading. In fact, for k-nearest neighbors, using k=1 will always give 0 classification error in the training set, because we use the single observation to classify itself. The reliable way to get a sense of the performance of an algorithm is to make it give a prediction for a sample it has never seen. Similarly, if we want to know what the best value for a tunable parameter is, we need to see how different values of the parameter perform on samples, which are not in the training data.</p>
<p>Cross-validation is a widely-used method in machine learning, which solves this training and test data problem, while still using all the data for testing the predictive accuracy. It accomplishes this by splitting the data into a number of <em>folds</em>. If we have <span class="math inline">\(N\)</span> folds, then the first step of the algorithm is to train the algorithm using <span class="math inline">\((N-1)\)</span> of the folds, and test the algorithm’s accuracy on the single left-out fold. This is then repeated N times until each fold has been used as in the <em>test</em> set. If we have <span class="math inline">\(M\)</span> parameter settings to try out, then this is accomplished in an outer loop, so we have to fit the algorithm a total of <span class="math inline">\(N \times M\)</span> times.</p>
<p>We will use the <code>createFolds</code> function from the <code>caret</code> package to make 5 folds of our gene expression data, which are balanced over the tissues. Don’t be confused by the fact that the <code>createFolds</code> function uses the same letter ‘k’ as the ‘k’ in k-nearest neighbors. These ‘k’ are totally unrelated. The caret function <code>createFolds</code> is asking for how many folds to create, the <span class="math inline">\(N\)</span> from above. The ‘k’ in the <code>knn</code> function is for how many closest observations to use in classifying a new sample. Here we will create 10 folds:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/topepo/caret/'>caret</a></span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>
<span class='va'>idx</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/createDataPartition.html'>createFolds</a></span><span class='op'>(</span><span class='va'>y</span>, k<span class='op'>=</span><span class='fl'>10</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='va'>idx</span>, <span class='va'>length</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Fold01 Fold02 Fold03 Fold04 Fold05 Fold06 Fold07 Fold08 Fold09 Fold10 
    19     19     18     18     19     18     20     16     16     20 </code></pre>
</div>
<p>The folds are returned as a list of numeric indices. The first fold of data is therefore:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>y</span><span class='op'>[</span><span class='va'>idx</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>]</span> <span class='co'>##the labels</span>
</code></pre>
</div>
<pre><code> [1] &quot;kidney&quot;      &quot;hippocampus&quot; &quot;hippocampus&quot; &quot;hippocampus&quot;
 [5] &quot;cerebellum&quot;  &quot;cerebellum&quot;  &quot;cerebellum&quot;  &quot;kidney&quot;     
 [9] &quot;kidney&quot;      &quot;kidney&quot;      &quot;colon&quot;       &quot;colon&quot;      
[13] &quot;colon&quot;       &quot;liver&quot;       &quot;endometrium&quot; &quot;endometrium&quot;
[17] &quot;liver&quot;       &quot;liver&quot;       &quot;cerebellum&quot; </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span> <span class='va'>X</span><span class='op'>[</span><span class='va'>idx</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>, <span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>]</span> <span class='op'>)</span> <span class='co'>##the genes (only showing the first 3 genes...)</span>
</code></pre>
</div>
<pre><code>                1007_s_at  1053_at   117_at
GSM12105.CEL.gz  9.913031 6.337478 7.983850
GSM21209.cel.gz 11.667431 5.785190 7.666343
GSM21215.cel.gz 10.361340 5.663634 7.328729
GSM21218.cel.gz 10.757734 5.984170 8.525524
GSM87066.cel.gz  9.746007 5.886079 7.459517
GSM87085.cel.gz  9.864295 5.753874 7.712646</code></pre>
</div>
<p>We can see that, in fact, the tissues are fairly equally represented across the 10 folds:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='va'>idx</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>i</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>            Fold01 Fold02 Fold03 Fold04 Fold05 Fold06 Fold07 Fold08
cerebellum       4      4      4      4      4      3      4      3
colon            3      4      4      3      3      3      4      3
endometrium      2      1      1      1      2      2      2      1
hippocampus      3      3      3      3      3      3      3      3
kidney           4      4      4      4      4      4      4      4
liver            3      3      2      3      3      3      3      2
            Fold09 Fold10
cerebellum       4      4
colon            3      4
endometrium      1      2
hippocampus      3      4
kidney           3      4
liver            2      2</code></pre>
</div>
<p>Because tissues have very different gene expression profiles, predicting tissue with all genes will be very easy. For illustration purposes we will try to predict tissue type with just two dimensional data. We will reduce the dimension of our data using <code>cmdscale</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>rafalib</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>Xsmall</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/cmdscale.html'>cmdscale</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/dist.html'>dist</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>Xsmall</span>,col<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/as.fumeric.html'>as.fumeric</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/legend.html'>legend</a></span><span class='op'>(</span><span class='st'>"topleft"</span>,<span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span>,fill<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_along</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span id="fig:mds"></span>
<img src="High-Dimension-Data_files/figure-html5/MDS-1.png" alt="First two PCs of the tissue gene expression data with color representing tissue. We use these two PCs as our two predictors throughout." width="624" />
<p class="caption">
Figure 18: First two PCs of the tissue gene expression data with color representing tissue. We use these two PCs as our two predictors throughout.
</p>
</div>
</div>
<p>Now we can try out the k-nearest neighbors method on a single fold. We provide the <code>knn</code> function with all the samples in <code>Xsmall</code> <em>except</em> those which are in the first fold. We remove these samples using the code <code>-idx[[1]]</code> inside the square brackets. We then use those samples in the test set. The <code>cl</code> argument is for the true classifications or labels (here, tissue) of the training data. We use 5 observations to classify in our k-nearest neighbor algorithm:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pred</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/class/man/knn.html'>knn</a></span><span class='op'>(</span>train<span class='op'>=</span><span class='va'>Xsmall</span><span class='op'>[</span> <span class='op'>-</span><span class='va'>idx</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span> , <span class='op'>]</span>, test<span class='op'>=</span><span class='va'>Xsmall</span><span class='op'>[</span> <span class='va'>idx</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>, <span class='op'>]</span>, cl<span class='op'>=</span><span class='va'>y</span><span class='op'>[</span> <span class='op'>-</span><span class='va'>idx</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>]</span>, k<span class='op'>=</span><span class='fl'>5</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span>true<span class='op'>=</span><span class='va'>y</span><span class='op'>[</span> <span class='va'>idx</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>]</span>, <span class='va'>pred</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>             pred
true          cerebellum colon endometrium hippocampus kidney liver
  cerebellum           4     0           0           0      0     0
  colon                0     2           0           0      1     0
  endometrium          0     0           2           0      0     0
  hippocampus          2     0           0           1      0     0
  kidney               0     0           0           0      4     0
  liver                0     0           0           0      0     3</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>[</span> <span class='va'>idx</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>]</span> <span class='op'>!=</span> <span class='va'>pred</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.1578947</code></pre>
</div>
<p>Now we have some misclassifications. How well do we do for the rest of the folds?</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>pred</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/class/man/knn.html'>knn</a></span><span class='op'>(</span>train<span class='op'>=</span><span class='va'>Xsmall</span><span class='op'>[</span> <span class='op'>-</span><span class='va'>idx</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> , <span class='op'>]</span>, test<span class='op'>=</span><span class='va'>Xsmall</span><span class='op'>[</span> <span class='va'>idx</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span>, <span class='op'>]</span>, cl<span class='op'>=</span><span class='va'>y</span><span class='op'>[</span> <span class='op'>-</span><span class='va'>idx</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>]</span>, k<span class='op'>=</span><span class='fl'>5</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>i</span>,<span class='st'>") error rate: "</span>, <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>[</span> <span class='va'>idx</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>]</span> <span class='op'>!=</span> <span class='va'>pred</span><span class='op'>)</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
<pre><code>[1] &quot;1) error rate: 0.158&quot;
[1] &quot;2) error rate: 0.158&quot;
[1] &quot;3) error rate: 0.278&quot;
[1] &quot;4) error rate: 0.167&quot;
[1] &quot;5) error rate: 0.158&quot;
[1] &quot;6) error rate: 0.167&quot;
[1] &quot;7) error rate: 0.25&quot;
[1] &quot;8) error rate: 0.188&quot;
[1] &quot;9) error rate: 0.062&quot;
[1] &quot;10) error rate: 0.1&quot;</code></pre>
</div>
<p>So we can see there is some variation for each fold, with error rates hovering around 0.1-0.3. But is <code>k=5</code> the best setting for the k parameter? In order to explore the best setting for k, we need to create an outer loop, where we try different values for k, and then calculate the average test set error across all the folds.</p>
<p>We will try out each value of k from 1 to 12. Instead of using two <code>for</code> loops, we will use <code>sapply</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>
<span class='va'>ks</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>12</span>
<span class='va'>res</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='va'>ks</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>k</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'>##try out each version of k from 1 to 12</span>
  <span class='va'>res.k</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_along</a></span><span class='op'>(</span><span class='va'>idx</span><span class='op'>)</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>i</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='co'>##loop over each of the 10 cross-validation folds</span>
    <span class='co'>##predict the held-out samples using k nearest neighbors</span>
    <span class='va'>pred</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/class/man/knn.html'>knn</a></span><span class='op'>(</span>train<span class='op'>=</span><span class='va'>Xsmall</span><span class='op'>[</span> <span class='op'>-</span><span class='va'>idx</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span>, <span class='op'>]</span>,
                test<span class='op'>=</span><span class='va'>Xsmall</span><span class='op'>[</span> <span class='va'>idx</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span>, <span class='op'>]</span>,
                cl<span class='op'>=</span><span class='va'>y</span><span class='op'>[</span> <span class='op'>-</span><span class='va'>idx</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>]</span>, k <span class='op'>=</span> <span class='va'>k</span><span class='op'>)</span>
    <span class='co'>##the ratio of misclassified samples</span>
    <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>[</span> <span class='va'>idx</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>]</span> <span class='op'>!=</span> <span class='va'>pred</span><span class='op'>)</span>
  <span class='op'>}</span><span class='op'>)</span>
  <span class='co'>##average over the 10 folds</span>
  <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>res.k</span><span class='op'>)</span>
<span class='op'>}</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Now for each value of k, we have an associated test set error rate from the cross-validation procedure.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>res</span>
</code></pre>
</div>
<pre><code> [1] 0.1882164 0.1692032 0.1694664 0.1639108 0.1511184 0.1586184
 [7] 0.1589108 0.1865058 0.1880482 0.1714108 0.1759795 0.1744664</code></pre>
</div>
<p>We can then plot the error rate for each value of k, which helps us to see in what region there might be a minimal error rate:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>ks</span>, <span class='va'>res</span>, type<span class='op'>=</span><span class='st'>"o"</span>,ylab<span class='op'>=</span><span class='st'>"misclassification error"</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/misclassification_error-1.png" alt="Misclassification error versus number of neighbors." width="624" />
<p class="caption">
(#fig:misclassification_error)Misclassification error versus number of neighbors.
</p>
</div>
</div>
<p>Remember, because the training set is a random sample and because our fold-generation procedure involves random number generation, the “best” value of k we pick through this procedure is also a random variable. If we had new training data and if we recreated our folds, we might get a different value for the optimal k.</p>
<p>Finally, to show that gene expression can perfectly predict tissue, we use 5 dimensions instead of 2, which results in perfect prediction:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>Xsmall</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/cmdscale.html'>cmdscale</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/dist.html'>dist</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>)</span>,k<span class='op'>=</span><span class='fl'>5</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>
<span class='va'>ks</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>12</span>
<span class='va'>res</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='va'>ks</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>k</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>res.k</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_along</a></span><span class='op'>(</span><span class='va'>idx</span><span class='op'>)</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>i</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>pred</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/class/man/knn.html'>knn</a></span><span class='op'>(</span>train<span class='op'>=</span><span class='va'>Xsmall</span><span class='op'>[</span> <span class='op'>-</span><span class='va'>idx</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span>, <span class='op'>]</span>,
                test<span class='op'>=</span><span class='va'>Xsmall</span><span class='op'>[</span> <span class='va'>idx</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span>, <span class='op'>]</span>,
                cl<span class='op'>=</span><span class='va'>y</span><span class='op'>[</span> <span class='op'>-</span><span class='va'>idx</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>]</span>, k <span class='op'>=</span> <span class='va'>k</span><span class='op'>)</span>
    <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>[</span> <span class='va'>idx</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>]</span> <span class='op'>!=</span> <span class='va'>pred</span><span class='op'>)</span>
  <span class='op'>}</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>res.k</span><span class='op'>)</span>
<span class='op'>}</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>ks</span>, <span class='va'>res</span>, type<span class='op'>=</span><span class='st'>"o"</span>,ylim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0.20</span><span class='op'>)</span>,ylab<span class='op'>=</span><span class='st'>"misclassification error"</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/misclassification_error2-1.png" alt="Misclassification error versus number of neighbors when we use 5 dimensions instead of 2." width="624" />
<p class="caption">
(#fig:misclassification_error2)Misclassification error versus number of neighbors when we use 5 dimensions instead of 2.
</p>
</div>
</div>
<p>Important note: we applied <code>cmdscale</code> to the entire dataset to create a smaller one for illustration purposes. However, in a real machine learning application, this may result in an underestimation of test set error for small sample sizes, where dimension reduction using the unlabeled full dataset gives a boost in performance. A safer choice would have been to transform the data separately for each fold, by calculating a rotation and dimension reduction using the training set only and applying this to the test set.</p>
<h1 id="week-4-batch-effects">Week 4: Batch Effects</h1>
<h2 id="confounding">Confounding</h2>
<p>Batch effects have the most devastating effects when they are <em>confounded</em> with outcomes of interest. Here we describe confounding and how it relates to data interpretation.</p>
<p>“Correlation is not causation” is one of the most important lessons you should take from this or any other data analysis course. A common example for why this statement is so often true is confounding. Simply stated confounding occurs when we observe a correlation or association between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, but this is strictly the result of both <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> depending on an extraneous variable <span class="math inline">\(Z\)</span>. Here we describe Simpson’s paradox, an example based on a famous legal case, and an example of confounding in high-throughput biology.</p>
<h4 id="example-of-simpsons-paradox">Example of Simpson’s Paradox</h4>
<p>Admission data from U.C. Berkeley 1973 showed that more men were being admitted than women: 44% men were admitted compared to 30% women.See: PJ Bickel, EA Hammel, and JW O’Connell. Science (1975). Here is the data:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#install_github("genomicsclass/dagdata")</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>dagdata</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>admissions</span><span class='op'>)</span>
<span class='va'>admissions</span><span class='op'>$</span><span class='va'>total</span><span class='op'>=</span><span class='va'>admissions</span><span class='op'>$</span><span class='va'>Percent</span><span class='op'>*</span><span class='va'>admissions</span><span class='op'>$</span><span class='va'>Number</span><span class='op'>/</span><span class='fl'>100</span>
<span class='co'>##percent men get in</span>
<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>admissions</span><span class='op'>$</span><span class='va'>total</span><span class='op'>[</span><span class='va'>admissions</span><span class='op'>$</span><span class='va'>Gender</span><span class='op'>==</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>admissions</span><span class='op'>$</span><span class='va'>Number</span><span class='op'>[</span><span class='va'>admissions</span><span class='op'>$</span><span class='va'>Gender</span><span class='op'>==</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.4451951</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##percent women get in</span>
<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>admissions</span><span class='op'>$</span><span class='va'>total</span><span class='op'>[</span><span class='va'>admissions</span><span class='op'>$</span><span class='va'>Gender</span><span class='op'>==</span><span class='fl'>0</span><span class='op'>]</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>admissions</span><span class='op'>$</span><span class='va'>Number</span><span class='op'>[</span><span class='va'>admissions</span><span class='op'>$</span><span class='va'>Gender</span><span class='op'>==</span><span class='fl'>0</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.3033351</code></pre>
</div>
<p>A chi-square test clearly rejects the hypothesis that gender and admission are independent:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>##make a 2 x 2 table</span>
<span class='va'>index</span> <span class='op'>=</span> <span class='va'>admissions</span><span class='op'>$</span><span class='va'>Gender</span><span class='op'>==</span><span class='fl'>1</span>
<span class='va'>men</span> <span class='op'>=</span> <span class='va'>admissions</span><span class='op'>[</span><span class='va'>index</span>,<span class='op'>]</span>
<span class='va'>women</span> <span class='op'>=</span> <span class='va'>admissions</span><span class='op'>[</span><span class='op'>!</span><span class='va'>index</span>,<span class='op'>]</span>
<span class='va'>menYes</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>men</span><span class='op'>$</span><span class='va'>Number</span><span class='op'>*</span><span class='va'>men</span><span class='op'>$</span><span class='va'>Percent</span><span class='op'>/</span><span class='fl'>100</span><span class='op'>)</span>
<span class='va'>menNo</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>men</span><span class='op'>$</span><span class='va'>Number</span><span class='op'>*</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>-</span><span class='va'>men</span><span class='op'>$</span><span class='va'>Percent</span><span class='op'>/</span><span class='fl'>100</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>womenYes</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>women</span><span class='op'>$</span><span class='va'>Number</span><span class='op'>*</span><span class='va'>women</span><span class='op'>$</span><span class='va'>Percent</span><span class='op'>/</span><span class='fl'>100</span><span class='op'>)</span>
<span class='va'>womenNo</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>women</span><span class='op'>$</span><span class='va'>Number</span><span class='op'>*</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>-</span><span class='va'>women</span><span class='op'>$</span><span class='va'>Percent</span><span class='op'>/</span><span class='fl'>100</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>tab</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>menYes</span>,<span class='va'>womenYes</span>,<span class='va'>menNo</span>,<span class='va'>womenNo</span><span class='op'>)</span>,<span class='fl'>2</span>,<span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/chisq.test.html'>chisq.test</a></span><span class='op'>(</span><span class='va'>tab</span><span class='op'>)</span><span class='op'>$</span><span class='va'>p.val</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 9.139492e-22</code></pre>
</div>
<p>But closer inspection shows a paradoxical result. Here are the percent admissions by major:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>y</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>admissions</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>6</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span>,<span class='va'>admissions</span><span class='op'>[</span><span class='fl'>7</span><span class='op'>:</span><span class='fl'>12</span>,<span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Male"</span>,<span class='st'>"Female"</span><span class='op'>)</span>
<span class='va'>y</span>
</code></pre>
</div>
<pre><code>  Major Male Female
1     A   62     82
2     B   63     68
3     C   37     34
4     D   33     35
5     E   28     24
6     F    6      7</code></pre>
</div>
<p>Notice that we no longer see a clear gender bias. The chi-square test we performed above suggests a dependence between admission and gender. Yet when the data is grouped by major, this dependence seems to disappear. What’s going on?</p>
<p>This is an example of <em>Simpson’s paradox</em>. A plot showing the percentages that applied to a major against the percent that get into that major, for males and females starts to point to an explanation.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>y</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>admissions</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>6</span>,<span class='fl'>5</span><span class='op'>]</span>,<span class='va'>admissions</span><span class='op'>[</span><span class='fl'>7</span><span class='op'>:</span><span class='fl'>12</span>,<span class='fl'>5</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>y</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/sweep.html'>sweep</a></span><span class='op'>(</span><span class='va'>y</span>,<span class='fl'>2</span>,<span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colSums</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>,<span class='st'>"/"</span><span class='op'>)</span><span class='op'>*</span><span class='fl'>100</span>
<span class='va'>x</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>rowMeans</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>admissions</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>6</span>,<span class='fl'>3</span><span class='op'>]</span>,<span class='va'>admissions</span><span class='op'>[</span><span class='fl'>7</span><span class='op'>:</span><span class='fl'>12</span>,<span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>rafalib</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/rafalib/man/mypar.html'>mypar</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/matplot.html'>matplot</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>y</span>,xlab<span class='op'>=</span><span class='st'>"percent that gets in the major"</span>,
        ylab<span class='op'>=</span><span class='st'>"percent that applies to major"</span>,
        col<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"blue"</span>,<span class='st'>"red"</span><span class='op'>)</span>,cex<span class='op'>=</span><span class='fl'>1.5</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/legend.html'>legend</a></span><span class='op'>(</span><span class='st'>"topleft"</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Male"</span>,<span class='st'>"Female"</span><span class='op'>)</span>,col<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"blue"</span>,<span class='st'>"red"</span><span class='op'>)</span>,pch<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"1"</span>,<span class='st'>"2"</span><span class='op'>)</span>,box.lty<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/hard_major_confounding-1.png" alt="Percent of students that applied versus percent that were admitted by gender." width="624" />
<p class="caption">
(#fig:hard_major_confounding)Percent of students that applied versus percent that were admitted by gender.
</p>
</div>
</div>
<p>What the plot suggests is that males were much more likely to apply to “easy” majors. The plot shows that males and “easy” majors are confounded.</p>
<h4 id="confounding-explained-graphically">Confounding explained graphically</h4>
<p>Here we visualize the confounding. In the plots below, each letter represents a person. Accepted individuals are denoted in green and not admitted in orange. The letter indicates the major. In this first plot we group all the students together and notice that the proportion of green is larger for men.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/simpsons_paradox_illustration-1.png" alt="Admitted are in green and majors are denoted with letters. Here we clearly see that more males were admitted." width="1008" />
<p class="caption">
(#fig:simpsons_paradox_illustration)Admitted are in green and majors are denoted with letters. Here we clearly see that more males were admitted.
</p>
</div>
</div>
<p>Now we stratify the data by major. The key point here is that most of the accepted men (green) come from the easy majors: A and B.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/simpsons_paradox_illustration2-1.png" alt="Simpon's Paradox illustrated. Admitted students are in green. Students are now stratified by the major to which they applied." width="1008" />
<p class="caption">
(#fig:simpsons_paradox_illustration2)Simpon’s Paradox illustrated. Admitted students are in green. Students are now stratified by the major to which they applied.
</p>
</div>
</div>
<h4 id="average-after-stratifying">Average after stratifying</h4>
<p>In this plot, we can see that if we condition or stratify by major, and then look at differences, we control for the confounder and this effect goes away.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>y</span><span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>admissions</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>6</span>,<span class='fl'>3</span><span class='op'>]</span>,<span class='va'>admissions</span><span class='op'>[</span><span class='fl'>7</span><span class='op'>:</span><span class='fl'>12</span>,<span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/matplot.html'>matplot</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>6</span>,<span class='va'>y</span>,xaxt<span class='op'>=</span><span class='st'>"n"</span>,xlab<span class='op'>=</span><span class='st'>"major"</span>,ylab<span class='op'>=</span><span class='st'>"percent"</span>,col<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"blue"</span>,<span class='st'>"red"</span><span class='op'>)</span>,cex<span class='op'>=</span><span class='fl'>1.5</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/axis.html'>axis</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>:</span><span class='fl'>6</span>,<span class='va'>LETTERS</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>6</span><span class='op'>]</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/legend.html'>legend</a></span><span class='op'>(</span><span class='st'>"topright"</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Male"</span>,<span class='st'>"Female"</span><span class='op'>)</span>,col<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"blue"</span>,<span class='st'>"red"</span><span class='op'>)</span>,pch<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"1"</span>,<span class='st'>"2"</span><span class='op'>)</span>,
       box.lty<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure">
<img src="High-Dimension-Data_files/figure-html5/admission_by_major-1.png" alt="Admission percentage by major for each gender." width="624" />
<p class="caption">
(#fig:admission_by_major)Admission percentage by major for each gender.
</p>
</div>
</div>
<p>The average difference by major is actually 3.5% higher for women.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span><span class='op'>-</span><span class='va'>y</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] -3.5</code></pre>
</div>
<h4 id="simpsons-paradox-in-baseball">Simpson’s Paradox in baseball</h4>
<p>Simpson’s Paradox is commonly seen in baseball statistics. Here is a well known example in which David Justice had a higher batting average than Derek Jeter in both 1995 and 1996, but Jeter had a higher overall average:</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>1995</th>
<th>1996</th>
<th>Combined</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Derek Jeter</td>
<td>12/48 (.250)</td>
<td>183/582 (.314)</td>
<td>195/630 (.310)</td>
</tr>
<tr class="even">
<td>David Justice</td>
<td>104/411 (.253)</td>
<td>45/140 (.321)</td>
<td>149/551 (.270)</td>
</tr>
</tbody>
</table>
<p>The confounder here is games played. Jeter played more games during the year he batted better, while the opposite is true for Justice.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<div class="article-footer">
  <p class="social_footer">
    <span class="disqus-comments">
      <i class="fas fa-comments"></i>
      &nbsp;
      <span class="disqus-comment-count" data-disqus-identifier="posts/20210810 High Dimension Data /">Comment on this article</span>
    </span>
    <span class="article-sharing">
      Share: &nbsp;
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Flruolin.github.io%2FmyBlog%2Fposts%2F20210810%20High%20Dimension%20Data%20%2F&amp;title=High%20Dimension%20Data">
        <i class="fab fa-linkedin"></i>
      </a>
    </span>
  </p>
  <script id="dsq-count-scr" src="https://https-lruolin-github-io-myblog-2.disqus.com/count.js" async></script>
  <div id="disqus_thread" class="hidden"></div>
  <script type="text/javascript" cookie-consent="functionality">
var disqus_config = function () {
  this.page.url = 'https://lruolin.github.io/myBlog/posts/20210810 High Dimension Data /';
  this.page.identifier = 'posts/20210810 High Dimension Data /';
};
(function() {
  var d = document, s = d.createElement('script');
  s.src = 'https://https-lruolin-github-io-myblog-2.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
</script>
</div>
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">lruolin (2021, Aug. 11). pRactice corner: High Dimension Data. Retrieved from https://lruolin.github.io/myBlog/posts/20210810 High Dimension Data /</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{lruolin2021high,
  author = {lruolin, },
  title = {pRactice corner: High Dimension Data},
  url = {https://lruolin.github.io/myBlog/posts/20210810 High Dimension Data /},
  year = {2021}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
<title>pRactice corner: Meat NIR data</title>

<meta property="description" itemprop="description" content="PLS regression on Meat NIR data"/>

<link rel="canonical" href="https://lruolin.github.io/myBlog/posts/20210328_NIR Meat Data (PLS-regression)/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2021-03-18"/>
<meta property="article:created" itemprop="dateCreated" content="2021-03-18"/>
<meta name="article:author" content="lruolin"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="pRactice corner: Meat NIR data"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="PLS regression on Meat NIR data"/>
<meta property="og:url" content="https://lruolin.github.io/myBlog/posts/20210328_NIR Meat Data (PLS-regression)/"/>
<meta property="og:image" content="https://lruolin.github.io/myBlog/posts/20210328_NIR Meat Data (PLS-regression)/Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-3-1.png"/>
<meta property="og:image:width" content="1248"/>
<meta property="og:image:height" content="768"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="pRactice corner"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="pRactice corner: Meat NIR data"/>
<meta property="twitter:description" content="PLS regression on Meat NIR data"/>
<meta property="twitter:url" content="https://lruolin.github.io/myBlog/posts/20210328_NIR Meat Data (PLS-regression)/"/>
<meta property="twitter:image" content="https://lruolin.github.io/myBlog/posts/20210328_NIR Meat Data (PLS-regression)/Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-3-1.png"/>
<meta property="twitter:image:width" content="1248"/>
<meta property="twitter:image:height" content="768"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="pRactice corner: Meat NIR data"/>
<meta name="citation_fulltext_html_url" content="https://lruolin.github.io/myBlog/posts/20210328_NIR Meat Data (PLS-regression)/"/>
<meta name="citation_online_date" content="2021/03/18"/>
<meta name="citation_publication_date" content="2021/03/18"/>
<meta name="citation_author" content="lruolin"/>
<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Meat NIR data"]},{"type":"character","attributes":{},"value":["PLS regression on Meat NIR data"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["lruolin"]}]}]},{"type":"character","attributes":{},"value":["03-18-2021"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"character","attributes":{},"value":["https://lruolin.github.io/myBlog/posts/20210328_NIR Meat Data (PLS-regression)/"]},{"type":"character","attributes":{},"value":["https://lruolin.github.io/myBlog/posts/20210328_NIR Meat Data (PLS-regression)/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-13-1.png","Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-16-1.png","Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-17-1.png","Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-17-2.png","Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-17-3.png","Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-17-4.png","Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-18-1.png","Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-18-2.png","Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-18-3.png","Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-18-4.png","Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-19-1.png","Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-19-2.png","Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-19-3.png","Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-19-4.png","Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-3-1.png","Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-5-1.png","Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-6-1.png","Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-9-1.png"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      if ($(this).children()[0].nodeName == "D-FOOTNOTE") {
        var fn = $(this).children()[0]
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        return "<p>" + $('#ref-' + ref).html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.7/header-attrs.js"></script>
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Meat NIR data","description":"PLS regression on Meat NIR data","authors":[{"author":"lruolin","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-03-18T00:00:00.000+08:00","citationText":"lruolin, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="../../index.html" class="title">pRactice corner</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../about.html">About</a>
<a href="../../usefullinks.html">Useful Links</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Meat NIR data</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>PLS regression on Meat NIR data</p></p>
</div>

<div class="d-byline">
  lruolin  
  
<br/>03-18-2021
</div>

<div class="d-article">
<h1 id="background">Background</h1>
<p>This example provides the workflow for analysing NIR data spectra to predict the fat, water and protein content of meat.</p>
<h1 id="workflow">Workflow</h1>
<ul>
<li>Exploratory Data Analysis</li>
<li>PCA for dimension reduction/exploratory to determine the effective dimension of the dataset.</li>
<li>Split dataset into TRAINING and TESTING dataset. Split training dataset into cross validation dataset.</li>
<li>Data processing for training dataset, with the understanding the PLS regression will be used for modeling. Data should be centered and scaled, especially if the predictors are on scales of different magnitude.</li>
<li>Build model: In this case, PLS-regression will be used, due to high correlation among X variables; and also because the number of X variables is greater than the number of samples.</li>
<li>Assess model for cross-validation dataset, and tune to select optimal number of PC to be retained. Resampling techniques include k-fold cross validation, Leave One Out (LOO) cross validation and bootstrapping. For large datasets, 10-fold CV would suffice. For small datasets, <strong>repeated 10-fold CV</strong> is recommended. For very small datasets (n&lt;50), LOO is recommended.</li>
<li>Assess model on TESTING dataset</li>
<li>Visualization of model performance - number of components to be retained and model coefficients, observed vs predicted values (indicator of accuracy)</li>
<li>For models with more than 1 Y variable, the PLS1 approach is taken: each Y outcome has its own tuned model.</li>
<li>Reporting model coefficients</li>
<li>Assessing variable importance, using variable importance scores. As a rule of thumb, VIP values exceeding 1 are considered to contain predictive information for the outcome, Y.</li>
</ul>
<h1 id="pls-regression---theory">PLS regression - Theory</h1>
<p>One of the many advantages of PLS is that it can handle many noisy, collinear (correlated) and missing variables, and can also simultaneously model several response variables Y.</p>
<p>The default algorithm is the NIPALS algorithm, which seeks to find the latent (or hidden) relationships among the X variables, which are highly correlated with the response (Y outcome).</p>
<p>Like PCA, PLS finds <strong>linear</strong> combinations of the predictors. These linear combinations are commonly called components, or latent variables. PLS linear combinations of X variables are chosen to maximally summarise covariance with the Y outcomes. This means that PLS finds components that maximally summarise the variation of the predictors (X) while simultaneously requiring these components to have maximum correlation with the response (Y). PLS is a supervised dimension reduction procedure, as compared to Principal Component Regression (PCR), which is an unsupervised procedure. PLS will identify the optimal predictor space dimension reduction for the purpose of regression with the outcome, Y. For PCA, the variance in X is captured as much as possible, but there may be cases in which variation in X is not related to variation in Y, or there may be high noise present, and in turn is not related to Y. Hence, Y cannot be predicted correctly since there is no relationship.</p>
<p>The NIPALS algorithm is suitable for large datasets (when number of samples, n is much greater than number of predictors, X). For scenarios where there are more predictors than samples, the algorithm by Rannar, which is a kernel based algorithm, is computationally more efficient.</p>
<p>There are two versions of PLS - PLS 1 and PLS 2. PLS 1 is used when there is only one Y outcome variable, and PLS 2 may be used when there are more than one Y outcome variables. In PLS 1, a model is build and tuned specific for a Y outcome variabe. In PLS 2, the model is tuned for more than one Y outcomes. It is preferred to tune a model specific for each Y outcome rather in practice.</p>
<h1 id="ir">IR</h1>
<p>IR spectroscopy is used to determine the chemical makeup of a substance. The theory of IR spectroscopy holds that unique molecualr structures absorb IR frequencies differently. In practice, a spectrometer fires a series of IR frequencies into a sample material, and the devide measures the absorbance of the sample at each individual frequency. This series of measurements creates a spectrum profile which can then be used to determine the chemical makeup of the sample material.</p>
<h1 id="data">Data</h1>
<p>A Tecator Infratec Food and Feed Analyzer instrument was used to analyse 215 samples of meat across 100 frequencies (800-1050 nm). In addition to an IR profile, the percent content of water, fat and protein for each sample was determined using analytical chemistry.</p>
<p>The objective is the establish a predictive relationship between IR spectrum and fat content, to predict a sample’s fat content with IR.</p>
<h1 id="packages-required">Packages required</h1>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Load packages: </span>

<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/trinker/pacman'>pacman</a></span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/pkg/pacman/man/p_load.html'>p_load</a></span><span class='op'>(</span><span class='va'>pls</span>, <span class='va'>AppliedPredictiveModeling</span>, <span class='va'>tidyverse</span>, <span class='va'>modeldata</span>, <span class='va'>tidymodels</span>,  <span class='va'>janitor</span>, <span class='va'>skimr</span>, <span class='va'>caret</span>, <span class='va'>ggthemes</span>, <span class='va'>ggrepel</span>, <span class='va'>psych</span>, <span class='va'>GGally</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h1 id="import-data">Import data</h1>
<p>These data are recorded on a Tecator Infratec Food and Feed Analyzer working in the wavelength range 850 - 1050 nm by the Near Infrared Transmission (NIT) principle. Each sample contains finely chopped pure meat with different moisture, fat and protein contents.</p>
<p>For each meat sample the data consists of a 100 channel spectrum of absorbances and the contents of moisture (water), fat and protein. The absorbance is -log10 of the transmittance measured by the spectrometer. The three contents, measured in percent, are determined by analytic chemistry.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>tecator</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>The matrix <em>absorp</em> contains the 100 absorbance values for the 215 samples The matrix <em>endpoints</em> contains the percent of moisture, fat, and protein in columns 1, 2, 3 respectively.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>wavelengths</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>800</span>,<span class='fl'>1050</span>, length.out <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/matplot.html'>matplot</a></span><span class='op'>(</span><span class='va'>wavelengths</span>, <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>absorp</span><span class='op'>)</span>, type <span class='op'>=</span> <span class='st'>"l"</span>, lty <span class='op'>=</span> <span class='fl'>1</span>,
        ylab <span class='op'>=</span> <span class='st'>"Absorbance (-log 10 of transmittance)"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-3-1.png" width="624" /></p>
</div>
<h1 id="pca---the-base-r-way">PCA - the base R way</h1>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>nir.prcomp</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/prcomp.html'>prcomp</a></span><span class='op'>(</span><span class='va'>absorp</span>, rank. <span class='op'>=</span> <span class='fl'>8</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>nir.prcomp</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Importance of first k=8 (out of 100) components:
                          PC1     PC2     PC3     PC4     PC5     PC6
Standard deviation     5.1115 0.48840 0.28009 0.17374 0.03903 0.02581
Proportion of Variance 0.9868 0.00901 0.00296 0.00114 0.00006 0.00003
Cumulative Proportion  0.9868 0.99580 0.99876 0.99990 0.99996 0.99999
                           PC7     PC8
Standard deviation     0.01433 0.01041
Proportion of Variance 0.00001 0.00000
Cumulative Proportion  0.99999 1.00000</code></pre>
</div>
<p>One can see that the first component explains 98.7% of variance in X.</p>
<h2 id="scree-plot">Scree plot</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>nir.prcomp</span>, main <span class='op'>=</span> <span class='st'>"NIR Meat PCA scree plot"</span>,
     xlab <span class='op'>=</span> <span class='st'>"No. of PC"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-5-1.png" width="624" /></p>
</div>
<p>One can choose number of PC = 2</p>
<h2 id="loadings">Loadings</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>nir.loadings</span> <span class='op'>&lt;-</span> <span class='va'>nir.prcomp</span><span class='op'>$</span><span class='va'>rotation</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span>

<span class='co'># find max loading for PC 1</span>
<span class='va'>nir.loadings</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>as_tibble</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>rowid_to_column</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_longer</span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'>starts_with</span><span class='op'>(</span><span class='st'>"PC"</span><span class='op'>)</span>,
               names_to <span class='op'>=</span> <span class='st'>"PC"</span>,
               values_to <span class='op'>=</span> <span class='st'>"loadings"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>PC</span> <span class='op'>==</span> <span class='st'>"PC1"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>abs_loading <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>loadings</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='va'>abs_loading</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 10 x 4
   rowid PC    loadings abs_loading
   &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;       &lt;dbl&gt;
 1    42 PC1      0.106       0.106
 2    41 PC1      0.106       0.106
 3    43 PC1      0.106       0.106
 4    67 PC1      0.106       0.106
 5    68 PC1      0.106       0.106
 6    69 PC1      0.106       0.106
 7    66 PC1      0.106       0.106
 8    70 PC1      0.106       0.106
 9    84 PC1      0.106       0.106
10    71 PC1      0.106       0.106</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># find max loading for PC 2</span>
<span class='va'>nir.loadings</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>as_tibble</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>rowid_to_column</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_longer</span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'>starts_with</span><span class='op'>(</span><span class='st'>"PC"</span><span class='op'>)</span>,
               names_to <span class='op'>=</span> <span class='st'>"PC"</span>,
               values_to <span class='op'>=</span> <span class='st'>"loadings"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>PC</span> <span class='op'>==</span> <span class='st'>"PC2"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>abs_loading <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>loadings</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='va'>abs_loading</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 10 x 4
   rowid PC    loadings abs_loading
   &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;       &lt;dbl&gt;
 1    14 PC2      0.129       0.129
 2    15 PC2      0.129       0.129
 3    13 PC2      0.129       0.129
 4    16 PC2      0.129       0.129
 5    12 PC2      0.128       0.128
 6    17 PC2      0.128       0.128
 7    11 PC2      0.128       0.128
 8    18 PC2      0.127       0.127
 9    10 PC2      0.127       0.127
10     9 PC2      0.126       0.126</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># check which wavelengths</span>

<span class='va'>wavelengths</span><span class='op'>[</span><span class='fl'>42</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code>[1] 903.5354</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>wavelengths</span><span class='op'>[</span><span class='fl'>68</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code>[1] 969.1919</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>wavelengths</span><span class='op'>[</span><span class='fl'>14</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code>[1] 832.8283</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>wavelengths</span><span class='op'>[</span><span class='fl'>17</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code>[1] 840.404</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Plot</span>
<span class='va'>offset</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.009</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>nir.loadings</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span>, type <span class='op'>=</span> <span class='st'>"l"</span>,
     xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/range.html'>range</a></span><span class='op'>(</span><span class='va'>nir.loadings</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>offset</span>,
     xlab <span class='op'>=</span> <span class='st'>"PC 1 (98.7%)"</span>, ylab <span class='op'>=</span> <span class='st'>"PC 2 (0.009%)"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/points.html'>points</a></span><span class='op'>(</span><span class='va'>nir.loadings</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>42</span>,<span class='fl'>68</span>, <span class='fl'>14</span>, <span class='fl'>17</span><span class='op'>)</span>, <span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span><span class='op'>(</span><span class='va'>nir.loadings</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>42</span>,<span class='fl'>68</span>, <span class='fl'>14</span>, <span class='fl'>17</span><span class='op'>)</span>, <span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span>, pos <span class='op'>=</span> <span class='fl'>4</span>,
     labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>903</span>,<span class='fl'>969</span>,<span class='fl'>832</span>,<span class='fl'>840</span><span class='op'>)</span>, <span class='st'>"nm"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-6-1.png" width="624" /></p>
</div>
<h1 id="tidymodels-way-for-pca">Tidymodels way for PCA</h1>
<p>I personally prefer this method because the plots can be customised, rather than using the default base R graphics.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Y</span>
<span class='va'>endpoints.tibble</span> <span class='op'>&lt;-</span> <span class='va'>endpoints</span> <span class='op'>%&gt;%</span> <span class='fu'>as_tibble</span><span class='op'>(</span>.name_repair <span class='op'>=</span> <span class='st'>"unique"</span><span class='op'>)</span>

<span class='co'># set names for Y</span>
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>endpoints.tibble</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"water"</span>, <span class='st'>"fat"</span>, <span class='st'>"protein"</span><span class='op'>)</span>


<span class='co'># X</span>
<span class='va'>absorp.tibble</span> <span class='op'>&lt;-</span> <span class='va'>absorp</span> <span class='op'>%&gt;%</span> <span class='fu'>as_tibble</span><span class='op'>(</span>.name_repair <span class='op'>=</span> <span class='st'>"unique"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>clean_names</span><span class='op'>(</span><span class='op'>)</span>

<span class='co'># combine both datasets</span>
<span class='va'>data_meat_x</span> <span class='op'>&lt;-</span> <span class='va'>absorp.tibble</span>
<span class='va'>data_meat_y</span> <span class='op'>&lt;-</span> <span class='va'>endpoints.tibble</span>

<span class='co'># combine both datasets</span>
<span class='va'>data_meat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='va'>endpoints.tibble</span>, <span class='va'>absorp.tibble</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>215</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h4 id="checking-assumptions-for-pca">Checking assumptions for PCA</h4>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Checking assumptions ----</span>

<span class='va'>data_meat_x</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>KMO</span><span class='op'>(</span><span class='op'>)</span> <span class='co'># Overal MSA = 0.97, greater than 0.70</span>
</code></pre>
</div>
<pre><code>Kaiser-Meyer-Olkin factor adequacy
Call: KMO(r = .)
Overall MSA =  0.97
MSA for each item = 
  x1   x2   x3   x4   x5   x6   x7   x8   x9  x10  x11  x12  x13  x14 
0.99 0.98 0.97 0.97 0.96 0.96 0.96 0.98 0.98 0.98 0.97 0.96 0.96 0.96 
 x15  x16  x17  x18  x19  x20  x21  x22  x23  x24  x25  x26  x27  x28 
0.97 0.98 0.98 0.99 0.98 0.96 0.96 0.96 0.96 0.96 0.97 0.99 0.98 0.98 
 x29  x30  x31  x32  x33  x34  x35  x36  x37  x38  x39  x40  x41  x42 
0.97 0.97 0.97 0.97 0.97 0.97 0.98 0.98 0.98 0.98 0.98 0.98 0.97 0.96 
 x43  x44  x45  x46  x47  x48  x49  x50  x51  x52  x53  x54  x55  x56 
0.96 0.97 0.97 0.98 0.98 0.98 0.98 0.97 0.97 0.97 0.96 0.96 0.96 0.96 
 x57  x58  x59  x60  x61  x62  x63  x64  x65  x66  x67  x68  x69  x70 
0.97 0.97 0.98 0.98 0.98 0.98 0.98 0.98 0.97 0.96 0.96 0.96 0.97 0.97 
 x71  x72  x73  x74  x75  x76  x77  x78  x79  x80  x81  x82  x83  x84 
0.97 0.98 0.98 0.97 0.98 0.98 0.97 0.98 0.98 0.98 0.98 0.98 0.97 0.97 
 x85  x86  x87  x88  x89  x90  x91  x92  x93  x94  x95  x96  x97  x98 
0.97 0.97 0.97 0.98 0.97 0.96 0.96 0.97 0.97 0.98 0.98 0.98 0.98 0.98 
 x99 x100 
0.97 0.97 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>data_meat_x</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>cortest.bartlett</span><span class='op'>(</span><span class='va'>.</span>, n <span class='op'>=</span> <span class='fl'>215</span><span class='op'>)</span> <span class='co'># p &lt; 0.05</span>
</code></pre>
</div>
<pre><code>$chisq
[1] Inf

$p.value
[1] 0

$df
[1] 4950</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># all assumptions met, ok to do PCA</span>
</code></pre>
</div>
</div>
<h4 id="model">Model</h4>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># tidymodels PCA -----</span>

<span class='co'># recipe</span>
<span class='va'>meat_pca_recipe</span> <span class='op'>&lt;-</span> <span class='fu'>recipe</span><span class='op'>(</span><span class='op'>~</span> <span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>data_meat</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>update_role</span><span class='op'>(</span><span class='va'>id</span>, new_role <span class='op'>=</span> <span class='st'>"id"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>update_role</span><span class='op'>(</span><span class='va'>water</span>, <span class='va'>fat</span>, <span class='va'>protein</span>, new_role <span class='op'>=</span> <span class='st'>"outcome"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_normalize</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_pca</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span>, id <span class='op'>=</span> <span class='st'>"pca"</span><span class='op'>)</span>

<span class='va'>meat_pca_recipe</span>
</code></pre>
</div>
<pre><code>Data Recipe

Inputs:

      role #variables
        id          1
   outcome          3
 predictor        100

Operations:

Centering and scaling for all_predictors()
No PCA components were extracted.</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># prep</span>

<span class='va'>meat_pca_prep</span> <span class='op'>&lt;-</span> <span class='fu'>prep</span><span class='op'>(</span><span class='va'>meat_pca_recipe</span><span class='op'>)</span>

<span class='co'># loadings</span>
<span class='va'>tidy_pca_loadings</span> <span class='op'>&lt;-</span> <span class='va'>meat_pca_prep</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>tidy</span><span class='op'>(</span>id <span class='op'>=</span> <span class='st'>"pca"</span><span class='op'>)</span>

<span class='va'>tidy_pca_loadings</span>
</code></pre>
</div>
<pre><code># A tibble: 10,000 x 4
   terms  value component id   
   &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;
 1 x1    0.0997 PC1       pca  
 2 x2    0.0997 PC1       pca  
 3 x3    0.0997 PC1       pca  
 4 x4    0.0997 PC1       pca  
 5 x5    0.0997 PC1       pca  
 6 x6    0.0996 PC1       pca  
 7 x7    0.0996 PC1       pca  
 8 x8    0.0997 PC1       pca  
 9 x9    0.0997 PC1       pca  
10 x10   0.0997 PC1       pca  
# … with 9,990 more rows</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># bake</span>
<span class='va'>meat_pca_bake</span> <span class='op'>&lt;-</span> <span class='fu'>bake</span><span class='op'>(</span><span class='va'>meat_pca_prep</span>, <span class='va'>data_meat</span><span class='op'>)</span>
<span class='va'>meat_pca_bake</span> <span class='co'># PCA LOADING VECTORS</span>
</code></pre>
</div>
<pre><code># A tibble: 215 x 9
   water   fat protein    id    PC1    PC2     PC3      PC4     PC5
   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
 1  60.5  22.5    16.7     1 -4.30  -0.404 -0.137  -0.0939   0.105 
 2  46    40.1    13.5     2  0.998  0.486 -1.20   -0.0169   0.0303
 3  71     8.4    20.5     3 -7.14   1.41   0.155   0.244   -0.0815
 4  72.8   5.9    20.7     4 -1.81   1.15   0.544   0.00581  0.128 
 5  58.3  25.5    15.5     5  0.988 -1.19  -0.0591 -0.0248   0.101 
 6  44    42.7    13.7     6  5.56   0.226 -1.24   -0.0877   0.0470
 7  44    42.7    13.7     7  4.96   0.590 -1.16    0.129   -0.129 
 8  69.3  10.6    19.3     8 -6.31  -0.625  0.166  -0.144    0.0222
 9  61.4  19.9    17.7     9 11.6   -0.354  0.185  -0.269    0.0274
10  61.4  19.9    17.7    10 14.6   -0.274  0.459  -0.0457  -0.111 
# … with 205 more rows</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Check number of PC: ------</span>

<span class='co'># Check number of PCs by eigenvalues</span>

<span class='va'>meat_pca_prep</span><span class='op'>$</span><span class='va'>steps</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span><span class='op'>$</span><span class='va'>res</span><span class='op'>$</span><span class='va'>sdev</span> <span class='op'>%&gt;%</span> <span class='fu'>as_tibble</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>&gt;</span><span class='fl'>1</span><span class='op'>)</span> <span class='co'># only 1 PC</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 1
  value
  &lt;dbl&gt;
1  9.93</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># check using scree plots</span>

<span class='va'>proportion_scree_plot</span> <span class='op'>&lt;-</span> <span class='va'>meat_pca_prep</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>tidy</span><span class='op'>(</span>id <span class='op'>=</span> <span class='st'>"pca"</span>, type <span class='op'>=</span> <span class='st'>"variance"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>terms</span> <span class='op'>==</span> <span class='st'>"percent variance"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>component</span>, <span class='va'>value</span>, label <span class='op'>=</span> <span class='va'>value</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_text</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>value</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>, vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>0.2</span>, size <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"% Variance explained"</span>,
       y <span class='op'>=</span> <span class='st'>"% total variance"</span>,
       x <span class='op'>=</span> <span class='st'>"PC"</span>,
       subtitle <span class='op'>=</span> <span class='st'>"98.63 % of variance is explained in PC 1"</span>,
       caption <span class='op'>=</span> <span class='st'>"Source: Tecator Dataset {caret}"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_few</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>axis.title <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>face <span class='op'>=</span> <span class='st'>"bold"</span>, size <span class='op'>=</span> <span class='fl'>12</span><span class='op'>)</span>,
        axis.text <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>,
        plot.title <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>14</span>, face <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>proportion_scree_plot</span>
</code></pre>
</div>
<p><img src="Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-9-1.png" width="624" /></p>
</div>
<h1 id="pls-regression">PLS regression</h1>
<h2 id="change-dataset-into-a-tibble-format">Change dataset into a tibble format</h2>
<p>Alternatively, another ready-to-use format of date may be imported.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>meats</span><span class='op'>)</span> <span class='co'># from modeldata package</span>
<span class='va'>meats</span>
</code></pre>
</div>
<pre><code># A tibble: 215 x 103
   x_001 x_002 x_003 x_004 x_005 x_006 x_007 x_008 x_009 x_010 x_011
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  2.62  2.62  2.62  2.62  2.62  2.62  2.62  2.62  2.63  2.63  2.63
 2  2.83  2.84  2.84  2.85  2.85  2.86  2.86  2.87  2.87  2.88  2.88
 3  2.58  2.58  2.59  2.59  2.59  2.59  2.59  2.60  2.60  2.60  2.60
 4  2.82  2.82  2.83  2.83  2.83  2.83  2.83  2.84  2.84  2.84  2.84
 5  2.79  2.79  2.79  2.79  2.80  2.80  2.80  2.80  2.81  2.81  2.81
 6  3.01  3.02  3.02  3.03  3.03  3.04  3.04  3.05  3.06  3.06  3.07
 7  2.99  2.99  3.00  3.01  3.01  3.02  3.02  3.03  3.04  3.04  3.05
 8  2.53  2.53  2.53  2.53  2.53  2.53  2.53  2.53  2.54  2.54  2.54
 9  3.27  3.28  3.29  3.29  3.30  3.31  3.31  3.32  3.33  3.33  3.34
10  3.40  3.41  3.41  3.42  3.43  3.43  3.44  3.45  3.46  3.47  3.48
# … with 205 more rows, and 92 more variables: x_012 &lt;dbl&gt;,
#   x_013 &lt;dbl&gt;, x_014 &lt;dbl&gt;, x_015 &lt;dbl&gt;, x_016 &lt;dbl&gt;, x_017 &lt;dbl&gt;,
#   x_018 &lt;dbl&gt;, x_019 &lt;dbl&gt;, x_020 &lt;dbl&gt;, x_021 &lt;dbl&gt;, x_022 &lt;dbl&gt;,
#   x_023 &lt;dbl&gt;, x_024 &lt;dbl&gt;, x_025 &lt;dbl&gt;, x_026 &lt;dbl&gt;, x_027 &lt;dbl&gt;,
#   x_028 &lt;dbl&gt;, x_029 &lt;dbl&gt;, x_030 &lt;dbl&gt;, x_031 &lt;dbl&gt;, x_032 &lt;dbl&gt;,
#   x_033 &lt;dbl&gt;, x_034 &lt;dbl&gt;, x_035 &lt;dbl&gt;, x_036 &lt;dbl&gt;, x_037 &lt;dbl&gt;,
#   x_038 &lt;dbl&gt;, x_039 &lt;dbl&gt;, x_040 &lt;dbl&gt;, x_041 &lt;dbl&gt;, x_042 &lt;dbl&gt;,
#   x_043 &lt;dbl&gt;, x_044 &lt;dbl&gt;, x_045 &lt;dbl&gt;, x_046 &lt;dbl&gt;, x_047 &lt;dbl&gt;,
#   x_048 &lt;dbl&gt;, x_049 &lt;dbl&gt;, x_050 &lt;dbl&gt;, x_051 &lt;dbl&gt;, x_052 &lt;dbl&gt;,
#   x_053 &lt;dbl&gt;, x_054 &lt;dbl&gt;, x_055 &lt;dbl&gt;, x_056 &lt;dbl&gt;, x_057 &lt;dbl&gt;,
#   x_058 &lt;dbl&gt;, x_059 &lt;dbl&gt;, x_060 &lt;dbl&gt;, x_061 &lt;dbl&gt;, x_062 &lt;dbl&gt;,
#   x_063 &lt;dbl&gt;, x_064 &lt;dbl&gt;, x_065 &lt;dbl&gt;, x_066 &lt;dbl&gt;, x_067 &lt;dbl&gt;,
#   x_068 &lt;dbl&gt;, x_069 &lt;dbl&gt;, x_070 &lt;dbl&gt;, x_071 &lt;dbl&gt;, x_072 &lt;dbl&gt;,
#   x_073 &lt;dbl&gt;, x_074 &lt;dbl&gt;, x_075 &lt;dbl&gt;, x_076 &lt;dbl&gt;, x_077 &lt;dbl&gt;,
#   x_078 &lt;dbl&gt;, x_079 &lt;dbl&gt;, x_080 &lt;dbl&gt;, x_081 &lt;dbl&gt;, x_082 &lt;dbl&gt;,
#   x_083 &lt;dbl&gt;, x_084 &lt;dbl&gt;, x_085 &lt;dbl&gt;, x_086 &lt;dbl&gt;, x_087 &lt;dbl&gt;,
#   x_088 &lt;dbl&gt;, x_089 &lt;dbl&gt;, x_090 &lt;dbl&gt;, x_091 &lt;dbl&gt;, x_092 &lt;dbl&gt;,
#   x_093 &lt;dbl&gt;, x_094 &lt;dbl&gt;, x_095 &lt;dbl&gt;, x_096 &lt;dbl&gt;, x_097 &lt;dbl&gt;,
#   x_098 &lt;dbl&gt;, x_099 &lt;dbl&gt;, x_100 &lt;dbl&gt;, water &lt;dbl&gt;, fat &lt;dbl&gt;,
#   protein &lt;dbl&gt;</code></pre>
</div>
<h2 id="split-into-training-and-testing-dataset">Split into training and testing dataset</h2>
<p>Note: preprocessing of data, should be done only for TRAINING and not the whole dataset to ensure independence of training and testing dataset.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>20210318</span><span class='op'>)</span>

<span class='va'>meat_split</span> <span class='op'>&lt;-</span> <span class='fu'>initial_split</span><span class='op'>(</span><span class='va'>meats</span>, prop <span class='op'>=</span> <span class='fl'>0.80</span><span class='op'>)</span>

<span class='va'>meat_training</span> <span class='op'>&lt;-</span> <span class='va'>meat_split</span> <span class='op'>%&gt;%</span> <span class='fu'>training</span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>meat_testing</span> <span class='op'>&lt;-</span> <span class='va'>meat_split</span> <span class='op'>%&gt;%</span> <span class='fu'>testing</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="eda">EDA</h2>
<p>Just to check the data to see preprocessing steps required.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>skim</span><span class='op'>(</span><span class='va'>meat_training</span><span class='op'>)</span>
</code></pre>
</div>
<table>
<caption><span id="tab:unnamed-chunk-12">Table 1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">meat_training</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">173</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">103</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">103</td>
</tr>
<tr class="odd">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">x_001</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.80</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">2.07</td>
<td style="text-align: right;">2.53</td>
<td style="text-align: right;">2.74</td>
<td style="text-align: right;">2.99</td>
<td style="text-align: right;">4.22</td>
<td style="text-align: left;">▃▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_002</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.80</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">2.07</td>
<td style="text-align: right;">2.53</td>
<td style="text-align: right;">2.74</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">4.23</td>
<td style="text-align: left;">▃▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_003</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.81</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">2.07</td>
<td style="text-align: right;">2.53</td>
<td style="text-align: right;">2.74</td>
<td style="text-align: right;">3.01</td>
<td style="text-align: right;">4.24</td>
<td style="text-align: left;">▃▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_004</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.81</td>
<td style="text-align: right;">0.41</td>
<td style="text-align: right;">2.06</td>
<td style="text-align: right;">2.53</td>
<td style="text-align: right;">2.74</td>
<td style="text-align: right;">3.01</td>
<td style="text-align: right;">4.25</td>
<td style="text-align: left;">▃▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_005</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.81</td>
<td style="text-align: right;">0.41</td>
<td style="text-align: right;">2.06</td>
<td style="text-align: right;">2.53</td>
<td style="text-align: right;">2.74</td>
<td style="text-align: right;">3.02</td>
<td style="text-align: right;">4.26</td>
<td style="text-align: left;">▃▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_006</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.81</td>
<td style="text-align: right;">0.41</td>
<td style="text-align: right;">2.06</td>
<td style="text-align: right;">2.52</td>
<td style="text-align: right;">2.75</td>
<td style="text-align: right;">3.03</td>
<td style="text-align: right;">4.27</td>
<td style="text-align: left;">▃▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_007</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.82</td>
<td style="text-align: right;">0.41</td>
<td style="text-align: right;">2.06</td>
<td style="text-align: right;">2.53</td>
<td style="text-align: right;">2.75</td>
<td style="text-align: right;">3.03</td>
<td style="text-align: right;">4.28</td>
<td style="text-align: left;">▃▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_008</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.82</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">2.06</td>
<td style="text-align: right;">2.53</td>
<td style="text-align: right;">2.75</td>
<td style="text-align: right;">3.04</td>
<td style="text-align: right;">4.29</td>
<td style="text-align: left;">▃▇▃▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_009</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.82</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">2.06</td>
<td style="text-align: right;">2.53</td>
<td style="text-align: right;">2.76</td>
<td style="text-align: right;">3.05</td>
<td style="text-align: right;">4.30</td>
<td style="text-align: left;">▃▇▃▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_010</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.83</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">2.06</td>
<td style="text-align: right;">2.53</td>
<td style="text-align: right;">2.76</td>
<td style="text-align: right;">3.05</td>
<td style="text-align: right;">4.31</td>
<td style="text-align: left;">▃▇▃▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_011</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.83</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">2.06</td>
<td style="text-align: right;">2.53</td>
<td style="text-align: right;">2.77</td>
<td style="text-align: right;">3.06</td>
<td style="text-align: right;">4.33</td>
<td style="text-align: left;">▃▇▃▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_012</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.84</td>
<td style="text-align: right;">0.43</td>
<td style="text-align: right;">2.06</td>
<td style="text-align: right;">2.54</td>
<td style="text-align: right;">2.77</td>
<td style="text-align: right;">3.07</td>
<td style="text-align: right;">4.34</td>
<td style="text-align: left;">▃▇▃▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_013</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.84</td>
<td style="text-align: right;">0.43</td>
<td style="text-align: right;">2.06</td>
<td style="text-align: right;">2.54</td>
<td style="text-align: right;">2.78</td>
<td style="text-align: right;">3.07</td>
<td style="text-align: right;">4.35</td>
<td style="text-align: left;">▃▇▃▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_014</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.85</td>
<td style="text-align: right;">0.43</td>
<td style="text-align: right;">2.06</td>
<td style="text-align: right;">2.54</td>
<td style="text-align: right;">2.78</td>
<td style="text-align: right;">3.08</td>
<td style="text-align: right;">4.37</td>
<td style="text-align: left;">▃▇▃▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_015</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.85</td>
<td style="text-align: right;">0.43</td>
<td style="text-align: right;">2.07</td>
<td style="text-align: right;">2.55</td>
<td style="text-align: right;">2.78</td>
<td style="text-align: right;">3.09</td>
<td style="text-align: right;">4.38</td>
<td style="text-align: left;">▃▇▃▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_016</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.86</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">2.07</td>
<td style="text-align: right;">2.55</td>
<td style="text-align: right;">2.79</td>
<td style="text-align: right;">3.10</td>
<td style="text-align: right;">4.40</td>
<td style="text-align: left;">▃▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_017</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.86</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">2.07</td>
<td style="text-align: right;">2.55</td>
<td style="text-align: right;">2.79</td>
<td style="text-align: right;">3.11</td>
<td style="text-align: right;">4.42</td>
<td style="text-align: left;">▅▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_018</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.87</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">2.07</td>
<td style="text-align: right;">2.56</td>
<td style="text-align: right;">2.80</td>
<td style="text-align: right;">3.12</td>
<td style="text-align: right;">4.43</td>
<td style="text-align: left;">▅▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_019</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.88</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">2.07</td>
<td style="text-align: right;">2.56</td>
<td style="text-align: right;">2.80</td>
<td style="text-align: right;">3.13</td>
<td style="text-align: right;">4.45</td>
<td style="text-align: left;">▅▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_020</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.89</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">2.07</td>
<td style="text-align: right;">2.57</td>
<td style="text-align: right;">2.81</td>
<td style="text-align: right;">3.14</td>
<td style="text-align: right;">4.47</td>
<td style="text-align: left;">▅▇▅▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_021</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.90</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">2.07</td>
<td style="text-align: right;">2.57</td>
<td style="text-align: right;">2.81</td>
<td style="text-align: right;">3.15</td>
<td style="text-align: right;">4.49</td>
<td style="text-align: left;">▅▇▅▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_022</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.90</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: right;">2.08</td>
<td style="text-align: right;">2.57</td>
<td style="text-align: right;">2.82</td>
<td style="text-align: right;">3.16</td>
<td style="text-align: right;">4.51</td>
<td style="text-align: left;">▅▇▅▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_023</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.91</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: right;">2.08</td>
<td style="text-align: right;">2.58</td>
<td style="text-align: right;">2.82</td>
<td style="text-align: right;">3.17</td>
<td style="text-align: right;">4.53</td>
<td style="text-align: left;">▅▇▅▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_024</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.92</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: right;">2.08</td>
<td style="text-align: right;">2.59</td>
<td style="text-align: right;">2.83</td>
<td style="text-align: right;">3.17</td>
<td style="text-align: right;">4.55</td>
<td style="text-align: left;">▅▇▅▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_025</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.93</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">2.08</td>
<td style="text-align: right;">2.59</td>
<td style="text-align: right;">2.84</td>
<td style="text-align: right;">3.18</td>
<td style="text-align: right;">4.57</td>
<td style="text-align: left;">▅▇▅▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_026</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.93</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">2.09</td>
<td style="text-align: right;">2.60</td>
<td style="text-align: right;">2.85</td>
<td style="text-align: right;">3.19</td>
<td style="text-align: right;">4.59</td>
<td style="text-align: left;">▅▇▅▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_027</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.94</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">2.09</td>
<td style="text-align: right;">2.60</td>
<td style="text-align: right;">2.86</td>
<td style="text-align: right;">3.20</td>
<td style="text-align: right;">4.61</td>
<td style="text-align: left;">▅▇▅▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_028</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.95</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">2.09</td>
<td style="text-align: right;">2.61</td>
<td style="text-align: right;">2.87</td>
<td style="text-align: right;">3.21</td>
<td style="text-align: right;">4.63</td>
<td style="text-align: left;">▅▇▅▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_029</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.96</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">2.09</td>
<td style="text-align: right;">2.61</td>
<td style="text-align: right;">2.88</td>
<td style="text-align: right;">3.22</td>
<td style="text-align: right;">4.65</td>
<td style="text-align: left;">▅▇▅▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_030</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.97</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">2.09</td>
<td style="text-align: right;">2.62</td>
<td style="text-align: right;">2.88</td>
<td style="text-align: right;">3.24</td>
<td style="text-align: right;">4.68</td>
<td style="text-align: left;">▅▇▅▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_031</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.98</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">2.10</td>
<td style="text-align: right;">2.62</td>
<td style="text-align: right;">2.90</td>
<td style="text-align: right;">3.26</td>
<td style="text-align: right;">4.70</td>
<td style="text-align: left;">▅▇▅▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_032</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.99</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">2.10</td>
<td style="text-align: right;">2.63</td>
<td style="text-align: right;">2.91</td>
<td style="text-align: right;">3.28</td>
<td style="text-align: right;">4.73</td>
<td style="text-align: left;">▅▇▅▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_033</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">2.10</td>
<td style="text-align: right;">2.64</td>
<td style="text-align: right;">2.91</td>
<td style="text-align: right;">3.31</td>
<td style="text-align: right;">4.76</td>
<td style="text-align: left;">▅▇▅▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_034</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.01</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">2.10</td>
<td style="text-align: right;">2.65</td>
<td style="text-align: right;">2.93</td>
<td style="text-align: right;">3.33</td>
<td style="text-align: right;">4.78</td>
<td style="text-align: left;">▅▇▅▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_035</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.03</td>
<td style="text-align: right;">0.51</td>
<td style="text-align: right;">2.11</td>
<td style="text-align: right;">2.66</td>
<td style="text-align: right;">2.94</td>
<td style="text-align: right;">3.36</td>
<td style="text-align: right;">4.81</td>
<td style="text-align: left;">▅▇▅▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_036</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.04</td>
<td style="text-align: right;">0.51</td>
<td style="text-align: right;">2.11</td>
<td style="text-align: right;">2.68</td>
<td style="text-align: right;">2.94</td>
<td style="text-align: right;">3.39</td>
<td style="text-align: right;">4.84</td>
<td style="text-align: left;">▅▇▅▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_037</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.05</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">2.12</td>
<td style="text-align: right;">2.69</td>
<td style="text-align: right;">2.95</td>
<td style="text-align: right;">3.42</td>
<td style="text-align: right;">4.87</td>
<td style="text-align: left;">▅▇▅▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_038</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.07</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">2.13</td>
<td style="text-align: right;">2.70</td>
<td style="text-align: right;">2.97</td>
<td style="text-align: right;">3.45</td>
<td style="text-align: right;">4.90</td>
<td style="text-align: left;">▅▇▅▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_039</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.09</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">2.14</td>
<td style="text-align: right;">2.72</td>
<td style="text-align: right;">2.99</td>
<td style="text-align: right;">3.47</td>
<td style="text-align: right;">4.93</td>
<td style="text-align: left;">▅▇▅▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_040</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.11</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.15</td>
<td style="text-align: right;">2.73</td>
<td style="text-align: right;">3.01</td>
<td style="text-align: right;">3.48</td>
<td style="text-align: right;">4.96</td>
<td style="text-align: left;">▅▇▅▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_041</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.12</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.17</td>
<td style="text-align: right;">2.74</td>
<td style="text-align: right;">3.03</td>
<td style="text-align: right;">3.50</td>
<td style="text-align: right;">4.98</td>
<td style="text-align: left;">▅▇▅▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_042</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.14</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.18</td>
<td style="text-align: right;">2.76</td>
<td style="text-align: right;">3.04</td>
<td style="text-align: right;">3.52</td>
<td style="text-align: right;">5.00</td>
<td style="text-align: left;">▅▇▅▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_043</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.15</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.20</td>
<td style="text-align: right;">2.78</td>
<td style="text-align: right;">3.05</td>
<td style="text-align: right;">3.53</td>
<td style="text-align: right;">5.01</td>
<td style="text-align: left;">▅▇▅▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_044</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.16</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.22</td>
<td style="text-align: right;">2.79</td>
<td style="text-align: right;">3.06</td>
<td style="text-align: right;">3.52</td>
<td style="text-align: right;">5.02</td>
<td style="text-align: left;">▅▇▅▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_045</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.17</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">2.24</td>
<td style="text-align: right;">2.80</td>
<td style="text-align: right;">3.08</td>
<td style="text-align: right;">3.50</td>
<td style="text-align: right;">5.02</td>
<td style="text-align: left;">▅▇▅▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_046</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.19</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">2.27</td>
<td style="text-align: right;">2.82</td>
<td style="text-align: right;">3.10</td>
<td style="text-align: right;">3.49</td>
<td style="text-align: right;">5.02</td>
<td style="text-align: left;">▅▇▅▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_047</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.20</td>
<td style="text-align: right;">0.51</td>
<td style="text-align: right;">2.29</td>
<td style="text-align: right;">2.84</td>
<td style="text-align: right;">3.10</td>
<td style="text-align: right;">3.50</td>
<td style="text-align: right;">5.03</td>
<td style="text-align: left;">▅▇▅▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_048</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.22</td>
<td style="text-align: right;">0.51</td>
<td style="text-align: right;">2.32</td>
<td style="text-align: right;">2.86</td>
<td style="text-align: right;">3.12</td>
<td style="text-align: right;">3.50</td>
<td style="text-align: right;">5.04</td>
<td style="text-align: left;">▅▇▅▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_049</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.25</td>
<td style="text-align: right;">0.51</td>
<td style="text-align: right;">2.35</td>
<td style="text-align: right;">2.89</td>
<td style="text-align: right;">3.15</td>
<td style="text-align: right;">3.52</td>
<td style="text-align: right;">5.06</td>
<td style="text-align: left;">▅▇▅▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_050</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.28</td>
<td style="text-align: right;">0.51</td>
<td style="text-align: right;">2.39</td>
<td style="text-align: right;">2.93</td>
<td style="text-align: right;">3.19</td>
<td style="text-align: right;">3.55</td>
<td style="text-align: right;">5.09</td>
<td style="text-align: left;">▅▇▅▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_051</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.32</td>
<td style="text-align: right;">0.51</td>
<td style="text-align: right;">2.43</td>
<td style="text-align: right;">2.97</td>
<td style="text-align: right;">3.22</td>
<td style="text-align: right;">3.58</td>
<td style="text-align: right;">5.13</td>
<td style="text-align: left;">▅▇▅▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_052</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.36</td>
<td style="text-align: right;">0.51</td>
<td style="text-align: right;">2.48</td>
<td style="text-align: right;">3.01</td>
<td style="text-align: right;">3.27</td>
<td style="text-align: right;">3.61</td>
<td style="text-align: right;">5.17</td>
<td style="text-align: left;">▅▇▃▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_053</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.41</td>
<td style="text-align: right;">0.51</td>
<td style="text-align: right;">2.53</td>
<td style="text-align: right;">3.05</td>
<td style="text-align: right;">3.32</td>
<td style="text-align: right;">3.65</td>
<td style="text-align: right;">5.23</td>
<td style="text-align: left;">▅▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_054</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.45</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">2.57</td>
<td style="text-align: right;">3.09</td>
<td style="text-align: right;">3.37</td>
<td style="text-align: right;">3.70</td>
<td style="text-align: right;">5.28</td>
<td style="text-align: left;">▅▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_055</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.50</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">2.61</td>
<td style="text-align: right;">3.13</td>
<td style="text-align: right;">3.41</td>
<td style="text-align: right;">3.74</td>
<td style="text-align: right;">5.33</td>
<td style="text-align: left;">▅▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_056</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.53</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">2.65</td>
<td style="text-align: right;">3.16</td>
<td style="text-align: right;">3.45</td>
<td style="text-align: right;">3.78</td>
<td style="text-align: right;">5.37</td>
<td style="text-align: left;">▅▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_057</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.56</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.67</td>
<td style="text-align: right;">3.19</td>
<td style="text-align: right;">3.48</td>
<td style="text-align: right;">3.81</td>
<td style="text-align: right;">5.41</td>
<td style="text-align: left;">▅▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_058</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.58</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.69</td>
<td style="text-align: right;">3.21</td>
<td style="text-align: right;">3.51</td>
<td style="text-align: right;">3.83</td>
<td style="text-align: right;">5.43</td>
<td style="text-align: left;">▅▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_059</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.59</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.71</td>
<td style="text-align: right;">3.22</td>
<td style="text-align: right;">3.53</td>
<td style="text-align: right;">3.84</td>
<td style="text-align: right;">5.44</td>
<td style="text-align: left;">▅▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_060</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.60</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.72</td>
<td style="text-align: right;">3.23</td>
<td style="text-align: right;">3.54</td>
<td style="text-align: right;">3.85</td>
<td style="text-align: right;">5.45</td>
<td style="text-align: left;">▅▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_061</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.61</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.72</td>
<td style="text-align: right;">3.24</td>
<td style="text-align: right;">3.55</td>
<td style="text-align: right;">3.86</td>
<td style="text-align: right;">5.46</td>
<td style="text-align: left;">▅▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_062</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.61</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.73</td>
<td style="text-align: right;">3.25</td>
<td style="text-align: right;">3.55</td>
<td style="text-align: right;">3.86</td>
<td style="text-align: right;">5.47</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_063</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.61</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.73</td>
<td style="text-align: right;">3.25</td>
<td style="text-align: right;">3.56</td>
<td style="text-align: right;">3.87</td>
<td style="text-align: right;">5.47</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_064</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.62</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.73</td>
<td style="text-align: right;">3.24</td>
<td style="text-align: right;">3.56</td>
<td style="text-align: right;">3.87</td>
<td style="text-align: right;">5.47</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_065</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.61</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.73</td>
<td style="text-align: right;">3.24</td>
<td style="text-align: right;">3.55</td>
<td style="text-align: right;">3.87</td>
<td style="text-align: right;">5.47</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_066</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.61</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.73</td>
<td style="text-align: right;">3.24</td>
<td style="text-align: right;">3.55</td>
<td style="text-align: right;">3.86</td>
<td style="text-align: right;">5.47</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_067</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.60</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.73</td>
<td style="text-align: right;">3.23</td>
<td style="text-align: right;">3.54</td>
<td style="text-align: right;">3.85</td>
<td style="text-align: right;">5.47</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_068</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.60</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.72</td>
<td style="text-align: right;">3.22</td>
<td style="text-align: right;">3.53</td>
<td style="text-align: right;">3.83</td>
<td style="text-align: right;">5.46</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_069</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.59</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.72</td>
<td style="text-align: right;">3.20</td>
<td style="text-align: right;">3.52</td>
<td style="text-align: right;">3.82</td>
<td style="text-align: right;">5.45</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_070</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.58</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.71</td>
<td style="text-align: right;">3.19</td>
<td style="text-align: right;">3.51</td>
<td style="text-align: right;">3.82</td>
<td style="text-align: right;">5.44</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_071</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.56</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.70</td>
<td style="text-align: right;">3.18</td>
<td style="text-align: right;">3.50</td>
<td style="text-align: right;">3.81</td>
<td style="text-align: right;">5.43</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_072</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.55</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.69</td>
<td style="text-align: right;">3.17</td>
<td style="text-align: right;">3.49</td>
<td style="text-align: right;">3.80</td>
<td style="text-align: right;">5.42</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_073</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.54</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.68</td>
<td style="text-align: right;">3.16</td>
<td style="text-align: right;">3.48</td>
<td style="text-align: right;">3.79</td>
<td style="text-align: right;">5.40</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_074</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.52</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.66</td>
<td style="text-align: right;">3.14</td>
<td style="text-align: right;">3.46</td>
<td style="text-align: right;">3.78</td>
<td style="text-align: right;">5.39</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_075</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.51</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.65</td>
<td style="text-align: right;">3.13</td>
<td style="text-align: right;">3.45</td>
<td style="text-align: right;">3.77</td>
<td style="text-align: right;">5.37</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_076</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.49</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.63</td>
<td style="text-align: right;">3.11</td>
<td style="text-align: right;">3.43</td>
<td style="text-align: right;">3.75</td>
<td style="text-align: right;">5.36</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_077</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.47</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.62</td>
<td style="text-align: right;">3.09</td>
<td style="text-align: right;">3.40</td>
<td style="text-align: right;">3.74</td>
<td style="text-align: right;">5.34</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_078</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.45</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.60</td>
<td style="text-align: right;">3.07</td>
<td style="text-align: right;">3.38</td>
<td style="text-align: right;">3.73</td>
<td style="text-align: right;">5.32</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_079</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.43</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.59</td>
<td style="text-align: right;">3.05</td>
<td style="text-align: right;">3.37</td>
<td style="text-align: right;">3.72</td>
<td style="text-align: right;">5.30</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_080</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.42</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.57</td>
<td style="text-align: right;">3.03</td>
<td style="text-align: right;">3.35</td>
<td style="text-align: right;">3.71</td>
<td style="text-align: right;">5.29</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_081</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.40</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.55</td>
<td style="text-align: right;">3.01</td>
<td style="text-align: right;">3.33</td>
<td style="text-align: right;">3.68</td>
<td style="text-align: right;">5.27</td>
<td style="text-align: left;">▇▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_082</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.38</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.53</td>
<td style="text-align: right;">2.99</td>
<td style="text-align: right;">3.30</td>
<td style="text-align: right;">3.66</td>
<td style="text-align: right;">5.25</td>
<td style="text-align: left;">▇▇▅▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_083</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.36</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.51</td>
<td style="text-align: right;">2.97</td>
<td style="text-align: right;">3.28</td>
<td style="text-align: right;">3.65</td>
<td style="text-align: right;">5.23</td>
<td style="text-align: left;">▇▇▅▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_084</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.34</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.50</td>
<td style="text-align: right;">2.96</td>
<td style="text-align: right;">3.26</td>
<td style="text-align: right;">3.63</td>
<td style="text-align: right;">5.21</td>
<td style="text-align: left;">▇▇▅▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_085</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.32</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.48</td>
<td style="text-align: right;">2.94</td>
<td style="text-align: right;">3.23</td>
<td style="text-align: right;">3.62</td>
<td style="text-align: right;">5.19</td>
<td style="text-align: left;">▇▇▅▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_086</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.30</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.46</td>
<td style="text-align: right;">2.92</td>
<td style="text-align: right;">3.21</td>
<td style="text-align: right;">3.60</td>
<td style="text-align: right;">5.17</td>
<td style="text-align: left;">▇▇▅▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_087</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.28</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.44</td>
<td style="text-align: right;">2.90</td>
<td style="text-align: right;">3.18</td>
<td style="text-align: right;">3.57</td>
<td style="text-align: right;">5.15</td>
<td style="text-align: left;">▇▇▅▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_088</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.25</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.42</td>
<td style="text-align: right;">2.87</td>
<td style="text-align: right;">3.16</td>
<td style="text-align: right;">3.55</td>
<td style="text-align: right;">5.13</td>
<td style="text-align: left;">▇▇▅▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_089</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.23</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.40</td>
<td style="text-align: right;">2.85</td>
<td style="text-align: right;">3.13</td>
<td style="text-align: right;">3.53</td>
<td style="text-align: right;">5.10</td>
<td style="text-align: left;">▇▇▅▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_090</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.21</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">2.38</td>
<td style="text-align: right;">2.83</td>
<td style="text-align: right;">3.11</td>
<td style="text-align: right;">3.51</td>
<td style="text-align: right;">5.08</td>
<td style="text-align: left;">▇▇▅▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_091</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.19</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">2.36</td>
<td style="text-align: right;">2.81</td>
<td style="text-align: right;">3.09</td>
<td style="text-align: right;">3.49</td>
<td style="text-align: right;">5.05</td>
<td style="text-align: left;">▇▇▅▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_092</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.17</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">2.34</td>
<td style="text-align: right;">2.78</td>
<td style="text-align: right;">3.08</td>
<td style="text-align: right;">3.48</td>
<td style="text-align: right;">5.03</td>
<td style="text-align: left;">▇▇▅▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_093</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.15</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">2.32</td>
<td style="text-align: right;">2.77</td>
<td style="text-align: right;">3.06</td>
<td style="text-align: right;">3.46</td>
<td style="text-align: right;">5.01</td>
<td style="text-align: left;">▇▇▅▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_094</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.13</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">2.30</td>
<td style="text-align: right;">2.75</td>
<td style="text-align: right;">3.04</td>
<td style="text-align: right;">3.45</td>
<td style="text-align: right;">4.99</td>
<td style="text-align: left;">▇▇▅▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_095</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.11</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">2.28</td>
<td style="text-align: right;">2.73</td>
<td style="text-align: right;">3.01</td>
<td style="text-align: right;">3.43</td>
<td style="text-align: right;">4.97</td>
<td style="text-align: left;">▇▇▅▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_096</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.09</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">2.26</td>
<td style="text-align: right;">2.70</td>
<td style="text-align: right;">2.99</td>
<td style="text-align: right;">3.42</td>
<td style="text-align: right;">4.95</td>
<td style="text-align: left;">▇▇▅▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_097</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.07</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">2.24</td>
<td style="text-align: right;">2.68</td>
<td style="text-align: right;">2.97</td>
<td style="text-align: right;">3.41</td>
<td style="text-align: right;">4.92</td>
<td style="text-align: left;">▇▇▅▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_098</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.05</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">2.22</td>
<td style="text-align: right;">2.67</td>
<td style="text-align: right;">2.95</td>
<td style="text-align: right;">3.39</td>
<td style="text-align: right;">4.90</td>
<td style="text-align: left;">▇▇▅▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x_099</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.04</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">2.21</td>
<td style="text-align: right;">2.65</td>
<td style="text-align: right;">2.94</td>
<td style="text-align: right;">3.37</td>
<td style="text-align: right;">4.88</td>
<td style="text-align: left;">▇▇▅▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">x_100</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.02</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">2.19</td>
<td style="text-align: right;">2.63</td>
<td style="text-align: right;">2.92</td>
<td style="text-align: right;">3.35</td>
<td style="text-align: right;">4.85</td>
<td style="text-align: left;">▇▇▅▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">water</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">63.32</td>
<td style="text-align: right;">9.99</td>
<td style="text-align: right;">40.20</td>
<td style="text-align: right;">55.50</td>
<td style="text-align: right;">65.90</td>
<td style="text-align: right;">72.00</td>
<td style="text-align: right;">76.60</td>
<td style="text-align: left;">▂▂▃▅▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">fat</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">18.07</td>
<td style="text-align: right;">12.83</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">7.20</td>
<td style="text-align: right;">14.30</td>
<td style="text-align: right;">28.10</td>
<td style="text-align: right;">48.20</td>
<td style="text-align: left;">▇▅▃▂▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">protein</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">17.69</td>
<td style="text-align: right;">3.08</td>
<td style="text-align: right;">11.00</td>
<td style="text-align: right;">15.30</td>
<td style="text-align: right;">18.90</td>
<td style="text-align: right;">20.20</td>
<td style="text-align: right;">21.80</td>
<td style="text-align: left;">▂▃▃▇▇</td>
</tr>
</tbody>
</table>
</div>
<p>Checking the correlation between the Y outcomes:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>meat_training</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>water</span><span class='op'>:</span><span class='va'>protein</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggcorr</span><span class='op'>(</span>label <span class='op'>=</span> <span class='cn'>T</span>, label_alpha <span class='op'>=</span> <span class='cn'>T</span>, label_round <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-13-1.png" width="624" /></p>
</div>
<p>From the exploratory data analysis, we can see that:</p>
<ul>
<li>number of samples &lt;&lt; number of X variables (fat dataset)</li>
<li>there are no missing values, so there is no need for missing values imputation</li>
<li>Y variables are skewed, would need to normalize data</li>
<li>X variables are highly correlated, and it is recommended to only carry out means-centering and not scaling (Ron Wehren’s book for Chemometrics)</li>
<li>Y variables are also highly correlated with each other</li>
</ul>
<h2 id="pls2-modelling">PLS2 Modelling</h2>
<p>This section below is taken from: <a href="https://www.tidymodels.org/learn/models/pls/" class="uri">https://www.tidymodels.org/learn/models/pls/</a>, with some changes to the preprocessing steps.</p>
<p>This step includes preprocessing, specifying pls model to be used and model tuning.</p>
<p>For spectral data, autoscaling (normalization) is not usually recommended. When every spectral variable is set to the same standard deviation, the noise is blown up to the same size as the signal that contains the actual information. In such cases, only means-centering is required.</p>
<h3 id="preprocessing">Preprocessing</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Preprocessing only for TRAINING dataset</span>

<span class='co'># recipe</span>
<span class='va'>meat_reciped_pls2</span> <span class='op'>&lt;-</span> <span class='fu'>recipe</span><span class='op'>(</span><span class='va'>water</span> <span class='op'>+</span> <span class='va'>fat</span> <span class='op'>+</span> <span class='va'>protein</span> <span class='op'>~</span><span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>meat_training</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>update_role</span><span class='op'>(</span><span class='va'>water</span>, <span class='va'>fat</span>, <span class='va'>protein</span>, new_role <span class='op'>=</span> <span class='st'>"outcome"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_center</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
  
<span class='co'># set folds for cross-validation</span>

<span class='co'># repeated 10-fold cross validation for tuning model to select optimal number of components, since this is a small dataset</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>202103182</span><span class='op'>)</span>

<span class='va'>folds_pls2</span> <span class='op'>&lt;-</span> <span class='fu'>vfold_cv</span><span class='op'>(</span><span class='va'>meat_training</span>, repeats <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>

<span class='va'>folds_pls2</span> <span class='op'>&lt;-</span> 
  <span class='va'>folds_pls2</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>recipes <span class='op'>=</span> <span class='fu'>map</span><span class='op'>(</span><span class='va'>splits</span>, <span class='va'>prepper</span>, recipe <span class='op'>=</span> <span class='va'>meat_reciped_pls2</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="tuning-of-model-using-repeated-cross-validation-dataset">Tuning of model using repeated Cross-validation dataset</h3>
<p>To fit the model, we need to:</p>
<ul>
<li><p>format the X and Y into 2 different matrices, one for X and one for Y. THis is the format which the pls package requires.</p></li>
<li><p>Estimate the Y outcomes</p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>get_var_explained</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>recipe</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  
  <span class='co'># Extract the predictors and outcomes into their own matrices</span>
  <span class='va'>y_mat</span> <span class='op'>&lt;-</span> <span class='fu'>bake</span><span class='op'>(</span><span class='va'>recipe</span>, new_data <span class='op'>=</span> <span class='cn'>NULL</span>, composition <span class='op'>=</span> <span class='st'>"matrix"</span>, <span class='fu'>all_outcomes</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
  
  <span class='va'>x_mat</span> <span class='op'>&lt;-</span> <span class='fu'>bake</span><span class='op'>(</span><span class='va'>recipe</span>, new_data <span class='op'>=</span> <span class='cn'>NULL</span>, composition <span class='op'>=</span> <span class='st'>"matrix"</span>, <span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
  
  <span class='co'># The pls package prefers the data in a data frame where the outcome</span>
  <span class='co'># and predictors are in _matrices_. To make sure this is formatted</span>
  <span class='co'># properly, use the `I()` function to inhibit `data.frame()` from making</span>
  <span class='co'># all the individual columns. `pls_format` should have two columns.</span>
  <span class='va'>pls_format</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    endpoints <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/AsIs.html'>I</a></span><span class='op'>(</span><span class='va'>y_mat</span><span class='op'>)</span>,
    measurements <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/AsIs.html'>I</a></span><span class='op'>(</span><span class='va'>x_mat</span><span class='op'>)</span>
  <span class='op'>)</span>
  <span class='co'># Fit the model</span>
  <span class='va'>mod</span> <span class='op'>&lt;-</span> <span class='fu'>plsr</span><span class='op'>(</span><span class='va'>endpoints</span> <span class='op'>~</span> <span class='va'>measurements</span>, data <span class='op'>=</span> <span class='va'>pls_format</span><span class='op'>)</span>
  
  <span class='co'># Get the proportion of the predictor variance that is explained</span>
  <span class='co'># by the model for different number of components. </span>
  <span class='va'>xve</span> <span class='op'>&lt;-</span> <span class='fu'>explvar</span><span class='op'>(</span><span class='va'>mod</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>100</span> 

  <span class='co'># To do the same for the outcome, it is more complex. This code </span>
  <span class='co'># was extracted from pls:::summary.mvr. </span>
  <span class='va'>explained</span> <span class='op'>&lt;-</span> 
    <span class='fu'><a href='https://rdrr.io/r/base/drop.html'>drop</a></span><span class='op'>(</span><span class='fu'>pls</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/pls/man/mvrVal.html'>R2</a></span><span class='op'>(</span><span class='va'>mod</span>, estimate <span class='op'>=</span> <span class='st'>"train"</span>, intercept <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span><span class='op'>$</span><span class='va'>val</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='co'># transpose so that components are in rows</span>
    <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>as_tibble</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='co'># Add the predictor proportions</span>
    <span class='fu'>mutate</span><span class='op'>(</span>predictors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='va'>xve</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>as.vector</a></span><span class='op'>(</span><span class='op'>)</span>,
           components <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_along</a></span><span class='op'>(</span><span class='va'>xve</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='co'># Put into a tidy format that is tall</span>
    <span class='fu'>pivot_longer</span><span class='op'>(</span>
      cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>components</span><span class='op'>)</span>,
      names_to <span class='op'>=</span> <span class='st'>"source"</span>,
      values_to <span class='op'>=</span> <span class='st'>"proportion"</span>
    <span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># Compute this dataframe for each resample, and save the results in different columns:</span>

<span class='va'>folds_pls2</span> <span class='op'>&lt;-</span> 
  <span class='va'>folds_pls2</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>var <span class='op'>=</span> <span class='fu'>map</span><span class='op'>(</span><span class='va'>recipes</span>, <span class='va'>get_var_explained</span><span class='op'>)</span>,
         var <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/unname.html'>unname</a></span><span class='op'>(</span><span class='va'>var</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="scree-plot-1">Scree plot</h3>
<p>Extract variance data:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>variance_data</span> <span class='op'>&lt;-</span> 
  <span class='fu'>bind_rows</span><span class='op'>(</span><span class='va'>folds_pls2</span><span class='op'>[[</span><span class='st'>"var"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># select var col in folds dataset</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>components</span> <span class='op'>&lt;=</span> <span class='fl'>20</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># limit components to from 1 to 20</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>components</span>, <span class='va'>source</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>summarize</span><span class='op'>(</span>proportion <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>proportion</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>ggplot</span><span class='op'>(</span><span class='va'>variance_data</span>, <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>components</span>, y <span class='op'>=</span> <span class='va'>proportion</span>, 
                          col <span class='op'>=</span> <span class='va'>source</span>, label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>proportion</span>,<span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>geom_line</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_text</span><span class='op'>(</span>nudge_y <span class='op'>=</span> <span class='fl'>0.05</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Variance captured for different number of components"</span>, 
       subtitle <span class='op'>=</span> <span class='st'>"Predictors (X) variance is captured very well by a single componenet.\nTo estimate all Y outcomes, one may need 11-13 components."</span>,
       x <span class='op'>=</span> <span class='st'>"Number of components"</span>,
       y <span class='op'>=</span> <span class='st'>"Mean Cumulative Variance"</span>,
       caption <span class='op'>=</span> <span class='st'>"Source: Code is adapted from https://www.tidymodels.org/learn/models/pls/"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_wrap</span><span class='op'>(</span><span class='va'>source</span> <span class='op'>~</span><span class='va'>.</span>, ncol <span class='op'>=</span> <span class='fl'>2</span>, scales <span class='op'>=</span> <span class='st'>"fixed"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_continuous</span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>20</span><span class='op'>)</span>, n.breaks <span class='op'>=</span> <span class='fl'>19</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_few</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-16-1.png" width="624" /></p>
</div>
<h1 id="pls-1-modelling---water">PLS 1 modelling - Water</h1>
<p>Similar to earlier, to evaluate the PLS model, 10 repeats of the 10-folds cross validation will be used (100 holdout samples) to evaluate the overall model performance (RMSE, MAE, r-sq). However, individual models will be built for water, protein and fat.</p>
<p>Steps involved:</p>
<ul>
<li>split dataset (already carried out)</li>
<li>recipe: specify pre-processing steps</li>
<li>fit model</li>
<li>put into workflow</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># folds for repeated cross validation</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>20210325</span><span class='op'>)</span>
<span class='va'>folds_pls1</span> <span class='op'>&lt;-</span> <span class='fu'>vfold_cv</span><span class='op'>(</span><span class='va'>meat_training</span>, v <span class='op'>=</span> <span class='fl'>10</span>, repeats <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>

<span class='co'># recipe</span>
<span class='va'>meat_reciped_water_pls1</span> <span class='op'>&lt;-</span> <span class='fu'>recipe</span><span class='op'>(</span><span class='va'>water</span> <span class='op'>~</span><span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>meats</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>update_role</span><span class='op'>(</span><span class='va'>fat</span>, <span class='va'>protein</span>, new_role <span class='op'>=</span> <span class='st'>"other_y"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_center</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>meat_reciped_water_pls1</span>
</code></pre>
</div>
<pre><code>Data Recipe

Inputs:

      role #variables
   other_y          2
   outcome          1
 predictor        100

Operations:

Centering for all_predictors()</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># fit model</span>

<span class='va'>pls_water_model</span> <span class='op'>&lt;-</span> <span class='fu'>plsmod</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/plsmod/man/pls.html'>pls</a></span><span class='op'>(</span>num_comp <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># can be either classification or regression</span>
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"mixOmics"</span><span class='op'>)</span> <span class='co'># to specify which package to use</span>


<span class='co'># put into workflow</span>

<span class='va'>pls_water_workflow</span> <span class='op'>&lt;-</span> <span class='fu'>workflow</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_recipe</span><span class='op'>(</span><span class='va'>meat_reciped_water_pls1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_model</span><span class='op'>(</span><span class='va'>pls_water_model</span><span class='op'>)</span>

<span class='co'># create grid</span>

<span class='va'>pls_1_grid</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span><span class='op'>(</span>num_comp <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>1</span>, to <span class='op'>=</span> <span class='fl'>20</span>, by <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>


<span class='va'>tuned_pls1_water_results</span> <span class='op'>&lt;-</span> <span class='va'>pls_water_workflow</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>tune_grid</span><span class='op'>(</span>
    resamples <span class='op'>=</span> <span class='va'>folds_pls1</span>,
    grid <span class='op'>=</span> <span class='va'>pls_1_grid</span>,
    metrics <span class='op'>=</span> <span class='fu'>metric_set</span><span class='op'>(</span><span class='va'>rmse</span>, <span class='va'>rsq</span>, <span class='va'>mae</span><span class='op'>)</span>
  <span class='op'>)</span>

<span class='co'># model results</span>

<span class='va'>water_model_results</span> <span class='op'>&lt;-</span> <span class='va'>tuned_pls1_water_results</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>collect_metrics</span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>water_model_results</span>
</code></pre>
</div>
<pre><code># A tibble: 60 x 7
   num_comp .metric .estimator  mean     n std_err .config            
      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;              
 1        1 mae     standard   7.40    100  0.113  Preprocessor1_Mode…
 2        1 rmse    standard   8.77    100  0.137  Preprocessor1_Mode…
 3        1 rsq     standard   0.252   100  0.0162 Preprocessor1_Mode…
 4        2 mae     standard   4.78    100  0.0874 Preprocessor1_Mode…
 5        2 rmse    standard   6.06    100  0.110  Preprocessor1_Mode…
 6        2 rsq     standard   0.657   100  0.0121 Preprocessor1_Mode…
 7        3 mae     standard   3.31    100  0.0635 Preprocessor1_Mode…
 8        3 rmse    standard   4.10    100  0.0857 Preprocessor1_Mode…
 9        3 rsq     standard   0.823   100  0.0102 Preprocessor1_Mode…
10        4 mae     standard   2.78    100  0.0439 Preprocessor1_Mode…
# … with 50 more rows</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># best model</span>

<span class='va'>tuned_pls1_water_results</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span> <span class='co'># num_comp = 18</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 2
  num_comp .config              
     &lt;dbl&gt; &lt;chr&gt;                
1       18 Preprocessor1_Model18</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>tuned_pls1_water_results</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"rsq"</span><span class='op'>)</span> <span class='co'># num_comp = 18</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 2
  num_comp .config              
     &lt;dbl&gt; &lt;chr&gt;                
1       18 Preprocessor1_Model18</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>tuned_pls1_water_results</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"mae"</span><span class='op'>)</span> <span class='co'># num_comp = 18</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 2
  num_comp .config              
     &lt;dbl&gt; &lt;chr&gt;                
1       18 Preprocessor1_Model18</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># visualize</span>
<span class='va'>tuned_pls1_water_results</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>collect_metrics</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>num_comp</span>, <span class='va'>mean</span>, col <span class='op'>=</span> <span class='va'>.metric</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_continuous</span><span class='op'>(</span>n.breaks <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Number of components"</span>,
       y <span class='op'>=</span> <span class='st'>"Indicator"</span>,
       title <span class='op'>=</span> <span class='st'>"Plot of MAE, RMSE and R-SQ vs No. of components for TRAINING dataset, with 10-fold repeated cross validation"</span>,
       subtitle <span class='op'>=</span> <span class='st'>"Predicting Water Content: Optimal number of components is 18."</span><span class='op'>)</span> <span class='op'>+</span>
 <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>.metric</span> <span class='op'>~</span><span class='va'>.</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_few</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span>
</code></pre>
</div>
<img src="Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-17-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Update model and workflow:</span>

<span class='va'>updated_pls_water_model</span> <span class='op'>&lt;-</span>   <span class='fu'>plsmod</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/plsmod/man/pls.html'>pls</a></span><span class='op'>(</span>num_comp <span class='op'>=</span> <span class='fl'>18</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"mixOmics"</span><span class='op'>)</span>

<span class='va'>updated_pls_water_workflow</span> <span class='op'>&lt;-</span> <span class='va'>pls_water_workflow</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>update_model</span><span class='op'>(</span><span class='va'>updated_pls_water_model</span><span class='op'>)</span>

<span class='va'>pls_water_fit</span> <span class='op'>&lt;-</span> <span class='va'>updated_pls_water_workflow</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>fit</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>meat_training</span><span class='op'>)</span>

<span class='co'># Check the most important X variables for the updated Water Model:</span>

<span class='va'>tidy_pls_water</span> <span class='op'>&lt;-</span> <span class='va'>pls_water_fit</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pull_workflow_fit</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>tidy</span><span class='op'>(</span><span class='op'>)</span>

<span class='co'># Variable importance</span>

<span class='va'>tidy_pls_water</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>term</span> <span class='op'>!=</span> <span class='st'>"Y"</span>,
         <span class='va'>component</span> <span class='op'>==</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>18</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>component</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>slice_max</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span>, n <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>value</span>, <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>term</span>, <span class='va'>value</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>component</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_col</span><span class='op'>(</span>show.legend <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_wrap</span><span class='op'>(</span> <span class='op'>~</span> <span class='va'>component</span>, scales <span class='op'>=</span> <span class='st'>"free_y"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span> y <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_few</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<img src="Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-17-2.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Assess</span>

<span class='va'>pls_water_fit</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span>new_data <span class='op'>=</span> <span class='va'>meat_training</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>truth <span class='op'>=</span> <span class='va'>meat_training</span><span class='op'>$</span><span class='va'>water</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>truth</span>, <span class='va'>.pred</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_abline</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Actual vs Predicted for TRAINING dataset"</span>,
       x <span class='op'>=</span> <span class='st'>"Actual Water Content"</span>,
       y <span class='op'>=</span> <span class='st'>"Predicted Water Content"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_few</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<img src="Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-17-3.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># for TEST dataset</span>
  
<span class='va'>pls_water_fit</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span>new_data <span class='op'>=</span> <span class='va'>meat_testing</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>truth <span class='op'>=</span> <span class='va'>meat_testing</span><span class='op'>$</span><span class='va'>water</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>truth</span>, <span class='va'>.pred</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_abline</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Actual vs Predicted for TEST dataset"</span>,
       x <span class='op'>=</span> <span class='st'>"Actual Water Content"</span>,
       y <span class='op'>=</span> <span class='st'>"Predicted Water Content"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_few</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<img src="Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-17-4.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># assessing model on test data</span>
<span class='va'>updated_pls_water_workflow</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>last_fit</span><span class='op'>(</span><span class='va'>meat_split</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>collect_metrics</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 2 x 4
  .metric .estimator .estimate .config             
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard       2.32  Preprocessor1_Model1
2 rsq     standard       0.944 Preprocessor1_Model1</code></pre>
</div>
<p>From above, it seems that the prediction of moisture content is more accurate for higher water content samples.</p>
<h3 id="to-predict-water-content-for-future-data">To predict water content for future data:</h3>
<p>pls_water_fit %&gt;% predict(trial_data), where trial_data has the NIR spectrum.</p>
<h1 id="pls-1-modelling-for-fat">PLS 1 modelling for fat</h1>
<p>Repeat the workflow above for fat:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>meat_reciped_fat_pls1</span> <span class='op'>&lt;-</span> <span class='fu'>recipe</span><span class='op'>(</span><span class='va'>fat</span> <span class='op'>~</span><span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>meats</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>update_role</span><span class='op'>(</span><span class='va'>water</span>, <span class='va'>protein</span>, new_role <span class='op'>=</span> <span class='st'>"other_y"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_center</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>


<span class='va'>pls_fat_model</span> <span class='op'>&lt;-</span> <span class='fu'>plsmod</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/plsmod/man/pls.html'>pls</a></span><span class='op'>(</span>num_comp <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># can be either classification or regression</span>
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"mixOmics"</span><span class='op'>)</span>

<span class='va'>pls_fat_workflow</span> <span class='op'>&lt;-</span> <span class='fu'>workflow</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_recipe</span><span class='op'>(</span><span class='va'>meat_reciped_fat_pls1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_model</span><span class='op'>(</span><span class='va'>pls_fat_model</span><span class='op'>)</span>

<span class='va'>tuned_pls1_fat_results</span> <span class='op'>&lt;-</span> <span class='va'>pls_fat_workflow</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>tune_grid</span><span class='op'>(</span>
    resamples <span class='op'>=</span> <span class='va'>folds_pls1</span>,
    grid <span class='op'>=</span> <span class='va'>pls_1_grid</span>,
    metrics <span class='op'>=</span> <span class='fu'>metric_set</span><span class='op'>(</span><span class='va'>rmse</span>, <span class='va'>rsq</span>, <span class='va'>mae</span><span class='op'>)</span>
  <span class='op'>)</span>

<span class='co'># model results</span>

<span class='va'>fat_model_results</span> <span class='op'>&lt;-</span> <span class='va'>tuned_pls1_fat_results</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>collect_metrics</span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>fat_model_results</span>
</code></pre>
</div>
<pre><code># A tibble: 60 x 7
   num_comp .metric .estimator   mean     n std_err .config           
      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;             
 1        1 mae     standard    9.50    100  0.149  Preprocessor1_Mod…
 2        1 rmse    standard   11.5     100  0.178  Preprocessor1_Mod…
 3        1 rsq     standard    0.223   100  0.0155 Preprocessor1_Mod…
 4        2 mae     standard    6.32    100  0.120  Preprocessor1_Mod…
 5        2 rmse    standard    8.21    100  0.143  Preprocessor1_Mod…
 6        2 rsq     standard    0.617   100  0.0126 Preprocessor1_Mod…
 7        3 mae     standard    4.24    100  0.0914 Preprocessor1_Mod…
 8        3 rmse    standard    5.43    100  0.133  Preprocessor1_Mod…
 9        3 rsq     standard    0.809   100  0.0123 Preprocessor1_Mod…
10        4 mae     standard    3.57    100  0.0576 Preprocessor1_Mod…
# … with 50 more rows</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># best model</span>

<span class='va'>tuned_pls1_fat_results</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span> <span class='co'># num_comp = 19</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 2
  num_comp .config              
     &lt;dbl&gt; &lt;chr&gt;                
1       19 Preprocessor1_Model19</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>tuned_pls1_fat_results</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"rsq"</span><span class='op'>)</span> <span class='co'># num_comp = 18</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 2
  num_comp .config              
     &lt;dbl&gt; &lt;chr&gt;                
1       18 Preprocessor1_Model18</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>tuned_pls1_fat_results</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"mae"</span><span class='op'>)</span> <span class='co'># num_comp = 19</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 2
  num_comp .config              
     &lt;dbl&gt; &lt;chr&gt;                
1       19 Preprocessor1_Model19</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># visualize</span>
<span class='va'>tuned_pls1_fat_results</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>collect_metrics</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>num_comp</span>, <span class='va'>mean</span>, col <span class='op'>=</span> <span class='va'>.metric</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_continuous</span><span class='op'>(</span>n.breaks <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Number of components"</span>,
       y <span class='op'>=</span> <span class='st'>"Indicator"</span>,
       title <span class='op'>=</span> <span class='st'>"Plot of MAE, RMSE and R-SQ vs No. of components for TRAINING dataset, with 10-fold repeated cross validation"</span>,
       subtitle <span class='op'>=</span> <span class='st'>"Predicting Fat Content: Optimal number of components is 18."</span><span class='op'>)</span> <span class='op'>+</span>
 <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>.metric</span> <span class='op'>~</span><span class='va'>.</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_few</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span>
</code></pre>
</div>
<img src="Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-18-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Update model and workflow:</span>

<span class='va'>updated_pls_fat_model</span> <span class='op'>&lt;-</span>   <span class='fu'>plsmod</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/plsmod/man/pls.html'>pls</a></span><span class='op'>(</span>num_comp <span class='op'>=</span> <span class='fl'>18</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"mixOmics"</span><span class='op'>)</span>

<span class='va'>updated_pls_fat_workflow</span> <span class='op'>&lt;-</span> <span class='va'>pls_fat_workflow</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>update_model</span><span class='op'>(</span><span class='va'>updated_pls_fat_model</span><span class='op'>)</span>

<span class='va'>pls_fat_fit</span> <span class='op'>&lt;-</span> <span class='va'>updated_pls_fat_workflow</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>fit</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>meat_training</span><span class='op'>)</span>

<span class='co'># Check the most important X variables for the updated Water Model:</span>

<span class='va'>tidy_pls_fat</span> <span class='op'>&lt;-</span> <span class='va'>pls_fat_fit</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pull_workflow_fit</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>tidy</span><span class='op'>(</span><span class='op'>)</span>

<span class='co'># Variable importance</span>

<span class='va'>tidy_pls_fat</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>term</span> <span class='op'>!=</span> <span class='st'>"Y"</span>,
         <span class='va'>component</span> <span class='op'>==</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>18</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>component</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>slice_max</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span>, n <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>value</span>, <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>term</span>, <span class='va'>value</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>component</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_col</span><span class='op'>(</span>show.legend <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_wrap</span><span class='op'>(</span> <span class='op'>~</span> <span class='va'>component</span>, scales <span class='op'>=</span> <span class='st'>"free_y"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span> y <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_few</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<img src="Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-18-2.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Assess</span>

<span class='va'>pls_fat_fit</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span>new_data <span class='op'>=</span> <span class='va'>meat_training</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>truth <span class='op'>=</span> <span class='va'>meat_training</span><span class='op'>$</span><span class='va'>fat</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>truth</span>, <span class='va'>.pred</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_abline</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Actual vs Predicted for TRAINING dataset"</span>,
       x <span class='op'>=</span> <span class='st'>"Actual Fat Content"</span>,
       y <span class='op'>=</span> <span class='st'>"Predicted Fat Content"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_few</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<img src="Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-18-3.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># for TEST dataset</span>
  
<span class='va'>pls_fat_fit</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span>new_data <span class='op'>=</span> <span class='va'>meat_testing</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>truth <span class='op'>=</span> <span class='va'>meat_testing</span><span class='op'>$</span><span class='va'>fat</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>truth</span>, <span class='va'>.pred</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_abline</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Actual vs Predicted for TEST dataset"</span>,
       x <span class='op'>=</span> <span class='st'>"Actual Fat Content"</span>,
       y <span class='op'>=</span> <span class='st'>"Predicted Fat Content"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_few</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<img src="Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-18-4.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># assessing model on test data</span>
<span class='va'>updated_pls_fat_workflow</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>last_fit</span><span class='op'>(</span><span class='va'>meat_split</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>collect_metrics</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 2 x 4
  .metric .estimator .estimate .config             
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard       2.66  Preprocessor1_Model1
2 rsq     standard       0.959 Preprocessor1_Model1</code></pre>
</div>
<p>Fat content prediction is less accurate for samples with higher fat content.</p>
<h3 id="to-predict-fat-content-for-future-data">To predict fat content for future data:</h3>
<p>pls_fat_fit %&gt;% predict(trial_data), where trial_data has the NIR spectrum.</p>
<h1 id="pls-1-modelling-for-protein">PLS 1 modelling for protein</h1>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>meat_reciped_protein_pls1</span> <span class='op'>&lt;-</span> <span class='fu'>recipe</span><span class='op'>(</span><span class='va'>protein</span> <span class='op'>~</span><span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>meats</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>update_role</span><span class='op'>(</span><span class='va'>water</span>, <span class='va'>fat</span>, new_role <span class='op'>=</span> <span class='st'>"other_y"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>step_center</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>


<span class='va'>pls_protein_model</span> <span class='op'>&lt;-</span> <span class='fu'>plsmod</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/plsmod/man/pls.html'>pls</a></span><span class='op'>(</span>num_comp <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># can be either classification or regression</span>
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"mixOmics"</span><span class='op'>)</span> 

<span class='va'>pls_protein_workflow</span> <span class='op'>&lt;-</span> <span class='fu'>workflow</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_recipe</span><span class='op'>(</span><span class='va'>meat_reciped_protein_pls1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>add_model</span><span class='op'>(</span><span class='va'>pls_protein_model</span><span class='op'>)</span>

<span class='va'>tuned_pls1_protein_results</span> <span class='op'>&lt;-</span> <span class='va'>pls_protein_workflow</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>tune_grid</span><span class='op'>(</span>
    resamples <span class='op'>=</span> <span class='va'>folds_pls1</span>,
    grid <span class='op'>=</span> <span class='va'>pls_1_grid</span>,
    metrics <span class='op'>=</span> <span class='fu'>metric_set</span><span class='op'>(</span><span class='va'>rmse</span>, <span class='va'>rsq</span>, <span class='va'>mae</span><span class='op'>)</span>
  <span class='op'>)</span>

<span class='co'># model results</span>

<span class='va'>protein_model_results</span> <span class='op'>&lt;-</span> <span class='va'>tuned_pls1_protein_results</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>collect_metrics</span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>protein_model_results</span>
</code></pre>
</div>
<pre><code># A tibble: 60 x 7
   num_comp .metric .estimator  mean     n std_err .config            
      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;              
 1        1 mae     standard   2.54    100  0.0378 Preprocessor1_Mode…
 2        1 rmse    standard   2.97    100  0.0395 Preprocessor1_Mode…
 3        1 rsq     standard   0.126   100  0.0136 Preprocessor1_Mode…
 4        2 mae     standard   1.92    100  0.0345 Preprocessor1_Mode…
 5        2 rmse    standard   2.38    100  0.0366 Preprocessor1_Mode…
 6        2 rsq     standard   0.406   100  0.0164 Preprocessor1_Mode…
 7        3 mae     standard   1.37    100  0.0333 Preprocessor1_Mode…
 8        3 rmse    standard   1.84    100  0.0450 Preprocessor1_Mode…
 9        3 rsq     standard   0.635   100  0.0170 Preprocessor1_Mode…
10        4 mae     standard   1.24    100  0.0255 Preprocessor1_Mode…
# … with 50 more rows</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># best model</span>

<span class='va'>tuned_pls1_protein_results</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span> <span class='co'># num_comp = 14</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 2
  num_comp .config              
     &lt;dbl&gt; &lt;chr&gt;                
1       14 Preprocessor1_Model14</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>tuned_pls1_protein_results</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"rsq"</span><span class='op'>)</span> <span class='co'># num_comp = 14</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 2
  num_comp .config              
     &lt;dbl&gt; &lt;chr&gt;                
1       15 Preprocessor1_Model15</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>tuned_pls1_protein_results</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select_best</span><span class='op'>(</span>metric <span class='op'>=</span> <span class='st'>"mae"</span><span class='op'>)</span> <span class='co'># num_comp = 15</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 2
  num_comp .config              
     &lt;dbl&gt; &lt;chr&gt;                
1       15 Preprocessor1_Model15</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># visualize</span>
<span class='va'>tuned_pls1_protein_results</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>collect_metrics</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>num_comp</span>, <span class='va'>mean</span>, col <span class='op'>=</span> <span class='va'>.metric</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_continuous</span><span class='op'>(</span>n.breaks <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Number of components"</span>,
       y <span class='op'>=</span> <span class='st'>"Indicator"</span>,
       title <span class='op'>=</span> <span class='st'>"Plot of MAE, RMSE and R-SQ vs No. of components for TRAINING dataset, with 10-fold repeated cross validation"</span>,
       subtitle <span class='op'>=</span> <span class='st'>"Predicting protein Content: Optimal number of components is 14."</span><span class='op'>)</span> <span class='op'>+</span>
 <span class='fu'>facet_grid</span><span class='op'>(</span><span class='va'>.metric</span> <span class='op'>~</span><span class='va'>.</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_few</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span>
</code></pre>
</div>
<img src="Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-19-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Update model and workflow:</span>

<span class='va'>updated_pls_protein_model</span> <span class='op'>&lt;-</span>   <span class='fu'>plsmod</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/plsmod/man/pls.html'>pls</a></span><span class='op'>(</span>num_comp <span class='op'>=</span> <span class='fl'>14</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"mixOmics"</span><span class='op'>)</span>

<span class='va'>updated_pls_protein_workflow</span> <span class='op'>&lt;-</span> <span class='va'>pls_protein_workflow</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>update_model</span><span class='op'>(</span><span class='va'>updated_pls_protein_model</span><span class='op'>)</span>

<span class='va'>pls_protein_fit</span> <span class='op'>&lt;-</span> <span class='va'>updated_pls_protein_workflow</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>fit</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>meat_training</span><span class='op'>)</span>

<span class='co'># Check the most important X variables for the updated Water Model:</span>

<span class='va'>tidy_pls_protein</span> <span class='op'>&lt;-</span> <span class='va'>pls_protein_fit</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pull_workflow_fit</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>tidy</span><span class='op'>(</span><span class='op'>)</span>

<span class='co'># Variable importance</span>

<span class='va'>tidy_pls_protein</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>term</span> <span class='op'>!=</span> <span class='st'>"Y"</span>,
         <span class='va'>component</span> <span class='op'>==</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>14</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>component</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>slice_max</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span>, n <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>value</span>, <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>term</span>, <span class='va'>value</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>component</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_col</span><span class='op'>(</span>show.legend <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_wrap</span><span class='op'>(</span> <span class='op'>~</span> <span class='va'>component</span>, scales <span class='op'>=</span> <span class='st'>"free_y"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span> y <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_few</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<img src="Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-19-2.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Assess</span>

<span class='va'>pls_protein_fit</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span>new_data <span class='op'>=</span> <span class='va'>meat_training</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>truth <span class='op'>=</span> <span class='va'>meat_training</span><span class='op'>$</span><span class='va'>protein</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>truth</span>, <span class='va'>.pred</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_abline</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Actual vs Predicted for TRAINING dataset"</span>,
       x <span class='op'>=</span> <span class='st'>"Actual protein Content"</span>,
       y <span class='op'>=</span> <span class='st'>"Predicted protein Content"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_few</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<img src="Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-19-3.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># for TEST dataset</span>
  
<span class='va'>pls_protein_fit</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span>new_data <span class='op'>=</span> <span class='va'>meat_testing</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>truth <span class='op'>=</span> <span class='va'>meat_testing</span><span class='op'>$</span><span class='va'>protein</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>truth</span>, <span class='va'>.pred</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_abline</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Actual vs Predicted for TEST dataset"</span>,
       x <span class='op'>=</span> <span class='st'>"Actual protein Content"</span>,
       y <span class='op'>=</span> <span class='st'>"Predicted protein Content"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_few</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<img src="Meat-NIR-PLS-regression_files/figure-html5/unnamed-chunk-19-4.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># assessing model on test data</span>
<span class='va'>updated_pls_protein_workflow</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>last_fit</span><span class='op'>(</span><span class='va'>meat_split</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>collect_metrics</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 2 x 4
  .metric .estimator .estimate .config             
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard       0.463 Preprocessor1_Model1
2 rsq     standard       0.980 Preprocessor1_Model1</code></pre>
</div>
<h3 id="to-predict-protein-content-for-future-data">To predict protein content for future data:</h3>
<p>pls_protein_fit %&gt;% predict(trial_data), where trial_data has the NIR spectrum.</p>
<h1 id="learning-pointers">Learning pointers</h1>
<p>Through this exercise, I learnt:</p>
<ul>
<li><p>how to carry out PCA and PLS regression on NIR data. However, I am not very sure whether to carry out both means-centering and scaling on NIR data or not?</p></li>
<li><p>how to efficiently visualize the number of components for PLS regression by following the steps listed on <a href="https://www.tidymodels.org/learn/models/pls/" class="uri">https://www.tidymodels.org/learn/models/pls/</a></p></li>
<li><p>the difference between PLS 1 and PLS 2, although I think tidymodels cannot handle PLS 2 yet.</p></li>
<li><p>Initially I tried to carry out PLS regression by visual inspection for optimal number of components so that there will be a tradeoff between over-fitting and bias, but I find that the accuracy is really compromised, so I will stick to the optimal number of components by looking at the three different metrics and choosing from there.</p></li>
</ul>
<p>I think this is a good practice for real-life datasets, but I would probably need to practice more on other datasets to get the hang of PLS regression. It would also be good practice to work on comparison of different models on test dataset.</p>
<h1 id="references">References</h1>
<p><a href="https://mixomicsteam.github.io/Bookdown/pls.html" class="uri">https://mixomicsteam.github.io/Bookdown/pls.html</a> <a href="https://www.tidymodels.org/learn/models/pls/" class="uri">https://www.tidymodels.org/learn/models/pls/</a> <a href="https://www.tmwr.org/resampling.html" class="uri">https://www.tmwr.org/resampling.html</a> <a href="https://rsample.tidymodels.org/articles/Working_with_rsets.html" class="uri">https://rsample.tidymodels.org/articles/Working_with_rsets.html</a> <a href="https://conf20-intro-ml.netlify.app/slides/07-cv.html#1" class="uri">https://conf20-intro-ml.netlify.app/slides/07-cv.html#1</a> <a href="https://www.sciencedirect.com/science/article/pii/S1878535214000343" class="uri">https://www.sciencedirect.com/science/article/pii/S1878535214000343</a> <a href="https://stackoverflow.com/questions/64582463/how-do-i-specify-a-pls-model-in-tidy-models" class="uri">https://stackoverflow.com/questions/64582463/how-do-i-specify-a-pls-model-in-tidy-models</a> <a href="https://github.com/tidymodels/workflows/issues/37" class="uri">https://github.com/tidymodels/workflows/issues/37</a></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<div class="article-footer">
  <p class="social_footer">
    <span class="disqus-comments">
      <i class="fas fa-comments"></i>
      &nbsp;
      <span class="disqus-comment-count" data-disqus-identifier="posts/20210328_NIR Meat Data (PLS-regression)/">Comment on this article</span>
    </span>
    <span class="article-sharing">
      Share: &nbsp;
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Flruolin.github.io%2FmyBlog%2Fposts%2F20210328_NIR%20Meat%20Data%20%28PLS-regression%29%2F&amp;title=Meat%20NIR%20data" aria-label="share on linkedin">
        <i class="fab fa-linkedin" aria-hidden="true"></i>
      </a>
    </span>
  </p>
  <script id="dsq-count-scr" src="https://https-lruolin-github-io-myblog-2.disqus.com/count.js" async></script>
  <div id="disqus_thread" class="hidden"></div>
  <script type="text/javascript" cookie-consent="functionality">
var disqus_config = function () {
  this.page.url = 'https://lruolin.github.io/myBlog/posts/20210328_NIR Meat Data (PLS-regression)/';
  this.page.identifier = 'posts/20210328_NIR Meat Data (PLS-regression)/';
};
(function() {
  var d = document, s = d.createElement('script');
  s.src = 'https://https-lruolin-github-io-myblog-2.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
</script>
</div>
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">lruolin (2021, March 18). pRactice corner: Meat NIR data. Retrieved from https://lruolin.github.io/myBlog/posts/20210328_NIR Meat Data (PLS-regression)/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{lruolin2021meat,
  author = {lruolin, },
  title = {pRactice corner: Meat NIR data},
  url = {https://lruolin.github.io/myBlog/posts/20210328_NIR Meat Data (PLS-regression)/},
  year = {2021}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
